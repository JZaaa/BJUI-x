(function(window,undefined){if(window.KindEditor){return}if(!window.console){window.console={}}if(!console.log){console.log=function(){}}var _VERSION="4.1.12 (2017-04-12)",_ua=navigator.userAgent.toLowerCase(),_IE=_ua.indexOf("msie")>-1&&_ua.indexOf("opera")==-1,_NEWIE=_ua.indexOf("msie")==-1&&_ua.indexOf("trident")>-1,_GECKO=_ua.indexOf("gecko")>-1&&_ua.indexOf("khtml")==-1,_WEBKIT=_ua.indexOf("applewebkit")>-1,_OPERA=_ua.indexOf("opera")>-1,_MOBILE=_ua.indexOf("mobile")>-1,_IOS=/ipad|iphone|ipod/.test(_ua),_QUIRKS=document.compatMode!="CSS1Compat",_IERANGE=!window.getSelection,_matches=/(?:msie|firefox|webkit|opera)[\/:\s](\d+)/.exec(_ua),_V=_matches?_matches[1]:"0",_TIME=(new Date).getTime();function _isArray(e){if(!e){return false}return Object.prototype.toString.call(e)==="[object Array]"}function _isFunction(e){if(!e){return false}return Object.prototype.toString.call(e)==="[object Function]"}function _inArray(e,t){for(var n=0,i=t.length;n<i;n++){if(e===t[n]){return n}}return-1}function _each(e,t){if(_isArray(e)){for(var n=0,i=e.length;n<i;n++){if(t.call(e[n],n,e[n])===false){break}}}else{for(var a in e){if(e.hasOwnProperty(a)){if(t.call(e[a],a,e[a])===false){break}}}}}function _trim(e){return e.replace(/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"")}function _inString(e,t,n){n=n===undefined?",":n;return(n+t+n).indexOf(n+e+n)>=0}function _addUnit(e,t){t=t||"px";return e&&/^-?\d+(?:\.\d+)?$/.test(e)?e+t:e}function _removeUnit(e){var t;return e&&(t=/(\d+)/.exec(e))?parseInt(t[1],10):0}function _escape(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function _unescape(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}function _toCamel(e){var t=e.split("-");e="";_each(t,function(t,n){e+=t>0?n.charAt(0).toUpperCase()+n.substr(1):n});return e}function _toHex(e){function t(e){var t=parseInt(e,10).toString(16).toUpperCase();return t.length>1?t:"0"+t}return e.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/gi,function(e,n,i,a){return"#"+t(n)+t(i)+t(a)})}function _toMap(e,t){t=t===undefined?",":t;var n={},i=_isArray(e)?e:e.split(t),a;_each(i,function(e,t){if(a=/^(\d+)\.\.(\d+)$/.exec(t)){for(var i=parseInt(a[1],10);i<=parseInt(a[2],10);i++){n[i.toString()]=true}}else{n[t]=true}});return n}function _toArray(e,t){return Array.prototype.slice.call(e,t||0)}function _undef(e,t){return e===undefined?t:e}function _invalidUrl(e){return!e||/[<>"]/.test(e)}function _addParam(e,t){return e.indexOf("?")>=0?e+"&"+t:e+"?"+t}function _extend(e,t,n){if(!n){n=t;t=null}var i;if(t){var a=function(){};a.prototype=t.prototype;i=new a;_each(n,function(e,t){i[e]=t})}else{i=n}i.constructor=e;e.prototype=i;e.parent=t?t.prototype:null}function _json(text){var match;if(match=/\{[\s\S]*\}|\[[\s\S]*\]/.exec(text)){text=match[0]}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")")}throw"JSON parse error"}var _round=Math.round;var K={DEBUG:false,VERSION:_VERSION,IE:_IE,GECKO:_GECKO,WEBKIT:_WEBKIT,OPERA:_OPERA,V:_V,TIME:_TIME,each:_each,isArray:_isArray,isFunction:_isFunction,inArray:_inArray,inString:_inString,trim:_trim,addUnit:_addUnit,removeUnit:_removeUnit,escape:_escape,unescape:_unescape,toCamel:_toCamel,toHex:_toHex,toMap:_toMap,toArray:_toArray,undef:_undef,invalidUrl:_invalidUrl,addParam:_addParam,extend:_extend,json:_json};var _INLINE_TAG_MAP=_toMap("a,abbr,acronym,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,img,input,ins,kbd,label,map,q,s,samp,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),_BLOCK_TAG_MAP=_toMap("address,applet,blockquote,body,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,iframe,ins,isindex,li,map,menu,meta,noframes,noscript,object,ol,p,pre,script,style,table,tbody,td,tfoot,th,thead,title,tr,ul"),_SINGLE_TAG_MAP=_toMap("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),_STYLE_TAG_MAP=_toMap("b,basefont,big,del,em,font,i,s,small,span,strike,strong,sub,sup,u"),_CONTROL_TAG_MAP=_toMap("img,table,input,textarea,button"),_PRE_TAG_MAP=_toMap("pre,style,script"),_NOSPLIT_TAG_MAP=_toMap("html,head,body,td,tr,table,ol,ul,li"),_AUTOCLOSE_TAG_MAP=_toMap("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),_FILL_ATTR_MAP=_toMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),_VALUE_TAG_MAP=_toMap("input,button,textarea,select");function _getBasePath(){var e=document.getElementsByTagName("script"),t;for(var n=0,i=e.length;n<i;n++){t=e[n].src||"";if(/kindeditor[\w\-\.]*\.js/.test(t)){return t.substring(0,t.lastIndexOf("/")+1)}}return""}K.basePath=_getBasePath();K.options={designMode:true,fullscreenMode:false,filterMode:true,wellFormatMode:true,shadowMode:true,loadStyleMode:true,basePath:K.basePath,themesPath:K.basePath+"themes/",langPath:K.basePath+"lang/",pluginsPath:K.basePath+"plugins/",themeType:"default",langType:"zh-CN",urlType:"",newlineTag:"p",resizeType:2,syncType:"form",pasteType:2,dialogAlignType:"page",useContextmenu:true,fullscreenShortcut:false,bodyClass:"ke-content",indentChar:"\t",cssPath:"",cssData:"",minWidth:650,minHeight:100,minChangeSize:50,zIndex:811213,items:["source","|","undo","redo","|","preview","print","template","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],noDisableItems:["source","fullscreen"],colorTable:[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],fontSizeTable:["9px","10px","12px","14px","16px","18px","24px","32px"],htmlTags:{font:["id","class","color","size","face",".background-color"],span:["id","class",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".line-height"],div:["id","class","align",".border",".margin",".padding",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".background",".font-style",".text-decoration",".vertical-align",".margin-left"],table:["id","class","border","cellspacing","cellpadding","width","height","align","bordercolor",".padding",".margin",".border","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".background",".width",".height",".border-collapse"],"td,th":["id","class","align","valign","width","height","colspan","rowspan","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".vertical-align",".background",".border"],a:["id","class","href","target","name"],embed:["id","class","src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess","wmode"],img:["id","class","src","width","height","border","alt","title","align",".width",".height",".border"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["id","class","align",".text-align",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],pre:["id","class"],hr:["id","class",".page-break-after"],"br,tbody,tr,strong,b,sub,sup,em,i,u,strike,s,del":["id","class"],iframe:["id","class","src","frameborder","width","height",".width",".height"],"dt,dd,dl":["id","class","style",".font-size",".font-family",".font-weight",".line-height",".color",".margin-top",".margin-bottom"]},layout:'<div class="container"><div class="toolbar"></div><div class="edit"></div><div class="statusbar"></div></div>'};var _useCapture=false;var _INPUT_KEY_MAP=_toMap("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222");var _CURSORMOVE_KEY_MAP=_toMap("33..40");var _CHANGE_KEY_MAP={};_each(_INPUT_KEY_MAP,function(e,t){_CHANGE_KEY_MAP[e]=t});_each(_CURSORMOVE_KEY_MAP,function(e,t){_CHANGE_KEY_MAP[e]=t});function _bindEvent(e,t,n){if(e.addEventListener){e.addEventListener(t,n,_useCapture)}else if(e.attachEvent){e.attachEvent("on"+t,n)}}function _unbindEvent(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,_useCapture)}else if(e.detachEvent){e.detachEvent("on"+t,n)}}var _EVENT_PROPS=("altKey,attrChange,attrName,bubbles,button,cancelable,charCode,clientX,clientY,ctrlKey,currentTarget,"+"data,detail,eventPhase,fromElement,handler,keyCode,metaKey,newValue,offsetX,offsetY,originalTarget,pageX,"+"pageY,prevValue,relatedNode,relatedTarget,screenX,screenY,shiftKey,srcElement,target,toElement,view,wheelDelta,which").split(",");function KEvent(e,t){this.init(e,t)}_extend(KEvent,{init:function(e,t){var n=this,i=e.ownerDocument||e.document||e;n.event=t;_each(_EVENT_PROPS,function(e,i){n[i]=t[i]});if(!n.target){n.target=n.srcElement||i}if(n.target.nodeType===3){n.target=n.target.parentNode}if(!n.relatedTarget&&n.fromElement){n.relatedTarget=n.fromElement===n.target?n.toElement:n.fromElement}if(n.pageX==null&&n.clientX!=null){var a=i.documentElement,r=i.body;n.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0);n.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)}if(!n.which&&(n.charCode||n.charCode===0?n.charCode:n.keyCode)){n.which=n.charCode||n.keyCode}if(!n.metaKey&&n.ctrlKey){n.metaKey=n.ctrlKey}if(!n.which&&n.button!==undefined){n.which=n.button&1?1:n.button&2?3:n.button&4?2:0}switch(n.which){case 186:n.which=59;break;case 187:case 107:case 43:n.which=61;break;case 189:case 45:n.which=109;break;case 42:n.which=106;break;case 47:n.which=111;break;case 78:n.which=110;break}if(n.which>=96&&n.which<=105){n.which-=48}},preventDefault:function(){var e=this.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){var e=this.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},stop:function(){this.preventDefault();this.stopPropagation()}});var _eventExpendo="kindeditor_"+_TIME,_eventId=0,_eventData={};function _getId(e){return e[_eventExpendo]||null}function _setId(e){e[_eventExpendo]=++_eventId;return _eventId}function _removeId(e){try{delete e[_eventExpendo]}catch(t){if(e.removeAttribute){e.removeAttribute(_eventExpendo)}}}function _bind(e,t,n){if(t.indexOf(",")>=0){_each(t.split(","),function(){_bind(e,this,n)});return}var i=_getId(e);if(!i){i=_setId(e)}if(_eventData[i]===undefined){_eventData[i]={}}var a=_eventData[i][t];if(a&&a.length>0){_unbindEvent(e,t,a[0])}else{_eventData[i][t]=[];_eventData[i].el=e}a=_eventData[i][t];if(a.length===0){a[0]=function(t){var n=t?new KEvent(e,t):undefined;_each(a,function(t,i){if(t>0&&i){i.call(e,n)}})}}if(_inArray(n,a)<0){a.push(n)}_bindEvent(e,t,a[0])}function _unbind(e,t,n){if(t&&t.indexOf(",")>=0){_each(t.split(","),function(){_unbind(e,this,n)});return}var i=_getId(e);if(!i){return}if(t===undefined){if(i in _eventData){_each(_eventData[i],function(t,n){if(t!="el"&&n.length>0){_unbindEvent(e,t,n[0])}});delete _eventData[i];_removeId(e)}return}if(!_eventData[i]){return}var a=_eventData[i][t];if(a&&a.length>0){if(n===undefined){_unbindEvent(e,t,a[0]);delete _eventData[i][t]}else{_each(a,function(e,t){if(e>0&&t===n){a.splice(e,1)}});if(a.length==1){_unbindEvent(e,t,a[0]);delete _eventData[i][t]}}var r=0;_each(_eventData[i],function(){r++});if(r<2){delete _eventData[i];_removeId(e)}}}function _fire(e,t){if(t.indexOf(",")>=0){_each(t.split(","),function(){_fire(e,this)});return}var n=_getId(e);if(!n){return}var i=_eventData[n][t];if(_eventData[n]&&i&&i.length>0){i[0]()}}function _ctrl(e,t,n){var i=this;t=/^\d{2,}$/.test(t)?t:t.toUpperCase().charCodeAt(0);_bind(e,"keydown",function(i){if(i.ctrlKey&&i.which==t&&!i.shiftKey&&!i.altKey){n.call(e);i.stop()}})}var _readyFinished=false;function _ready(e){if(_readyFinished){e(KindEditor);return}var t=false;function n(){if(!t){t=true;e(KindEditor);_readyFinished=true}}function i(){if(!t){try{document.documentElement.doScroll("left")}catch(e){setTimeout(i,100);return}n()}}function a(){if(document.readyState==="complete"){n()}}if(document.addEventListener){_bind(document,"DOMContentLoaded",n)}else if(document.attachEvent){_bind(document,"readystatechange",a);var r=false;try{r=window.frameElement==null}catch(e){}if(document.documentElement.doScroll&&r){i()}}_bind(window,"load",n)}if(window.attachEvent){window.attachEvent("onunload",function(){_each(_eventData,function(e,t){if(t.el){_unbind(t.el)}})})}K.ctrl=_ctrl;K.ready=_ready;function _getCssList(e){e=e.replace(/&quot;/g,'"');var t={},n=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g,i;while(i=n.exec(e)){var a=_trim(i[1].toLowerCase()),r=_trim(_toHex(i[2]));t[a]=r}return t}function _getAttrList(e){var t={},n=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g,i;while(i=n.exec(e)){var a=(i[1]||i[2]||i[4]||i[6]).toLowerCase(),r=(i[2]?i[3]:i[4]?i[5]:i[7])||"";t[a]=r}return t}function _addClassToTag(e,t){if(/\s+class\s*=/.test(e)){e=e.replace(/(\s+class=["']?)([^"']*)(["']?[\s>])/,function(e,n,i,a){if((" "+i+" ").indexOf(" "+t+" ")<0){return i===""?n+t+a:n+i+" "+t+a}else{return e}})}else{e=e.substr(0,e.length-1)+' class="'+t+'">'}return e}function _formatCss(e){var t="";_each(_getCssList(e),function(e,n){t+=e+":"+n+";"});return t}function _formatUrl(e,t,n,i){t=_undef(t,"").toLowerCase();if(e.substr(0,5)!="data:"){e=e.replace(/([^:])\/\//g,"$1/")}if(_inArray(t,["absolute","relative","domain"])<0){return e}n=n||location.protocol+"//"+location.host;if(i===undefined){var a=location.pathname.match(/^(\/.*)\//);i=a?a[1]:""}var r;if(r=/^(\w+:\/\/[^\/]*)/.exec(e)){if(r[1]!==n){return e}}else if(/^\w+:/.test(e)){return e}function o(e){var t=e.split("/"),n=[];for(var i=0,a=t.length;i<a;i++){var r=t[i];if(r==".."){if(n.length>0){n.pop()}}else if(r!==""&&r!="."){n.push(r)}}return"/"+n.join("/")}if(/^\//.test(e)){e=n+o(e.substr(1))}else if(!/^\w+:\/\//.test(e)){e=n+o(i+"/"+e)}function l(t,n){if(e.substr(0,t.length)===t){var a=[];for(var o=0;o<n;o++){a.push("..")}var s=".";if(a.length>0){s+="/"+a.join("/")}if(i=="/"){s+="/"}return s+e.substr(t.length)}else{if(r=/^(.*)\//.exec(t)){return l(r[1],++n)}}}if(t==="relative"){e=l(n+i,0).substr(2)}else if(t==="absolute"){if(e.substr(0,n.length)===n){e=e.substr(n.length)}}return e}function _formatHtml(e,t,n,i,a){if(e==null){e=""}n=n||"";i=_undef(i,false);a=_undef(a,"\t");var r="xx-small,x-small,small,medium,large,x-large,xx-large".split(",");e=e.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(e,t,n,i){return t+n.replace(/<(?:br|br\s[^>]*)>/gi,"\n")+i});e=e.replace(/<(?:br|br\s[^>]*)\s*\/?>\s*<\/p>/gi,"</p>");e=e.replace(/(<(?:p|p\s[^>]*)>)\s*(<\/p>)/gi,"$1<br />$2");e=e.replace(/\u200B/g,"");e=e.replace(/\u00A9/g,"&copy;");e=e.replace(/\u00AE/g,"&reg;");e=e.replace(/\u2003/g,"&emsp;");e=e.replace(/\u3000/g,"&emsp;");e=e.replace(/<[^>]+/g,function(e){return e.replace(/\s+/g," ")});var o={};if(t){_each(t,function(e,t){var n=e.split(",");for(var i=0,a=n.length;i<a;i++){o[n[i]]=_toMap(t)}});if(!o.script){e=e.replace(/(<(?:script|script\s[^>]*)>)([\s\S]*?)(<\/script>)/gi,"")}if(!o.style){e=e.replace(/(<(?:style|style\s[^>]*)>)([\s\S]*?)(<\/style>)/gi,"")}}var l=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g;var s=[];e=e.replace(l,function(e,l,d,u,c,f,p){var h=e,m=l||"",g=d||"",v=u.toLowerCase(),_=c||"",b=f?" "+f:"",y=p||"";if(t&&!o[v]){return""}if(b===""&&_SINGLE_TAG_MAP[v]){b=" /"}if(_INLINE_TAG_MAP[v]){if(m){m=" "}if(y){y=" "}}if(_PRE_TAG_MAP[v]){if(g){y="\n"}else{m="\n"}}if(i&&v=="br"){y="\n"}if(_BLOCK_TAG_MAP[v]&&!_PRE_TAG_MAP[v]){if(i){if(g&&s.length>0&&s[s.length-1]===v){s.pop()}else{s.push(v)}m="\n";y="\n";for(var k=0,w=g?s.length:s.length-1;k<w;k++){m+=a;if(!g){y+=a}}if(b){s.pop()}else if(!g){y+=a}}else{m=y=""}}if(_!==""){var S=_getAttrList(h);if(v==="font"){var E={},C="";_each(S,function(e,t){if(e==="color"){E.color=t;delete S[e]}if(e==="size"){E["font-size"]=r[parseInt(t,10)-1]||"";delete S[e]}if(e==="face"){E["font-family"]=t;delete S[e]}if(e==="style"){C=t}});if(C&&!/;$/.test(C)){C+=";"}_each(E,function(e,t){if(t===""){return}if(/\s/.test(t)){t="'"+t+"'"}C+=e+":"+t+";"});S.style=C}_each(S,function(e,i){if(_FILL_ATTR_MAP[e]){S[e]=e}if(_inArray(e,["src","href"])>=0){S[e]=_formatUrl(i,n)}if(t&&e!=="style"&&!o[v]["*"]&&!o[v][e]||v==="body"&&e==="contenteditable"||/^kindeditor_\d+$/.test(e)){delete S[e]}if(e==="style"&&i!==""){var a=_getCssList(i);_each(a,function(e,n){if(t&&!o[v].style&&!o[v]["."+e]){delete a[e]}});var r="";_each(a,function(e,t){r+=e+":"+t+";"});S.style=r}});_="";_each(S,function(e,t){if(e==="style"&&t===""){return}t=t.replace(/"/g,"&quot;");_+=" "+e+'="'+t+'"'})}if(v==="font"){v="span"}return m+"<"+g+v+_+b+">"+y});e=e.replace(/(<(?:pre|pre\s[^>]*)>)([\s\S]*?)(<\/pre>)/gi,function(e,t,n,i){return t+n.replace(/\n/g,'<span id="__kindeditor_pre_newline__">\n')+i});e=e.replace(/\n\s*\n/g,"\n");e=e.replace(/<span id="__kindeditor_pre_newline__">\n/g,"\n");return _trim(e)}function _clearMsWord(e,t){e=e.replace(/<meta[\s\S]*?>/gi,"").replace(/<![\s\S]*?>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<w:[^>]+>[\s\S]*?<\/w:[^>]+>/gi,"").replace(/<o:[^>]+>[\s\S]*?<\/o:[^>]+>/gi,"").replace(/<xml>[\s\S]*?<\/xml>/gi,"").replace(/<(?:table|td)[^>]*>/gi,function(e){return e.replace(/border-bottom:([#\w\s]+)/gi,"border:$1")});return _formatHtml(e,t)}function _mediaType(e){if(/\.(rm|rmvb)(\?|$)/i.test(e)){return"audio/x-pn-realaudio-plugin"}if(/\.(swf|flv)(\?|$)/i.test(e)){return"application/x-shockwave-flash"}return"video/x-ms-asf-plugin"}function _mediaClass(e){if(/realaudio/i.test(e)){return"ke-rm"}if(/flash/i.test(e)){return"ke-flash"}return"ke-media"}function _mediaAttrs(e){return _getAttrList(unescape(e))}function _mediaEmbed(e){var t="<embed ";_each(e,function(e,n){t+=e+'="'+n+'" '});t+="/>";return t}function _mediaImg(e,t){var n=t.width,i=t.height,a=t.type||_mediaType(t.src),r=_mediaEmbed(t),o="";if(/\D/.test(n)){o+="width:"+n+";"}else if(n>0){o+="width:"+n+"px;"}if(/\D/.test(i)){o+="height:"+i+";"}else if(i>0){o+="height:"+i+"px;"}var l='<img class="'+_mediaClass(a)+'" src="'+e+'" ';if(o!==""){l+='style="'+o+'" '}l+='data-ke-tag="'+escape(r)+'" alt="" />';return l}function _tmpl(e,t){var n=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return t?n(t):n}K.formatUrl=_formatUrl;K.formatHtml=_formatHtml;K.getCssList=_getCssList;K.getAttrList=_getAttrList;K.mediaType=_mediaType;K.mediaAttrs=_mediaAttrs;K.mediaEmbed=_mediaEmbed;K.mediaImg=_mediaImg;K.clearMsWord=_clearMsWord;K.tmpl=_tmpl;function _contains(e,t){if(e.nodeType==9&&t.nodeType!=9){return true}while(t=t.parentNode){if(t==e){return true}}return false}var _getSetAttrDiv=document.createElement("div");_getSetAttrDiv.setAttribute("className","t");var _GET_SET_ATTRIBUTE=_getSetAttrDiv.className!=="t";function _getAttr(e,t){t=t.toLowerCase();var n=null;if(!_GET_SET_ATTRIBUTE&&e.nodeName.toLowerCase()!="script"){var i=e.ownerDocument.createElement("div");i.appendChild(e.cloneNode(false));var a=_getAttrList(_unescape(i.innerHTML));if(t in a){n=a[t]}}else{try{n=e.getAttribute(t,2)}catch(i){n=e.getAttribute(t,1)}}if(t==="style"&&n!==null){n=_formatCss(n)}return n}function _queryAll(e,t){var n=e.split(",");if(n.length>1){var i=[];_each(n,function(){_each(_queryAll(this,t),function(){if(_inArray(this,i)<0){i.push(this)}})});return i}t=t||document;function a(e){if(typeof e!="string"){return e}return e.replace(/([^\w\-])/g,"\\$1")}function r(e){return e.replace(/\\/g,"")}function o(e,t){return e==="*"||e.toLowerCase()===a(t.toLowerCase())}function l(e,t,n){var i=[],a=n.ownerDocument||n,l=a.getElementById(r(e));if(l){if(o(t,l.nodeName)&&_contains(n,l)){i.push(l)}}return i}function s(e,t,n){var i=n.ownerDocument||n,a=[],l,s,d,u;if(n.getElementsByClassName){l=n.getElementsByClassName(r(e));for(s=0,d=l.length;s<d;s++){u=l[s];if(o(t,u.nodeName)){a.push(u)}}}else if(i.querySelectorAll){l=i.querySelectorAll((n.nodeName!=="#document"?n.nodeName+" ":"")+t+"."+e);for(s=0,d=l.length;s<d;s++){u=l[s];if(_contains(n,u)){a.push(u)}}}else{l=n.getElementsByTagName(t);e=" "+e+" ";for(s=0,d=l.length;s<d;s++){u=l[s];if(u.nodeType==1){var c=u.className;if(c&&(" "+c+" ").indexOf(e)>-1){a.push(u)}}}}return a}function d(e,t,n){var i=[],a=n.ownerDocument||n,l=a.getElementsByName(r(e)),s;for(var d=0,u=l.length;d<u;d++){s=l[d];if(o(t,s.nodeName)&&_contains(n,s)){if(s.getAttribute("name")!==null){i.push(s)}}}return i}function u(e,t,n,i){var r=[],o=i.getElementsByTagName(n),l;for(var s=0,d=o.length;s<d;s++){l=o[s];if(l.nodeType==1){if(t===null){if(_getAttr(l,e)!==null){r.push(l)}}else{if(t===a(_getAttr(l,e))){r.push(l)}}}}return r}function c(e,t){var n=[],i;i=/^((?:\\.|[^.#\s\[<>])+)/.exec(e);var a=i?i[1]:"*";if(i=/#((?:[\w\-]|\\.)+)$/.exec(e)){n=l(i[1],a,t)}else if(i=/\.((?:[\w\-]|\\.)+)$/.exec(e)){n=s(i[1],a,t)}else if(i=/\[((?:[\w\-]|\\.)+)\]/.exec(e)){n=u(i[1].toLowerCase(),null,a,t)}else if(i=/\[((?:[\w\-]|\\.)+)\s*=\s*['"]?((?:\\.|[^'"]+)+)['"]?\]/.exec(e)){var r=i[1].toLowerCase(),o=i[2];if(r==="id"){n=l(o,a,t)}else if(r==="class"){n=s(o,a,t)}else if(r==="name"){n=d(o,a,t)}else{n=u(r,o,a,t)}}else{var c=t.getElementsByTagName(a),f;for(var p=0,h=c.length;p<h;p++){f=c[p];if(f.nodeType==1){n.push(f)}}}return n}var f=[],p,h=/((?:\\.|[^\s>])+|[\s>])/g;while(p=h.exec(e)){if(p[1]!==" "){f.push(p[1])}}var m=[];if(f.length==1){return c(f[0],t)}var g=false,v,_,b,y,k,w,S,E,C,x,T;for(w=0,lenth=f.length;w<lenth;w++){v=f[w];if(v===">"){g=true;continue}if(w>0){_=[];for(S=0,x=m.length;S<x;S++){y=m[S];b=c(v,y);for(E=0,T=b.length;E<T;E++){k=b[E];if(g){if(y===k.parentNode){_.push(k)}}else{_.push(k)}}}m=_}else{m=c(v,t)}if(m.length===0){return[]}}return m}function _query(e,t){var n=_queryAll(e,t);return n.length>0?n[0]:null}K.query=_query;K.queryAll=_queryAll;function _get(e){return K(e)[0]}function _getDoc(e){if(!e){return document}return e.ownerDocument||e.document||e}function _getWin(e){if(!e){return window}var t=_getDoc(e);return t.parentWindow||t.defaultView}function _setHtml(e,t){if(e.nodeType!=1){return}var n=_getDoc(e);try{e.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+t;var i=n.getElementById("__kindeditor_temp_tag__");i.parentNode.removeChild(i)}catch(i){K(e).empty();K("@"+t,n).each(function(){e.appendChild(this)})}}function _hasClass(e,t){return _inString(t,e.className," ")}function _setAttr(e,t,n){if(_IE&&_V<8&&t.toLowerCase()=="class"){t="className"}e.setAttribute(t,""+n)}function _removeAttr(e,t){if(_IE&&_V<8&&t.toLowerCase()=="class"){t="className"}_setAttr(e,t,"");e.removeAttribute(t)}function _getNodeName(e){if(!e||!e.nodeName){return""}return e.nodeName.toLowerCase()}function _computedCss(e,t){var n=this,i=_getWin(e),a=_toCamel(t),r="";if(i.getComputedStyle){var o=i.getComputedStyle(e,null);r=o[a]||o.getPropertyValue(t)||e.style[a]}else if(e.currentStyle){r=e.currentStyle[a]||e.style[a]}return r}function _hasVal(e){return!!_VALUE_TAG_MAP[_getNodeName(e)]}function _docElement(e){e=e||document;return _QUIRKS?e.body:e.documentElement}function _docHeight(e){var t=_docElement(e);return Math.max(t.scrollHeight,t.clientHeight)}function _docWidth(e){var t=_docElement(e);return Math.max(t.scrollWidth,t.clientWidth)}function _getScrollPos(e){e=e||document;var t,n;if(_IE||_NEWIE||_OPERA){t=_docElement(e).scrollLeft;n=_docElement(e).scrollTop}else{t=_getWin(e).scrollX;n=_getWin(e).scrollY}return{x:t,y:n}}function KNode(e){this.init(e)}_extend(KNode,{init:function(e){var t=this;e=_isArray(e)?e:[e];var n=0;for(var i=0,a=e.length;i<a;i++){if(e[i]){t[i]=e[i].constructor===KNode?e[i][0]:e[i];n++}}t.length=n;t.doc=_getDoc(t[0]);t.name=_getNodeName(t[0]);t.type=t.length>0?t[0].nodeType:null;t.win=_getWin(t[0])},each:function(e){var t=this;for(var n=0;n<t.length;n++){if(e.call(t[n],n,t[n])===false){return t}}return t},bind:function(e,t){this.each(function(){_bind(this,e,t)});return this},unbind:function(e,t){this.each(function(){_unbind(this,e,t)});return this},fire:function(e){if(this.length<1){return this}_fire(this[0],e);return this},hasAttr:function(e){if(this.length<1){return false}return!!_getAttr(this[0],e)},attr:function(e,t){var n=this;if(e===undefined){return _getAttrList(n.outer())}if(typeof e==="object"){_each(e,function(e,t){n.attr(e,t)});return n}if(t===undefined){t=n.length<1?null:_getAttr(n[0],e);return t===null?"":t}n.each(function(){_setAttr(this,e,t)});return n},removeAttr:function(e){this.each(function(){_removeAttr(this,e)});return this},get:function(e){if(this.length<1){return null}return this[e||0]},eq:function(e){if(this.length<1){return null}return this[e]?new KNode(this[e]):null},hasClass:function(e){if(this.length<1){return false}return _hasClass(this[0],e)},addClass:function(e){this.each(function(){if(!_hasClass(this,e)){this.className=_trim(this.className+" "+e)}});return this},removeClass:function(e){this.each(function(){if(_hasClass(this,e)){this.className=_trim(this.className.replace(new RegExp("(^|\\s)"+e+"(\\s|$)")," "))}});return this},html:function(e){var t=this;if(e===undefined){if(t.length<1||t.type!=1){return""}return _formatHtml(t[0].innerHTML)}t.each(function(){_setHtml(this,e)});return t},text:function(){var e=this;if(e.length<1){return""}return _IE?e[0].innerText:e[0].textContent},hasVal:function(){if(this.length<1){return false}return _hasVal(this[0])},val:function(e){var t=this;if(e===undefined){if(t.length<1){return""}return t.hasVal()?t[0].value:t.attr("value")}else{t.each(function(){if(_hasVal(this)){this.value=e}else{_setAttr(this,"value",e)}});return t}},css:function(e,t){var n=this;if(e===undefined){return _getCssList(n.attr("style"))}if(typeof e==="object"){_each(e,function(e,t){n.css(e,t)});return n}if(t===undefined){if(n.length<1){return""}return n[0].style[_toCamel(e)]||_computedCss(n[0],e)||""}n.each(function(){this.style[_toCamel(e)]=t});return n},width:function(e){var t=this;if(e===undefined){if(t.length<1){return 0}return t[0].offsetWidth}return t.css("width",_addUnit(e))},height:function(e){var t=this;if(e===undefined){if(t.length<1){return 0}return t[0].offsetHeight}return t.css("height",_addUnit(e))},opacity:function(e){this.each(function(){if(this.style.opacity===undefined){this.style.filter=e==1?"":"alpha(opacity="+e*100+")"}else{this.style.opacity=e==1?"":e}});return this},data:function(e,t){var n=this;e="kindeditor_data_"+e;if(t===undefined){if(n.length<1){return null}return n[0][e]}this.each(function(){this[e]=t});return n},pos:function(){var e=this,t=e[0],n=0,i=0;if(t){if(t.getBoundingClientRect){var a=t.getBoundingClientRect(),r=_getScrollPos(e.doc);n=a.left+r.x;i=a.top+r.y}else{while(t){n+=t.offsetLeft;i+=t.offsetTop;t=t.offsetParent}}}return{x:_round(n),y:_round(i)}},clone:function(e){if(this.length<1){return new KNode([])}return new KNode(this[0].cloneNode(e))},append:function(e){this.each(function(){if(this.appendChild){this.appendChild(_get(e))}});return this},appendTo:function(e){this.each(function(){_get(e).appendChild(this)});return this},before:function(e){this.each(function(){this.parentNode.insertBefore(_get(e),this)});return this},after:function(e){this.each(function(){if(this.nextSibling){this.parentNode.insertBefore(_get(e),this.nextSibling)}else{this.parentNode.appendChild(_get(e))}});return this},replaceWith:function(e){var t=[];this.each(function(n,i){_unbind(i);var a=_get(e);i.parentNode.replaceChild(a,i);t.push(a)});return K(t)},empty:function(){var e=this;e.each(function(e,t){var n=t.firstChild;while(n){if(!t.parentNode){return}var i=n.nextSibling;n.parentNode.removeChild(n);n=i}});return e},remove:function(e){var t=this;t.each(function(n,i){if(!i.parentNode){return}_unbind(i);if(e){var a=i.firstChild;while(a){var r=a.nextSibling;i.parentNode.insertBefore(a,i);a=r}}i.parentNode.removeChild(i);delete t[n]});t.length=0;return t},show:function(e){var t=this;if(e===undefined){e=t._originDisplay||""}if(t.css("display")!="none"){return t}return t.css("display",e)},hide:function(){var e=this;if(e.length<1){return e}e._originDisplay=e[0].style.display;return e.css("display","none")},outer:function(){var e=this;if(e.length<1){return""}var t=e.doc.createElement("div"),n;t.appendChild(e[0].cloneNode(true));n=_formatHtml(t.innerHTML);t=null;return n},isSingle:function(){return!!_SINGLE_TAG_MAP[this.name]},isInline:function(){return!!_INLINE_TAG_MAP[this.name]},isBlock:function(){return!!_BLOCK_TAG_MAP[this.name]},isStyle:function(){return!!_STYLE_TAG_MAP[this.name]},isControl:function(){return!!_CONTROL_TAG_MAP[this.name]},contains:function(e){if(this.length<1){return false}return _contains(this[0],_get(e))},parent:function(){if(this.length<1){return null}var e=this[0].parentNode;return e?new KNode(e):null},children:function(){if(this.length<1){return new KNode([])}var e=[],t=this[0].firstChild;while(t){if(t.nodeType!=3||_trim(t.nodeValue)!==""){e.push(t)}t=t.nextSibling}return new KNode(e)},first:function(){var e=this.children();return e.length>0?e.eq(0):null},last:function(){var e=this.children();return e.length>0?e.eq(e.length-1):null},index:function(){if(this.length<1){return-1}var e=-1,t=this[0];while(t){e++;t=t.previousSibling}return e},prev:function(){if(this.length<1){return null}var e=this[0].previousSibling;return e?new KNode(e):null},next:function(){if(this.length<1){return null}var e=this[0].nextSibling;return e?new KNode(e):null},scan:function(e,t){if(this.length<1){return}t=t===undefined?true:t;function n(i){var a=t?i.firstChild:i.lastChild;while(a){var r=t?a.nextSibling:a.previousSibling;if(e(a)===false){return false}if(n(a)===false){return false}a=r}}n(this[0]);return this}});_each(("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,"+"mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,"+"change,select,submit,keydown,keypress,keyup,error,contextmenu").split(","),function(e,t){KNode.prototype[t]=function(e){return e?this.bind(t,e):this.fire(t)}});var _K=K;K=function(e,t){if(e===undefined||e===null){return}function n(e){if(!e[0]){e=[]}return new KNode(e)}if(typeof e==="string"){if(t){t=_get(t)}var i=e.length;if(e.charAt(0)==="@"){e=e.substr(1)}if(e.length!==i||/<.+>/.test(e)){var a=t?t.ownerDocument||t:document,r=a.createElement("div"),o=[];r.innerHTML='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+e;for(var l=0,s=r.childNodes.length;l<s;l++){var d=r.childNodes[l];if(d.id=="__kindeditor_temp_tag__"){continue}o.push(d)}return n(o)}return n(_queryAll(e,t))}if(e&&e.constructor===KNode){return e}if(e.toArray){e=e.toArray()}if(_isArray(e)){return n(e)}return n(_toArray(arguments))};_each(_K,function(e,t){K[e]=t});K.NodeClass=KNode;window.KindEditor=K;var _START_TO_START=0,_START_TO_END=1,_END_TO_END=2,_END_TO_START=3,_BOOKMARK_ID=0;function _updateCollapsed(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;return e}function _copyAndDelete(e,t,n){var i=e.doc,a=[];function r(i,r,o){var l=i.nodeValue.length,s;if(t){var d=i.cloneNode(true);if(r>0){s=d.splitText(r)}else{s=d}if(o<l){s.splitText(o-r)}}if(n){var u=i;if(r>0){u=i.splitText(r);e.setStart(i,r)}if(o<l){var c=u.splitText(o-r);e.setEnd(c,0)}a.push(u)}return s}function o(){if(n){e.up().collapse(true)}for(var t=0,i=a.length;t<i;t++){var r=a[t];if(r.parentNode){r.parentNode.removeChild(r)}}}var l=e.cloneRange().down();var s=-1,d=-1,u=-1,c=-1,f=e.commonAncestor(),p=i.createDocumentFragment();if(f.nodeType==3){var h=r(f,e.startOffset,e.endOffset);if(t){p.appendChild(h)}o();return t?p:e}function m(o,f){var p=o.firstChild,h;while(p){var g=new KRange(i).selectNode(p);s=g.compareBoundaryPoints(_START_TO_END,e);if(s>=0&&d<=0){d=g.compareBoundaryPoints(_START_TO_START,e)}if(d>=0&&u<=0){u=g.compareBoundaryPoints(_END_TO_END,e)}if(u>=0&&c<=0){c=g.compareBoundaryPoints(_END_TO_START,e)}if(c>=0){return false}h=p.nextSibling;if(s>0){if(p.nodeType==1){if(d>=0&&u<=0){if(t){f.appendChild(p.cloneNode(true))}if(n){a.push(p)}}else{var v;if(t){v=p.cloneNode(false);f.appendChild(v)}if(m(p,v)===false){return false}}}else if(p.nodeType==3){var _;if(p==l.startContainer){_=r(p,l.startOffset,p.nodeValue.length)}else if(p==l.endContainer){_=r(p,0,l.endOffset)}else{_=r(p,0,p.nodeValue.length)}if(t){try{f.appendChild(_)}catch(e){}}}}p=h}}m(f,p);if(n){e.up().collapse(true)}for(var g=0,v=a.length;g<v;g++){var _=a[g];if(_.parentNode){_.parentNode.removeChild(_)}}return t?p:e}function _moveToElementText(e,t){var n=t;while(n){var i=K(n);if(i.name=="marquee"||i.name=="select"){return}n=n.parentNode}try{e.moveToElementText(t)}catch(e){}}function _getStartEnd(e,t){var n=e.parentElement().ownerDocument,i=e.duplicate();i.collapse(t);var a=i.parentElement(),r=a.childNodes;if(r.length===0){return{node:a.parentNode,offset:K(a).index()}}var o=n,l=0,s=-1;var d=e.duplicate();_moveToElementText(d,a);for(var u=0,c=r.length;u<c;u++){var f=r[u];s=d.compareEndPoints("StartToStart",i);if(s===0){return{node:f.parentNode,offset:u}}if(f.nodeType==1){var p=e.duplicate(),h,m=K(f),g=f;if(m.isControl()){h=n.createElement("span");m.after(h);g=h;l+=m.text().replace(/\r\n|\n|\r/g,"").length}_moveToElementText(p,g);d.setEndPoint("StartToEnd",p);if(s>0){l+=p.text.replace(/\r\n|\n|\r/g,"").length}else{l=0}if(h){K(h).remove()}}else if(f.nodeType==3){d.moveStart("character",f.nodeValue.length);l+=f.nodeValue.length}if(s<0){o=f}}if(s<0&&o.nodeType==1){return{node:a,offset:K(a.lastChild).index()+1}}if(s>0){while(o.nextSibling&&o.nodeType==1){o=o.nextSibling}}d=e.duplicate();_moveToElementText(d,a);d.setEndPoint("StartToEnd",i);l-=d.text.replace(/\r\n|\n|\r/g,"").length;if(s>0&&o.nodeType==3){var v=o.previousSibling;while(v&&v.nodeType==3){l-=v.nodeValue.length;v=v.previousSibling}}return{node:o,offset:l}}function _getEndRange(e,t){var n=e.ownerDocument||e,i=n.body.createTextRange();if(n==e){i.collapse(true);return i}if(e.nodeType==1&&e.childNodes.length>0){var a=e.childNodes,r,o;if(t===0){o=a[0];r=true}else{o=a[t-1];r=false}if(!o){return i}if(K(o).name==="head"){if(t===1){r=true}if(t===2){r=false}i.collapse(r);return i}if(o.nodeType==1){var l=K(o),s;if(l.isControl()){s=n.createElement("span");if(r){l.before(s)}else{l.after(s)}o=s}_moveToElementText(i,o);i.collapse(r);if(s){K(s).remove()}return i}e=o;t=r?0:o.nodeValue.length}var d=n.createElement("span");K(e).before(d);_moveToElementText(i,d);i.moveStart("character",t);K(d).remove();return i}function _toRange(e){var t,n;function i(e){if(K(e.node).name=="tr"){e.node=e.node.cells[e.offset];e.offset=0}}if(_IERANGE){if(e.item){t=_getDoc(e.item(0));n=new KRange(t);n.selectNode(e.item(0));return n}t=e.parentElement().ownerDocument;var a=_getStartEnd(e,true),r=_getStartEnd(e,false);i(a);i(r);n=new KRange(t);n.setStart(a.node,a.offset);n.setEnd(r.node,r.offset);return n}var o=e.startContainer;t=o.ownerDocument||o;n=new KRange(t);n.setStart(o,e.startOffset);n.setEnd(e.endContainer,e.endOffset);return n}function KRange(e){this.init(e)}_extend(KRange,{init:function(e){var t=this;t.startContainer=e;t.startOffset=0;t.endContainer=e;t.endOffset=0;t.collapsed=true;t.doc=e},commonAncestor:function(){function e(e){var t=[];while(e){t.push(e);e=e.parentNode}return t}var t=e(this.startContainer),n=e(this.endContainer),i=0,a=t.length,r=n.length,o,l;while(++i){o=t[a-i];l=n[r-i];if(!o||!l||o!==l){break}}return t[a-i+1]},setStart:function(e,t){var n=this,i=n.doc;n.startContainer=e;n.startOffset=t;if(n.endContainer===i){n.endContainer=e;n.endOffset=t}return _updateCollapsed(this)},setEnd:function(e,t){var n=this,i=n.doc;n.endContainer=e;n.endOffset=t;if(n.startContainer===i){n.startContainer=e;n.startOffset=t}return _updateCollapsed(this)},setStartBefore:function(e){return this.setStart(e.parentNode||this.doc,K(e).index())},setStartAfter:function(e){return this.setStart(e.parentNode||this.doc,K(e).index()+1)},setEndBefore:function(e){return this.setEnd(e.parentNode||this.doc,K(e).index())},setEndAfter:function(e){return this.setEnd(e.parentNode||this.doc,K(e).index()+1)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){var t=K(e);if(t.type==3||t.isSingle()){return this.selectNode(e)}var n=t.children();if(n.length>0){return this.setStartBefore(n[0]).setEndAfter(n[n.length-1])}return this.setStart(e,0).setEnd(e,0)},collapse:function(e){if(e){return this.setEnd(this.startContainer,this.startOffset)}return this.setStart(this.endContainer,this.endOffset)},compareBoundaryPoints:function(e,t){var n=this.get(),i=t.get();if(_IERANGE){var a={};a[_START_TO_START]="StartToStart";a[_START_TO_END]="EndToStart";a[_END_TO_END]="EndToEnd";a[_END_TO_START]="StartToEnd";var r=n.compareEndPoints(a[e],i);if(r!==0){return r}var o,l,s,d,u;if(e===_START_TO_START||e===_END_TO_START){o=this.startContainer;d=this.startOffset}if(e===_START_TO_END||e===_END_TO_END){o=this.endContainer;d=this.endOffset}if(e===_START_TO_START||e===_START_TO_END){l=t.startContainer;u=t.startOffset}if(e===_END_TO_END||e===_END_TO_START){l=t.endContainer;u=t.endOffset}if(o===l){var c=d-u;return c>0?1:c<0?-1:0}s=l;while(s&&s.parentNode!==o){s=s.parentNode}if(s){return K(s).index()>=d?-1:1}s=o;while(s&&s.parentNode!==l){s=s.parentNode}if(s){return K(s).index()>=u?1:-1}s=K(l).next();if(s&&s.contains(o)){return 1}s=K(o).next();if(s&&s.contains(l)){return-1}}else{return n.compareBoundaryPoints(e,i)}},cloneRange:function(){return new KRange(this.doc).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},toString:function(){var e=this.get(),t=_IERANGE?e.text:e.toString();return t.replace(/\r\n|\n|\r/g,"")},cloneContents:function(){return _copyAndDelete(this,true,false)},deleteContents:function(){return _copyAndDelete(this,false,true)},extractContents:function(){return _copyAndDelete(this,true,true)},insertNode:function(e){var t=this,n=t.startContainer,i=t.startOffset,a=t.endContainer,r=t.endOffset,o,l,s,d=1;if(e.nodeName.toLowerCase()==="#document-fragment"){o=e.firstChild;l=e.lastChild;d=e.childNodes.length}if(n.nodeType==1){s=n.childNodes[i];if(s){n.insertBefore(e,s);if(n===a){r+=d}}else{n.appendChild(e)}}else if(n.nodeType==3){if(i===0){n.parentNode.insertBefore(e,n);if(n.parentNode===a){r+=d}}else if(i>=n.nodeValue.length){if(n.nextSibling){n.parentNode.insertBefore(e,n.nextSibling)}else{n.parentNode.appendChild(e)}}else{if(i>0){s=n.splitText(i)}else{s=n}n.parentNode.insertBefore(e,s);if(n===a){a=s;r-=i}}}if(o){t.setStartBefore(o).setEndAfter(l)}else{t.selectNode(e)}if(t.compareBoundaryPoints(_END_TO_END,t.cloneRange().setEnd(a,r))>=1){return t}return t.setEnd(a,r)},surroundContents:function(e){e.appendChild(this.extractContents());return this.insertNode(e).selectNode(e)},isControl:function(){var e=this,t=e.startContainer,n=e.startOffset,i=e.endContainer,a=e.endOffset,r;return t.nodeType==1&&t===i&&n+1===a&&K(t.childNodes[n]).isControl()},get:function(e){var t=this,n=t.doc,i,a;if(!_IERANGE){a=n.createRange();try{a.setStart(t.startContainer,t.startOffset);a.setEnd(t.endContainer,t.endOffset)}catch(e){}return a}if(e&&t.isControl()){a=n.body.createControlRange();a.addElement(t.startContainer.childNodes[t.startOffset]);return a}var r=t.cloneRange().down();a=n.body.createTextRange();a.setEndPoint("StartToStart",_getEndRange(r.startContainer,r.startOffset));a.setEndPoint("EndToStart",_getEndRange(r.endContainer,r.endOffset));return a},html:function(){return K(this.cloneContents()).outer()},down:function(){var e=this;function t(t,n,i){if(t.nodeType!=1){return}var a=K(t).children();if(a.length===0){return}var r,o,l,s;if(n>0){r=a.eq(n-1)}if(n<a.length){o=a.eq(n)}if(r&&r.type==3){l=r[0];s=l.nodeValue.length}if(o&&o.type==3){l=o[0];s=0}if(!l){return}if(i){e.setStart(l,s)}else{e.setEnd(l,s)}}t(e.startContainer,e.startOffset,true);t(e.endContainer,e.endOffset,false);return e},up:function(){var e=this;function t(t,n,i){if(t.nodeType!=3){return}if(n===0){if(i){e.setStartBefore(t)}else{e.setEndBefore(t)}}else if(n==t.nodeValue.length){if(i){e.setStartAfter(t)}else{e.setEndAfter(t)}}}t(e.startContainer,e.startOffset,true);t(e.endContainer,e.endOffset,false);return e},enlarge:function(e){var t=this;t.up();function n(n,i,a){var r=K(n),o;if(r.type==3||_NOSPLIT_TAG_MAP[r.name]||!e&&r.isBlock()){return}if(i===0){while(!r.prev()){o=r.parent();if(!o||_NOSPLIT_TAG_MAP[o.name]||!e&&o.isBlock()){break}r=o}if(a){t.setStartBefore(r[0])}else{t.setEndBefore(r[0])}}else if(i==r.children().length){while(!r.next()){o=r.parent();if(!o||_NOSPLIT_TAG_MAP[o.name]||!e&&o.isBlock()){break}r=o}if(a){t.setStartAfter(r[0])}else{t.setEndAfter(r[0])}}}n(t.startContainer,t.startOffset,true);n(t.endContainer,t.endOffset,false);return t},shrink:function(){var e=this,t,n=e.collapsed;while(e.startContainer.nodeType==1&&(t=e.startContainer.childNodes[e.startOffset])&&t.nodeType==1&&!K(t).isSingle()){e.setStart(t,0)}if(n){return e.collapse(n)}while(e.endContainer.nodeType==1&&e.endOffset>0&&(t=e.endContainer.childNodes[e.endOffset-1])&&t.nodeType==1&&!K(t).isSingle()){e.setEnd(t,t.childNodes.length)}return e},createBookmark:function(e){var t=this,n=t.doc,i,a=K('<span style="display:none;"></span>',n)[0];a.id="__kindeditor_bookmark_start_"+_BOOKMARK_ID+++"__";if(!t.collapsed){i=a.cloneNode(true);i.id="__kindeditor_bookmark_end_"+_BOOKMARK_ID+++"__"}if(i){t.cloneRange().collapse(false).insertNode(i).setEndBefore(i)}t.insertNode(a).setStartAfter(a);return{start:e?"#"+a.id:a,end:i?e?"#"+i.id:i:null}},moveToBookmark:function(e){var t=this,n=t.doc,i=K(e.start,n),a=e.end?K(e.end,n):null;if(!i||i.length<1){return t}t.setStartBefore(i[0]);i.remove();if(a&&a.length>0){t.setEndBefore(a[0]);a.remove()}else{t.collapse(true)}return t},dump:function(){console.log("--------------------");console.log(this.startContainer.nodeType==3?this.startContainer.nodeValue:this.startContainer,this.startOffset);console.log(this.endContainer.nodeType==3?this.endContainer.nodeValue:this.endContainer,this.endOffset)}});function _range(e){if(!e.nodeName){return e.constructor===KRange?e:_toRange(e)}return new KRange(e)}K.RangeClass=KRange;K.range=_range;K.START_TO_START=_START_TO_START;K.START_TO_END=_START_TO_END;K.END_TO_END=_END_TO_END;K.END_TO_START=_END_TO_START;function _nativeCommand(e,t,n){try{e.execCommand(t,false,n)}catch(e){}}function _nativeCommandValue(e,t){var n="";try{n=e.queryCommandValue(t)}catch(e){}if(typeof n!=="string"){n=""}return n}function _getSel(e){var t=_getWin(e);return _IERANGE?e.selection:t.getSelection()}function _getRng(e){var t=_getSel(e),n;try{if(t.rangeCount>0){n=t.getRangeAt(0)}else{n=t.createRange()}}catch(e){}if(_IERANGE&&(!n||!n.item&&n.parentElement().ownerDocument!==e)){return null}return n}function _singleKeyMap(e){var t={},n,i;_each(e,function(e,a){n=e.split(",");for(var r=0,o=n.length;r<o;r++){i=n[r];t[i]=a}});return t}function _hasAttrOrCss(e,t){return _hasAttrOrCssByKey(e,t,"*")||_hasAttrOrCssByKey(e,t)}function _hasAttrOrCssByKey(e,t,n){n=n||e.name;if(e.type!==1){return false}var i=_singleKeyMap(t);if(!i[n]){return false}var a=i[n].split(",");for(var r=0,o=a.length;r<o;r++){var l=a[r];if(l==="*"){return true}var s=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(l);var d=s[1]?"css":"attr";l=s[2];var u=s[3]||"";if(u===""&&e[d](l)!==""){return true}if(u!==""&&e[d](l)===u){return true}}return false}function _removeAttrOrCss(e,t){if(e.type!=1){return}_removeAttrOrCssByKey(e,t,"*");_removeAttrOrCssByKey(e,t)}function _removeAttrOrCssByKey(e,t,n){n=n||e.name;if(e.type!==1){return}var i=_singleKeyMap(t);if(!i[n]){return}var a=i[n].split(","),r=false;for(var o=0,l=a.length;o<l;o++){var s=a[o];if(s==="*"){r=true;break}var d=/^(\.?)([^=]+)(?:=([^=]*))?$/.exec(s);s=d[2];if(d[1]){s=_toCamel(s);if(e[0].style[s]){e[0].style[s]=""}}else{e.removeAttr(s)}}if(r){e.remove(true)}}function _getInnerNode(e){var t=e;while(t.first()){t=t.first()}return t}function _isEmptyNode(e){if(e.type!=1||e.isSingle()){return false}return e.html().replace(/<[^>]+>/g,"")===""}function _mergeWrapper(e,t){e=e.clone(true);var n=_getInnerNode(e),i=e,a=false;while(t){while(i){if(i.name===t.name){_mergeAttrs(i,t.attr(),t.css());a=true}i=i.first()}if(!a){n.append(t.clone(false))}a=false;t=t.first()}return e}function _wrapNode(e,t){t=t.clone(true);if(e.type==3){_getInnerNode(t).append(e.clone(false));e.replaceWith(t);return t}var n=e,i;while((i=e.first())&&i.children().length==1){e=i}i=e.first();var a=e.doc.createDocumentFragment();while(i){a.appendChild(i[0]);i=i.next()}t=_mergeWrapper(n,t);if(a.firstChild){_getInnerNode(t).append(a)}n.replaceWith(t);return t}function _mergeAttrs(e,t,n){_each(t,function(t,n){if(t!=="style"){e.attr(t,n)}});_each(n,function(t,n){e.css(t,n)})}function _inPreElement(e){while(e&&e.name!="body"){if(_PRE_TAG_MAP[e.name]||e.name=="div"&&e.hasClass("ke-script")){return true}e=e.parent()}return false}function KCmd(e){this.init(e)}_extend(KCmd,{init:function(e){var t=this,n=e.doc;t.doc=n;t.win=_getWin(n);t.sel=_getSel(n);t.range=e},selection:function(e){var t=this,n=t.doc,i=_getRng(n);t.sel=_getSel(n);if(i){t.range=_range(i);if(K(t.range.startContainer).name=="html"){t.range.selectNodeContents(n.body).collapse(false)}return t}if(e){t.range.selectNodeContents(n.body).collapse(false)}return t},select:function(e){e=_undef(e,true);var t=this,n=t.sel,i=t.range.cloneRange().shrink(),a=i.startContainer,r=i.startOffset,o=i.endContainer,l=i.endOffset,s=_getDoc(a),d=t.win,u,c=false;if(e&&a.nodeType==1&&i.collapsed){if(_IERANGE){var f=K("<span>&nbsp;</span>",s);i.insertNode(f[0]);u=s.body.createTextRange();try{u.moveToElementText(f[0])}catch(e){}u.collapse(false);u.select();f.remove();d.focus();return t}if(_WEBKIT){var p=a.childNodes;if(K(a).isInline()||r>0&&K(p[r-1]).isInline()||p[r]&&K(p[r]).isInline()){i.insertNode(s.createTextNode("​"));c=true}}}if(_IERANGE){try{u=i.get(true);u.select()}catch(e){}}else{if(c){i.collapse(false)}u=i.get(true);n.removeAllRanges();n.addRange(u);if(s!==document){var h=K(u.endContainer).pos();d.scrollTo(h.x,h.y)}}d.focus();return t},wrap:function(e){var t=this,n=t.doc,i=t.range,a;a=K(e,n);if(i.collapsed){i.shrink();i.insertNode(a[0]).selectNodeContents(a[0]);return t}if(a.isBlock()){var r=a.clone(true),o=r;while(o.first()){o=o.first()}o.append(i.extractContents());i.insertNode(r[0]).selectNode(r[0]);return t}i.enlarge();var l=i.createBookmark(),s=i.commonAncestor(),d=false;K(s).scan(function(e){if(!d&&e==l.start){d=true;return}if(d){if(e==l.end){return false}var t=K(e);if(_inPreElement(t)){return}if(t.type==3&&_trim(e.nodeValue).length>0){var n;while((n=t.parent())&&n.isStyle()&&n.children().length==1){t=n}_wrapNode(t,a)}}});i.moveToBookmark(l);return t},split:function(e,t){var n=this.range,i=n.doc;var a=n.cloneRange().collapse(e);var r=a.startContainer,o=a.startOffset,l=r.nodeType==3?r.parentNode:r,s=false,d;while(l&&l.parentNode){d=K(l);if(t){if(!d.isStyle()){break}if(!_hasAttrOrCss(d,t)){break}}else{if(_NOSPLIT_TAG_MAP[d.name]){break}}s=true;l=l.parentNode}if(s){var u=i.createElement("span");n.cloneRange().collapse(!e).insertNode(u);if(e){a.setStartBefore(l.firstChild).setEnd(r,o)}else{a.setStart(r,o).setEndAfter(l.lastChild)}var c=a.extractContents(),f=c.firstChild,p=c.lastChild;if(e){a.insertNode(c);n.setStartAfter(p).setEndBefore(u)}else{l.appendChild(c);n.setStartBefore(u).setEndBefore(f)}var h=u.parentNode;if(h==n.endContainer){var m=K(u).prev(),g=K(u).next();if(m&&g&&m.type==3&&g.type==3){n.setEnd(m[0],m[0].nodeValue.length)}else if(!e){n.setEnd(n.endContainer,n.endOffset-1)}}h.removeChild(u)}return this},remove:function(e){var t=this,n=t.doc,i=t.range;i.enlarge();if(i.startOffset===0){var a=K(i.startContainer),r;while((r=a.parent())&&r.isStyle()&&r.children().length==1){a=r}i.setStart(a[0],0);a=K(i.startContainer);if(a.isBlock()){_removeAttrOrCss(a,e)}var o=a.parent();if(o&&o.isBlock()){_removeAttrOrCss(o,e)}}var l,s;if(i.collapsed){t.split(true,e);l=i.startContainer;s=i.startOffset;if(s>0){var d=K(l.childNodes[s-1]);if(d&&_isEmptyNode(d)){d.remove();i.setStart(l,s-1)}}var u=K(l.childNodes[s]);if(u&&_isEmptyNode(u)){u.remove()}if(_isEmptyNode(l)){i.startBefore(l);l.remove()}i.collapse(true);return t}t.split(true,e);t.split(false,e);var c=n.createElement("span"),f=n.createElement("span");i.cloneRange().collapse(false).insertNode(f);i.cloneRange().collapse(true).insertNode(c);var p=[],h=false;K(i.commonAncestor()).scan(function(e){if(!h&&e==c){h=true;return}if(e==f){return false}if(h){p.push(e)}});K(c).remove();K(f).remove();l=i.startContainer;s=i.startOffset;var m=i.endContainer,g=i.endOffset;if(s>0){var v=K(l.childNodes[s-1]);if(v&&_isEmptyNode(v)){v.remove();i.setStart(l,s-1);if(l==m){i.setEnd(m,g-1)}}var _=K(l.childNodes[s]);if(_&&_isEmptyNode(_)){_.remove();if(l==m){i.setEnd(m,g-1)}}}var b=K(m.childNodes[i.endOffset]);if(b&&_isEmptyNode(b)){b.remove()}var y=i.createBookmark(true);_each(p,function(t,n){_removeAttrOrCss(K(n),e)});i.moveToBookmark(y);return t},commonNode:function(e){var t=this.range;var n=t.endContainer,i=t.endOffset,a=n.nodeType==3||i===0?n:n.childNodes[i-1];function r(t){var n=t,i=t;while(i){if(_hasAttrOrCss(K(i),e)){return K(i)}i=i.parentNode}while(n&&(n=n.lastChild)){if(_hasAttrOrCss(K(n),e)){return K(n)}}return null}var o=r(a);if(o){return o}if(a.nodeType==1||n.nodeType==3&&i===0){var l=K(a).prev();if(l){return r(l)}}return null},commonAncestor:function(e){var t=this.range,n=t.startContainer,i=t.startOffset,a=t.endContainer,r=t.endOffset,o=n.nodeType==3||i===0?n:n.childNodes[i-1],l=a.nodeType==3||r===0?a:a.childNodes[r-1];function s(t){while(t){if(t.nodeType==1){if(t.tagName.toLowerCase()===e){return t}}t=t.parentNode}return null}var d=s(o),u=s(l);if(d&&u&&d===u){return K(d)}return null},state:function(e){var t=this,n=t.doc,i=false;try{i=n.queryCommandState(e)}catch(e){}return i},val:function(e){var t=this,n=t.doc,i=t.range;function a(e){return e.toLowerCase()}e=a(e);var r="",o;if(e==="fontfamily"||e==="fontname"){r=_nativeCommandValue(n,"fontname");r=r.replace(/['"]/g,"");return a(r)}if(e==="formatblock"){r=_nativeCommandValue(n,e);if(r===""){o=t.commonNode({"h1,h2,h3,h4,h5,h6,p,div,pre,address":"*"});if(o){r=o.name}}if(r==="Normal"){r="p"}return a(r)}if(e==="fontsize"){o=t.commonNode({"*":".font-size"});if(o){r=o.css("font-size")}return a(r)}if(e==="forecolor"){o=t.commonNode({"*":".color"});if(o){r=o.css("color")}r=_toHex(r);if(r===""){r="default"}return a(r)}if(e==="hilitecolor"){o=t.commonNode({"*":".background-color"});if(o){r=o.css("background-color")}r=_toHex(r);if(r===""){r="default"}return a(r)}return r},toggle:function(e,t){var n=this;if(n.commonNode(t)){n.remove(t)}else{n.wrap(e)}return n.select()},bold:function(){return this.toggle("<strong></strong>",{span:".font-weight=bold",strong:"*",b:"*"})},italic:function(){return this.toggle("<em></em>",{span:".font-style=italic",em:"*",i:"*"})},underline:function(){return this.toggle("<u></u>",{span:".text-decoration=underline",u:"*"})},strikethrough:function(){return this.toggle("<s></s>",{span:".text-decoration=line-through",s:"*"})},forecolor:function(e){return this.wrap('<span style="color:'+e+';"></span>').select()},hilitecolor:function(e){return this.wrap('<span style="background-color:'+e+';"></span>').select()},fontsize:function(e){return this.wrap('<span style="font-size:'+e+';"></span>').select()},fontname:function(e){return this.fontfamily(e)},fontfamily:function(e){return this.wrap('<span style="font-family:'+e+';"></span>').select()},removeformat:function(){var e={"*":".font-weight,.font-style,.text-decoration,.color,.background-color,.font-size,.font-family,.text-indent"},t=_STYLE_TAG_MAP;_each(t,function(t,n){e[t]="*"});this.remove(e);return this.select()},inserthtml:function(e,t){var n=this,i=n.range;if(e===""){return n}function a(e,t){t='<img id="__kindeditor_temp_tag__" width="0" height="0" style="display:none;" />'+t;var i=e.get();if(i.item){i.item(0).outerHTML=t}else{i.pasteHTML(t)}var a=e.doc.getElementById("__kindeditor_temp_tag__");a.parentNode.removeChild(a);var r=_toRange(i);e.setEnd(r.endContainer,r.endOffset);e.collapse(false);n.select(false)}function r(e,t){var i=e.doc,a=i.createDocumentFragment();K("@"+t,i).each(function(){a.appendChild(this)});e.deleteContents();e.insertNode(a);e.collapse(false);n.select(false)}if(_IERANGE&&t){try{a(i,e)}catch(t){r(i,e)}return n}r(i,e);return n},hr:function(){return this.inserthtml("<hr />")},print:function(){this.win.print();return this},insertimage:function(e,t,n,i,a,r){t=_undef(t,"");a=_undef(a,0);var o='<img src="'+_escape(e)+'" data-ke-src="'+_escape(e)+'" ';if(n){o+='width="'+_escape(n)+'" '}if(i){o+='height="'+_escape(i)+'" '}if(t){o+='title="'+_escape(t)+'" '}if(r){o+='align="'+_escape(r)+'" '}o+='alt="'+_escape(t)+'" ';o+="/>";return this.inserthtml(o)},createlink:function(e,t){var n=this,i=n.doc,a=n.range;n.select();var r=n.commonNode({a:"*"});if(r&&!a.isControl()){a.selectNode(r.get());n.select()}var o='<a href="'+_escape(e)+'" data-ke-src="'+_escape(e)+'" ';if(t){o+=' target="'+_escape(t)+'"'}if(a.collapsed){o+=">"+_escape(e)+"</a>";return n.inserthtml(o)}if(a.isControl()){var l=K(a.startContainer.childNodes[a.startOffset]);o+="></a>";l.after(K(o,i));l.next().append(l);a.selectNode(l[0]);return n.select()}function s(e,t,n){K(e).attr("href",t).attr("data-ke-src",t);if(n){K(e).attr("target",n)}else{K(e).removeAttr("target")}}var d=a.startContainer,u=a.startOffset,c=a.endContainer,f=a.endOffset;if(d.nodeType==1&&d===c&&u+1===f){var p=d.childNodes[u];if(p.nodeName.toLowerCase()=="a"){s(p,e,t);return n}}_nativeCommand(i,"createlink","__kindeditor_temp_url__");K('a[href="__kindeditor_temp_url__"]',i).each(function(){s(this,e,t)});return n},unlink:function(){var e=this,t=e.doc,n=e.range;e.select();if(n.collapsed){var i=e.commonNode({a:"*"});if(i){n.selectNode(i.get());e.select()}_nativeCommand(t,"unlink",null);if(_WEBKIT&&K(n.startContainer).name==="img"){var a=K(n.startContainer).parent();if(a.name==="a"){a.remove(true)}}}else{_nativeCommand(t,"unlink",null)}return e}});_each(("formatblock,selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,"+"insertunorderedlist,indent,outdent,subscript,superscript").split(","),function(e,t){KCmd.prototype[t]=function(e){var n=this;n.select();_nativeCommand(n.doc,t,e);if(_IERANGE&&_inArray(t,"justifyleft,justifycenter,justifyright,justifyfull".split(","))>=0){n.selection()}if(!_IERANGE||_inArray(t,"formatblock,selectall,insertorderedlist,insertunorderedlist".split(","))>=0){n.selection()}return n}});_each("cut,copy,paste".split(","),function(e,t){KCmd.prototype[t]=function(){var e=this;if(!e.doc.queryCommandSupported(t)){throw"not supported"}e.select();_nativeCommand(e.doc,t,null);return e}});function _cmd(e){if(e.nodeName){var t=_getDoc(e);e=_range(t).selectNodeContents(t.body).collapse(false)}return new KCmd(e)}K.CmdClass=KCmd;K.cmd=_cmd;function _drag(e){var t=e.moveEl,n=e.moveFn,i=e.clickEl||t,a=e.beforeDrag,r=e.iframeFix===undefined?true:e.iframeFix;var o=[document];if(r){K("iframe").each(function(){var e=_formatUrl(this.src||"","absolute");if(/^https?:\/\//.test(e)){return}var t;try{t=_iframeDoc(this)}catch(e){}if(t){var n=K(this).pos();K(t).data("pos-x",n.x);K(t).data("pos-y",n.y);o.push(t)}})}i.mousedown(function(e){if(e.button!==0&&e.button!==1){return}e.stopPropagation();var r=i.get(),l=_removeUnit(t.css("left")),s=_removeUnit(t.css("top")),d=t.width(),u=t.height(),c=e.pageX,f=e.pageY;if(a){a()}function p(e){e.preventDefault();var t=K(_getDoc(e.target));var a=_round((t.data("pos-x")||0)+e.pageX-c);var r=_round((t.data("pos-y")||0)+e.pageY-f);n.call(i,l,s,d,u,a,r)}function h(e){e.preventDefault()}function m(e){e.preventDefault();K(o).unbind("mousemove",p).unbind("mouseup",m).unbind("selectstart",h);if(r.releaseCapture){r.releaseCapture()}}K(o).mousemove(p).mouseup(m).bind("selectstart",h);if(r.setCapture){r.setCapture()}})}function KWidget(e){this.init(e)}_extend(KWidget,{init:function(e){var t=this;t.name=e.name||"";t.doc=e.doc||document;t.win=_getWin(t.doc);t.x=_addUnit(e.x);t.y=_addUnit(e.y);t.z=e.z;t.width=_addUnit(e.width);t.height=_addUnit(e.height);t.div=K('<div style="display:block;"></div>');t.options=e;t._alignEl=e.alignEl;if(t.width){t.div.css("width",t.width)}if(t.height){t.div.css("height",t.height)}if(t.z){t.div.css({position:"absolute",left:t.x,top:t.y,"z-index":t.z})}if(t.z&&(t.x===undefined||t.y===undefined)){t.autoPos(t.width,t.height)}if(e.cls){t.div.addClass(e.cls)}if(e.shadowMode){t.div.addClass("ke-shadow")}if(e.css){t.div.css(e.css)}if(e.src){K(e.src).replaceWith(t.div)}else{K(t.doc.body).append(t.div)}if(e.html){t.div.html(e.html)}if(e.autoScroll){if(_IE&&_V<7||_QUIRKS){var n=_getScrollPos();K(t.win).bind("scroll",function(e){var i=_getScrollPos(),a=i.x-n.x,r=i.y-n.y;t.pos(_removeUnit(t.x)+a,_removeUnit(t.y)+r,false)})}else{t.div.css("position","fixed")}}},pos:function(e,t,n){var i=this;n=_undef(n,true);if(e!==null){e=e<0?0:_addUnit(e);i.div.css("left",e);if(n){i.x=e}}if(t!==null){t=t<0?0:_addUnit(t);i.div.css("top",t);if(n){i.y=t}}return i},autoPos:function(e,t){var n,i,a=this,r=_removeUnit(e)||0,o=_removeUnit(t)||0,l=_getScrollPos();if(a._alignEl){var s=K(a._alignEl),d=s.pos(),u=_round(s[0].clientWidth/2-r/2),c=_round(s[0].clientHeight/2-o/2);n=u<0?d.x:d.x+u;i=c<0?d.y:d.y+c}else{var f=_docElement(a.doc);n=_round(l.x+(f.clientWidth-r)/2);i=_round(l.y+(f.clientHeight-o)/2)}if(!(_IE&&_V<7||_QUIRKS)){n-=l.x;i-=l.y}return a.pos(n,i)},remove:function(){var e=this;if(_IE&&_V<7||_QUIRKS){K(e.win).unbind("scroll")}e.div.remove();_each(e,function(t){e[t]=null});return this},show:function(){this.div.show();return this},hide:function(){this.div.hide();return this},draggable:function(e){var t=this;e=e||{};e.moveEl=t.div;e.moveFn=function(e,n,i,a,r,o){if((e=e+r)<0){e=0}if((n=n+o)<0){n=0}t.pos(e,n)};_drag(e);return t}});function _widget(e){return new KWidget(e)}K.WidgetClass=KWidget;K.widget=_widget;function _iframeDoc(e){e=_get(e);return e.contentDocument||e.contentWindow.document}var html,_direction="";if(html=document.getElementsByTagName("html")){_direction=html[0].dir}function _getInitHtml(e,t,n,i){var a=[_direction===""?"<html>":'<html dir="'+_direction+'">','<head><meta charset="utf-8" /><title></title>',"<style>","html {margin:0;padding:0;}","body {margin:0;padding:5px;}",'body, td {font:12px/1.5 "sans serif",tahoma,verdana,helvetica;}',"body, p, div {word-wrap: break-word;}","p {margin:5px 0;}","table {border-collapse:collapse;}","img {border:0;}","noscript {display:none;}","table.ke-zeroborder td {border:1px dotted #AAA;}","img.ke-flash {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/flash.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-rm {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/rm.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-media {","\tborder:1px solid #AAA;","\tbackground-image:url("+e+"common/media.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","img.ke-anchor {","\tborder:1px dashed #666;","\twidth:16px;","\theight:16px;","}",".ke-script, .ke-noscript, .ke-display-none {","\tdisplay:none;","\tfont-size:0;","\twidth:0;","\theight:0;","}",".ke-pagebreak {","\tborder:1px dotted #AAA;","\tfont-size:0;","\theight:2px;","}","</style>"];if(!_isArray(n)){n=[n]}_each(n,function(e,t){if(t){a.push('<link href="'+t+'" rel="stylesheet" />')}});if(i){a.push("<style>"+i+"</style>")}a.push("</head><body "+(t?'class="'+t+'"':"")+"></body></html>");return a.join("\n")}function _elementVal(e,t){if(e.hasVal()){if(t===undefined){var n=e.val();n=n.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,"");return n}return e.val(t)}return e.html(t)}function KEdit(e){this.init(e)}_extend(KEdit,KWidget,{init:function(e){var t=this;KEdit.parent.init.call(t,e);t.srcElement=K(e.srcElement);t.div.addClass("ke-edit");t.designMode=_undef(e.designMode,true);t.beforeGetHtml=e.beforeGetHtml;t.beforeSetHtml=e.beforeSetHtml;t.afterSetHtml=e.afterSetHtml;var n=_undef(e.themesPath,""),i=e.bodyClass,a=e.cssPath,r=e.cssData,o=location.protocol!="res:"&&location.host.replace(/:\d+/,"")!==document.domain,l="document.open();"+(o?'document.domain="'+document.domain+'";':"")+"document.close();",s=_IE?' src="javascript:void(function(){'+encodeURIComponent(l)+'}())"':"";t.iframe=K('<iframe class="ke-edit-iframe" hidefocus="true" frameborder="0"'+s+"></iframe>").css("width","100%");t.textarea=K('<textarea class="ke-edit-textarea" hidefocus="true"></textarea>').css("width","100%");t.tabIndex=isNaN(parseInt(e.tabIndex,10))?t.srcElement.attr("tabindex"):parseInt(e.tabIndex,10);t.iframe.attr("tabindex",t.tabIndex);t.textarea.attr("tabindex",t.tabIndex);if(t.width){t.setWidth(t.width)}if(t.height){t.setHeight(t.height)}if(t.designMode){t.textarea.hide()}else{t.iframe.hide()}function d(){var l=_iframeDoc(t.iframe);l.open();if(o){l.domain=document.domain}l.write(_getInitHtml(n,i,a,r));l.close();t.win=t.iframe[0].contentWindow;t.doc=l;var s=_cmd(l);t.afterChange(function(e){s.selection()});if(_WEBKIT){K(l).click(function(e){if(K(e.target).name==="img"){s.selection(true);s.range.selectNode(e.target);s.select()}})}if(_IE){t._mousedownHandler=function(){var e=s.range.cloneRange();e.shrink();if(e.isControl()){t.blur()}};K(document).mousedown(t._mousedownHandler);K(l).keydown(function(e){if(e.which==8){s.selection();var t=s.range;if(t.isControl()){t.collapse(true);K(t.startContainer.childNodes[t.startOffset]).remove();e.preventDefault()}}})}t.cmd=s;t.html(_elementVal(t.srcElement));if(_IE){l.body.disabled=true;l.body.contentEditable=true;l.body.removeAttribute("disabled")}else{l.designMode="on"}if(e.afterCreate){e.afterCreate.call(t)}}if(o){t.iframe.bind("load",function(e){t.iframe.unbind("load");if(_IE){d()}else{setTimeout(d,0)}})}t.div.append(t.iframe);t.div.append(t.textarea);t.srcElement.hide();!o&&d()},setWidth:function(e){var t=this;e=_addUnit(e);t.width=e;t.div.css("width",e);return t},setHeight:function(e){var t=this;e=_addUnit(e);t.height=e;t.div.css("height",e);t.iframe.css("height",e);if(_IE&&_V<8||_QUIRKS){e=_addUnit(_removeUnit(e)-2)}t.textarea.css("height",e);return t},remove:function(){var e=this,t=e.doc;K(t.body).unbind();K(t).unbind();K(e.win).unbind();if(e._mousedownHandler){K(document).unbind("mousedown",e._mousedownHandler)}_elementVal(e.srcElement,e.html());e.srcElement.show();e.iframe.unbind();e.textarea.unbind();KEdit.parent.remove.call(e)},html:function(e,t){var n=this,i=n.doc;if(n.designMode){var a=i.body;if(e===undefined){if(t){e="<!doctype html><html>"+a.parentNode.innerHTML+"</html>"}else{e=a.innerHTML}if(n.beforeGetHtml){e=n.beforeGetHtml(e)}if(_GECKO&&e=="<br />"){e=""}return e}if(n.beforeSetHtml){e=n.beforeSetHtml(e)}if(_IE&&_V>=9){e=e.replace(/(<.*?checked=")checked(".*>)/gi,"$1$2")}K(a).html(e);if(n.afterSetHtml){n.afterSetHtml()}return n}if(e===undefined){return n.textarea.val()}n.textarea.val(e);return n},design:function(e){var t=this,n;if(e===undefined?!t.designMode:e){if(!t.designMode){n=t.html();t.designMode=true;t.textarea.hide();t.html(n);var i=t.iframe;var a=_removeUnit(t.height);i.height(a-2);i.show();setTimeout(function(){i.height(a)},0)}}else{if(t.designMode){n=t.html();t.designMode=false;t.html(n);t.iframe.hide();t.textarea.show()}}return t.focus()},focus:function(){var e=this;e.designMode?e.win.focus():e.textarea[0].focus();return e},blur:function(){var e=this;if(_IE){var t=K('<input type="text" style="float:left;width:0;height:0;padding:0;margin:0;border:0;" value="" />',e.div);e.div.append(t);t[0].focus();t.remove()}else{e.designMode?e.win.blur():e.textarea[0].blur()}return e},afterChange:function(e){var t=this,n=t.doc,i=n.body;K(n).keyup(function(t){if(!t.ctrlKey&&!t.altKey&&_CHANGE_KEY_MAP[t.which]){e(t)}});K(n).mouseup(e).contextmenu(e);K(t.win).blur(e);function a(t){setTimeout(function(){e(t)},1)}K(i).bind("paste",a);K(i).bind("cut",a);return t}});function _edit(e){return new KEdit(e)}K.EditClass=KEdit;K.edit=_edit;K.iframeDoc=_iframeDoc;function _selectToolbar(e,t){var n=this,i=n.get(e);if(i){if(i.hasClass("ke-disabled")){return}t(i)}}function KToolbar(e){this.init(e)}_extend(KToolbar,KWidget,{init:function(e){var t=this;KToolbar.parent.init.call(t,e);t.disableMode=_undef(e.disableMode,false);t.noDisableItemMap=_toMap(_undef(e.noDisableItems,[]));t._itemMap={};t.div.addClass("ke-toolbar").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()}).attr("unselectable","on");function n(e){var t=K(e);if(t.hasClass("ke-outline")){return t}if(t.hasClass("ke-toolbar-icon")){return t.parent()}}function i(e,t){var i=n(e.target);if(i){if(i.hasClass("ke-disabled")){return}if(i.hasClass("ke-selected")){return}i[t]("ke-on")}}t.div.mouseover(function(e){i(e,"addClass")}).mouseout(function(e){i(e,"removeClass")}).click(function(e){var i=n(e.target);if(i){if(i.hasClass("ke-disabled")){return}t.options.click.call(this,e,i.attr("data-name"))}})},get:function(e){if(this._itemMap[e]){return this._itemMap[e]}return this._itemMap[e]=K("span.ke-icon-"+e,this.div).parent()},select:function(e){_selectToolbar.call(this,e,function(e){e.addClass("ke-selected")});return self},unselect:function(e){_selectToolbar.call(this,e,function(e){e.removeClass("ke-selected").removeClass("ke-on")});return self},enable:function(e){var t=this,n=e.get?e:t.get(e);if(n){n.removeClass("ke-disabled");n.opacity(1)}return t},disable:function(e){var t=this,n=e.get?e:t.get(e);if(n){n.removeClass("ke-selected").addClass("ke-disabled");n.opacity(.5)}return t},disableAll:function(e,t){var n=this,i=n.noDisableItemMap,a;if(t){i=_toMap(t)}if(e===undefined?!n.disableMode:e){K("span.ke-outline",n.div).each(function(){var e=K(this),t=e[0].getAttribute("data-name",2);if(!i[t]){n.disable(e)}});n.disableMode=true}else{K("span.ke-outline",n.div).each(function(){var e=K(this),t=e[0].getAttribute("data-name",2);if(!i[t]){n.enable(e)}});n.disableMode=false}return n}});function _toolbar(e){return new KToolbar(e)}K.ToolbarClass=KToolbar;K.toolbar=_toolbar;function KMenu(e){this.init(e)}_extend(KMenu,KWidget,{init:function(e){var t=this;e.z=e.z||811213;KMenu.parent.init.call(t,e);t.centerLineMode=_undef(e.centerLineMode,true);t.div.addClass("ke-menu").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on")},addItem:function(e){var t=this;if(e.title==="-"){t.div.append(K('<div class="ke-menu-separator"></div>'));return}var n=K('<div class="ke-menu-item" unselectable="on"></div>'),i=K('<div class="ke-inline-block ke-menu-item-left"></div>'),a=K('<div class="ke-inline-block ke-menu-item-right"></div>'),r=_addUnit(e.height),o=_undef(e.iconClass,"");t.div.append(n);if(r){n.css("height",r);a.css("line-height",r)}var l;if(t.centerLineMode){l=K('<div class="ke-inline-block ke-menu-item-center"></div>');if(r){l.css("height",r)}}n.mouseover(function(e){K(this).addClass("ke-menu-item-on");if(l){l.addClass("ke-menu-item-center-on")}}).mouseout(function(e){K(this).removeClass("ke-menu-item-on");if(l){l.removeClass("ke-menu-item-center-on")}}).click(function(t){e.click.call(K(this));t.stopPropagation()}).append(i);if(l){n.append(l)}n.append(a);if(e.checked){o="ke-icon-checked"}if(o!==""){i.html('<span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url '+o+'"></span>')}a.html(e.title);return t},remove:function(){var e=this;if(e.options.beforeRemove){e.options.beforeRemove.call(e)}K(".ke-menu-item",e.div[0]).unbind();KMenu.parent.remove.call(e);return e}});function _menu(e){return new KMenu(e)}K.MenuClass=KMenu;K.menu=_menu;function KColorPicker(e){this.init(e)}_extend(KColorPicker,KWidget,{init:function(e){var t=this;e.z=e.z||811213;KColorPicker.parent.init.call(t,e);var n=e.colors||[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]];t.selectedColor=(e.selectedColor||"").toLowerCase();t._cells=[];t.div.addClass("ke-colorpicker").bind("click,mousedown",function(e){e.stopPropagation()}).attr("unselectable","on");var i=t.doc.createElement("table");t.div.append(i);i.className="ke-colorpicker-table";i.cellPadding=0;i.cellSpacing=0;i.border=0;var a=i.insertRow(0),r=a.insertCell(0);r.colSpan=n[0].length;t._addAttr(r,"","ke-colorpicker-cell-top");for(var o=0;o<n.length;o++){a=i.insertRow(o+1);for(var l=0;l<n[o].length;l++){r=a.insertCell(l);t._addAttr(r,n[o][l],"ke-colorpicker-cell")}}},_addAttr:function(e,t,n){var i=this;e=K(e).addClass(n);if(i.selectedColor===t.toLowerCase()){e.addClass("ke-colorpicker-cell-selected")}e.attr("title",t||i.options.noColor);e.mouseover(function(e){K(this).addClass("ke-colorpicker-cell-on")});e.mouseout(function(e){K(this).removeClass("ke-colorpicker-cell-on")});e.click(function(e){e.stop();i.options.click.call(K(this),t)});if(t){e.append(K('<div class="ke-colorpicker-cell-color" unselectable="on"></div>').css("background-color",t))}else{e.html(i.options.noColor)}K(e).attr("unselectable","on");i._cells.push(e)},remove:function(){var e=this;_each(e._cells,function(){this.unbind()});KColorPicker.parent.remove.call(e);return e}});function _colorpicker(e){return new KColorPicker(e)}K.ColorPickerClass=KColorPicker;K.colorpicker=_colorpicker;function KUploadButton(e){this.init(e)}_extend(KUploadButton,{init:function(e){var t=this,n=K(e.button),i=e.fieldName||"file",a=e.url||"",r=n.val(),o=e.extraParams||{},l=n[0].className||"",s=e.target||"kindeditor_upload_iframe_"+(new Date).getTime();e.afterError=e.afterError||function(e){alert(e)};var d=[];for(var u in o){d.push('<input type="hidden" name="'+u+'" value="'+o[u]+'" />')}var c=['<div class="ke-inline-block '+l+'">',e.target?"":'<iframe name="'+s+'" style="display:none;"></iframe>',e.form?'<div class="ke-upload-area">':'<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+s+'" action="'+a+'">','<span class="ke-button-common">',d.join(""),'<input type="button" class="ke-button-common ke-button" value="'+r+'" />',"</span>",'<input type="file" class="ke-upload-file" name="'+i+'" tabindex="-1" />',e.form?"</div>":"</form>","</div>"].join("");var f=K(c,n.doc);n.hide();n.before(f);t.div=f;t.button=n;t.iframe=e.target?K('iframe[name="'+s+'"]'):K("iframe",f);t.form=e.form?K(e.form):K("form",f);t.fileBox=K(".ke-upload-file",f);var p=e.width||K(".ke-button-common",f).width();K(".ke-upload-area",f).width(p);t.options=e},submit:function(){var e=this,t=e.iframe;t.bind("load",function(){t.unbind();var n=document.createElement("form");e.fileBox.before(n);K(n).append(e.fileBox);n.reset();K(n).remove(true);var i=K.iframeDoc(t),a=i.getElementsByTagName("pre")[0],r="",o;if(a){r=a.innerHTML}else{r=i.body.innerHTML}r=_unescape(r);t[0].src="javascript:false";try{o=K.json(r)}catch(t){e.options.afterError.call(e,"<!doctype html><html>"+i.body.parentNode.innerHTML+"</html>")}if(o){e.options.afterUpload.call(e,o)}});e.form[0].submit();return e},remove:function(){var e=this;if(e.fileBox){e.fileBox.unbind()}e.iframe.remove();e.div.remove();e.button.show();return e}});function _uploadbutton(e){return new KUploadButton(e)}K.UploadButtonClass=KUploadButton;K.uploadbutton=_uploadbutton;function _createButton(e){e=e||{};var t=e.name||"",n=K('<span class="ke-button-common ke-button-outer" title="'+t+'"></span>'),i=K('<input class="ke-button-common ke-button" type="button" value="'+t+'" />');if(e.click){i.click(e.click)}n.append(i);return n}function KDialog(e){this.init(e)}_extend(KDialog,KWidget,{init:function(e){var t=this;var n=_undef(e.shadowMode,true);e.z=e.z||811213;e.shadowMode=false;e.autoScroll=_undef(e.autoScroll,true);KDialog.parent.init.call(t,e);var i=e.title,a=K(e.body,t.doc),r=e.previewBtn,o=e.yesBtn,l=e.noBtn,s=e.closeBtn,d=_undef(e.showMask,true);t.div.addClass("ke-dialog").bind("click,mousedown",function(e){e.stopPropagation()});var u=K('<div class="ke-dialog-content"></div>').appendTo(t.div);if(_IE&&_V<7){t.iframeMask=K('<iframe src="about:blank" class="ke-dialog-shadow"></iframe>').appendTo(t.div)}else if(n){K('<div class="ke-dialog-shadow"></div>').appendTo(t.div)}var c=K('<div class="ke-dialog-header"></div>');u.append(c);c.html(i);t.closeIcon=K('<span class="ke-dialog-icon-close" title="'+s.name+'"></span>').click(s.click);c.append(t.closeIcon);t.draggable({clickEl:c,beforeDrag:e.beforeDrag});var f=K('<div class="ke-dialog-body"></div>');u.append(f);f.append(a);var p=K('<div class="ke-dialog-footer"></div>');if(r||o||l){u.append(p)}_each([{btn:r,name:"preview"},{btn:o,name:"yes"},{btn:l,name:"no"}],function(){if(this.btn){var e=_createButton(this.btn);e.addClass("ke-dialog-"+this.name);p.append(e)}});if(t.height){f.height(_removeUnit(t.height)-c.height()-p.height())}t.div.width(t.div.width());t.div.height(t.div.height());t.mask=null;if(d){var h=_docElement(t.doc),m=Math.max(h.scrollWidth,h.clientWidth),g=Math.max(h.scrollHeight,h.clientHeight);t.mask=_widget({x:0,y:0,z:t.z-1,cls:"ke-dialog-mask",width:m,height:g})}t.autoPos(t.div.width(),t.div.height());t.footerDiv=p;t.bodyDiv=f;t.headerDiv=c;t.isLoading=false},setMaskIndex:function(e){var t=this;t.mask.div.css("z-index",e)},showLoading:function(e){e=_undef(e,"");var t=this,n=t.bodyDiv;t.loading=K('<div class="ke-dialog-loading"><div class="ke-inline-block ke-dialog-loading-content" style="margin-top:'+Math.round(n.height()/3)+'px;">'+e+"</div></div>").width(n.width()).height(n.height()).css("top",t.headerDiv.height()+"px");n.css("visibility","hidden").after(t.loading);t.isLoading=true;return t},hideLoading:function(){this.loading&&this.loading.remove();this.bodyDiv.css("visibility","visible");this.isLoading=false;return this},remove:function(){var e=this;if(e.options.beforeRemove){e.options.beforeRemove.call(e)}e.mask&&e.mask.remove();e.iframeMask&&e.iframeMask.remove();e.closeIcon.unbind();K("input",e.div).unbind();K("button",e.div).unbind();e.footerDiv.unbind();e.bodyDiv.unbind();e.headerDiv.unbind();K("iframe",e.div).each(function(){K(this).remove()});KDialog.parent.remove.call(e);return e}});function _dialog(e){return new KDialog(e)}K.DialogClass=KDialog;K.dialog=_dialog;function _tabs(e){var t=_widget(e),n=t.remove,i=e.afterSelect,a=t.div,r=[];a.addClass("ke-tabs").bind("contextmenu,mousedown,mousemove",function(e){e.preventDefault()});var o=K('<ul class="ke-tabs-ul ke-clearfix"></ul>');a.append(o);t.add=function(e){var t=K('<li class="ke-tabs-li">'+e.title+"</li>");t.data("tab",e);r.push(t);o.append(t)};t.selectedIndex=0;t.select=function(e){t.selectedIndex=e;_each(r,function(n,i){i.unbind();if(n===e){i.addClass("ke-tabs-li-selected");K(i.data("tab").panel).show("")}else{i.removeClass("ke-tabs-li-selected").removeClass("ke-tabs-li-on").mouseover(function(){K(this).addClass("ke-tabs-li-on")}).mouseout(function(){K(this).removeClass("ke-tabs-li-on")}).click(function(){t.select(n)});K(i.data("tab").panel).hide()}});if(i){i.call(t,e)}};t.remove=function(){_each(r,function(){this.remove()});o.remove();n.call(t)};return t}K.tabs=_tabs;function _loadScript(e,t){var n=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),i=document.createElement("script");n.appendChild(i);i.src=e;i.charset="utf-8";i.onload=i.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"){if(t){t()}i.onload=i.onreadystatechange=null;n.removeChild(i)}}}function _chopQuery(e){var t=e.indexOf("?");return t>0?e.substr(0,t):e}function _loadStyle(e){var t=document.getElementsByTagName("head")[0]||(_QUIRKS?document.body:document.documentElement),n=document.createElement("link"),i=_chopQuery(_formatUrl(e,"absolute"));var a=K('link[rel="stylesheet"]',t);for(var r=0,o=a.length;r<o;r++){if(_chopQuery(_formatUrl(a[r].href,"absolute"))===i){return}}t.appendChild(n);n.href=e;n.rel="stylesheet"}function _ajax(e,t,n,i,a){n=n||"GET";a=a||"json";var r=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");r.open(n,e,true);r.onreadystatechange=function(){if(r.readyState==4&&r.status==200){if(t){var e=_trim(r.responseText);if(a=="json"){e=_json(e)}t(e)}}};if(n=="POST"){var o=[];_each(i,function(e,t){o.push(encodeURIComponent(e)+"="+encodeURIComponent(t))});try{r.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(e){}r.send(o.join("&"))}else{r.send(null)}}K.loadScript=_loadScript;K.loadStyle=_loadStyle;K.ajax=_ajax;var _plugins={};function _plugin(e,t){if(e===undefined){return _plugins}if(!t){return _plugins[e]}_plugins[e]=t}var _language={};function _parseLangKey(e){var t,n="core";if(t=/^(\w+)\.(\w+)$/.exec(e)){n=t[1];e=t[2]}return{ns:n,key:e}}function _lang(e,t){t=t===undefined?K.options.langType:t;if(typeof e==="string"){if(!_language[t]){return"no language"}var n=e.length-1;if(e.substr(n)==="."){return _language[t][e.substr(0,n)]}var i=_parseLangKey(e);return _language[t][i.ns][i.key]}_each(e,function(e,n){var i=_parseLangKey(e);if(!_language[t]){_language[t]={}}if(!_language[t][i.ns]){_language[t][i.ns]={}}_language[t][i.ns][i.key]=n})}function _getImageFromRange(e,t){if(e.collapsed){return}e=e.cloneRange().up();var n=e.startContainer,i=e.startOffset;if(!_WEBKIT&&!e.isControl()){return}var a=K(n.childNodes[i]);if(!a||a.name!="img"){return}if(t(a)){return a}}function _bindContextmenuEvent(){var e=this,t=e.edit.doc;K(t).contextmenu(function(t){if(e.menu){e.hideMenu()}if(!e.useContextmenu){t.preventDefault();return}if(e._contextmenus.length===0){return}var n=0,i=[];_each(e._contextmenus,function(){if(this.title=="-"){i.push(this);return}if(this.cond&&this.cond()){i.push(this);if(this.width&&this.width>n){n=this.width}}});while(i.length>0&&i[0].title=="-"){i.shift()}while(i.length>0&&i[i.length-1].title=="-"){i.pop()}var a=null;_each(i,function(e){if(this.title=="-"&&a.title=="-"){delete i[e]}a=this});if(i.length>0){t.preventDefault();var r=K(e.edit.iframe).pos(),o=_menu({x:r.x+t.clientX,y:r.y+t.clientY,width:n,css:{visibility:"hidden"},shadowMode:e.shadowMode});_each(i,function(){if(this.title){o.addItem(this)}});var l=_docElement(o.doc),s=o.div.height();if(t.clientY+s>=l.clientHeight-100){o.pos(o.x,_removeUnit(o.y)-s)}o.div.css("visibility","visible");e.menu=o}})}function _bindNewlineEvent(){var e=this,t=e.edit.doc,n=e.newlineTag;if(_IE&&n!=="br"){return}if(_GECKO&&_V<3&&n!=="p"){return}if(_OPERA&&_V<9){return}var i=_toMap("h1,h2,h3,h4,h5,h6,pre,li"),a=_toMap("p,h1,h2,h3,h4,h5,h6,pre,li,blockquote");function r(e){var t=K(e.commonAncestor());while(t){if(t.type==1&&!t.isStyle()){break}t=t.parent()}return t.name}K(t).keydown(function(o){if(o.which!=13||o.shiftKey||o.ctrlKey||o.altKey){return}e.cmd.selection();var l=r(e.cmd.range);if(l=="marquee"||l=="select"){return}if(n==="br"&&!i[l]){o.preventDefault();e.insertHtml("<br />"+(_IE&&_V<9?"":"​"));return}if(!a[l]){_nativeCommand(t,"formatblock","<p>")}});K(t).keyup(function(i){if(i.which!=13||i.shiftKey||i.ctrlKey||i.altKey){return}if(n=="br"){return}if(_GECKO){var o=e.cmd.commonAncestor("p");var l=e.cmd.commonAncestor("a");if(l&&l.text()==""){l.remove(true);e.cmd.range.selectNodeContents(o[0]).collapse(true);e.cmd.select()}return}e.cmd.selection();var s=r(e.cmd.range);if(s=="marquee"||s=="select"){return}if(!a[s]){_nativeCommand(t,"formatblock","<p>")}var d=e.cmd.commonAncestor("div");if(d){var u=K("<p></p>"),c=d[0].firstChild;while(c){var f=c.nextSibling;u.append(c);c=f}d.before(u);d.remove();e.cmd.range.selectNodeContents(u[0]);e.cmd.select()}})}function _bindTabEvent(){var e=this,t=e.edit.doc;K(t).keydown(function(n){if(n.which==9){n.preventDefault();if(e.afterTab){e.afterTab.call(e,n);return}var i=e.cmd,a=i.range;a.shrink();if(a.collapsed&&a.startContainer.nodeType==1){a.insertNode(K("@&nbsp;",t)[0]);i.select()}e.insertHtml("&nbsp;&nbsp;&nbsp;&nbsp;")}})}function _bindFocusEvent(){var e=this;K(e.edit.textarea[0],e.edit.win).focus(function(t){if(e.afterFocus){e.afterFocus.call(e,t)}}).blur(function(t){if(e.afterBlur){e.afterBlur.call(e,t)}})}function _removeBookmarkTag(e){return _trim(e.replace(/<span [^>]*id="?__kindeditor_bookmark_\w+_\d+__"?[^>]*><\/span>/gi,""))}function _removeTempTag(e){return e.replace(/<div[^>]+class="?__kindeditor_paste__"?[^>]*>[\s\S]*?<\/div>/gi,"")}function _addBookmarkToStack(e,t){if(e.length===0){e.push(t);return}var n=e[e.length-1];if(_removeBookmarkTag(t.html)!==_removeBookmarkTag(n.html)){e.push(t)}}function _undoToRedo(e,t){var n=this,i=n.edit,a=i.doc.body,r,o;if(e.length===0){return n}if(i.designMode){r=n.cmd.range;o=r.createBookmark(true);o.html=a.innerHTML}else{o={html:a.innerHTML}}_addBookmarkToStack(t,o);var l=e.pop();if(_removeBookmarkTag(o.html)===_removeBookmarkTag(l.html)&&e.length>0){l=e.pop()}if(i.designMode){i.html(l.html);if(l.start){r.moveToBookmark(l);n.select()}}else{K(a).html(_removeBookmarkTag(l.html))}return n}function KEditor(e){var t=this;t.options={};function n(e,n){if(KEditor.prototype[e]===undefined){t[e]=n}t.options[e]=n}_each(e,function(t,i){n(t,e[t])});_each(K.options,function(e,i){if(t[e]===undefined){n(e,i)}});var i=K(t.srcElement||"<textarea/>");if(!t.width){t.width=i[0].style.width||i.width()}if(!t.height){t.height=i[0].style.height||i.height()}n("width",_undef(t.width,t.minWidth));n("height",_undef(t.height,t.minHeight));n("width",_addUnit(t.width));n("height",_addUnit(t.height));if(_MOBILE&&(!_IOS||_V<534)){t.designMode=false}t.srcElement=i;t.initContent="";t.plugin={};t.isCreated=false;t._handlers={};t._contextmenus=[];t._undoStack=[];t._redoStack=[];t._firstAddBookmark=true;t.menu=t.contextmenu=null;t.dialogs=[]}KEditor.prototype={lang:function(e){return _lang(e,this.langType)},loadPlugin:function(e,t){var n=this;var i=this._pluginStatus;if(!i){i=this._pluginStatus={}}if(_plugins[e]){if(!_isFunction(_plugins[e])){setTimeout(function(){n.loadPlugin(e,t)},100);return n}if(!i[e]){_plugins[e].call(n,KindEditor);i[e]="inited"}if(t){t.call(n)}return n}_plugins[e]="loading";_loadScript(n.pluginsPath+e+"/"+e+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){setTimeout(function(){if(_plugins[e]){n.loadPlugin(e,t)}},0)});return n},handler:function(e,t){var n=this;if(!n._handlers[e]){n._handlers[e]=[]}if(_isFunction(t)){n._handlers[e].push(t);return n}_each(n._handlers[e],function(){t=this.call(n,t)});return t},clickToolbar:function(e,t){var n=this,i="clickToolbar"+e;if(t===undefined){if(n._handlers[i]){return n.handler(i)}n.loadPlugin(e,function(){n.handler(i)});return n}return n.handler(i,t)},updateState:function(){var e=this;_each(("justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,"+"subscript,superscript,bold,italic,underline,strikethrough").split(","),function(t,n){e.cmd.state(n)?e.toolbar.select(n):e.toolbar.unselect(n)});return e},addContextmenu:function(e){this._contextmenus.push(e);return this},afterCreate:function(e){return this.handler("afterCreate",e)},beforeRemove:function(e){return this.handler("beforeRemove",e)},beforeGetHtml:function(e){return this.handler("beforeGetHtml",e)},beforeSetHtml:function(e){return this.handler("beforeSetHtml",e)},afterSetHtml:function(e){return this.handler("afterSetHtml",e)},create:function(){var e=this,t=e.fullscreenMode;if(e.isCreated){return e}if(e.srcElement.data("kindeditor")){return e}e.srcElement.data("kindeditor","true");if(t){_docElement().style.overflow="hidden"}else{_docElement().style.overflow=""}var n=t?_docElement().clientWidth+"px":e.width,i=t?_docElement().clientHeight+"px":e.height;if(_IE&&_V<8||_QUIRKS){i=_addUnit(_removeUnit(i)+2)}var a=e.container=K(e.layout);if(t){K(document.body).append(a)}else{e.srcElement.before(a)}var r=K(".toolbar",a),o=K(".edit",a),l=e.statusbar=K(".statusbar",a);a.removeClass("container").addClass("ke-container ke-container-"+e.themeType).css("width",n);if(t){a.css({position:"absolute",left:0,top:0,"z-index":811211});if(!_GECKO){e._scrollPos=_getScrollPos()}window.scrollTo(0,0);K(document.body).css({height:"1px",overflow:"hidden"});K(document.body.parentNode).css("overflow","hidden");e._fullscreenExecuted=true}else{if(e._fullscreenExecuted){K(document.body).css({height:"",overflow:""});K(document.body.parentNode).css("overflow","")}if(e._scrollPos){window.scrollTo(e._scrollPos.x,e._scrollPos.y)}}var s=[];K.each(e.items,function(t,n){if(n=="|"){s.push('<span class="ke-inline-block ke-separator"></span>')}else if(n=="/"){s.push('<div class="ke-hr"></div>')}else{s.push('<span class="ke-outline" data-name="'+n+'" title="'+e.lang(n)+'" unselectable="on">');s.push('<span class="ke-toolbar-icon ke-toolbar-icon-url ke-icon-'+n+'" unselectable="on"></span></span>')}});var d=e.toolbar=_toolbar({src:r,html:s.join(""),noDisableItems:e.noDisableItems,click:function(t,n){t.stop();if(e.menu){var i=e.menu.name;e.hideMenu();if(i===n){return}}e.clickToolbar(n)}});var u=_removeUnit(i)-d.div.height();var c=e.edit=_edit({height:u>0&&_removeUnit(i)>e.minHeight?u:e.minHeight,src:o,srcElement:e.srcElement,designMode:e.designMode,themesPath:e.themesPath,bodyClass:e.bodyClass,cssPath:e.cssPath,cssData:e.cssData,beforeGetHtml:function(t){t=e.beforeGetHtml(t);t=_removeBookmarkTag(_removeTempTag(t));return _formatHtml(t,e.filterMode?e.htmlTags:null,e.urlType,e.wellFormatMode,e.indentChar)},beforeSetHtml:function(t){t=_formatHtml(t,e.filterMode?e.htmlTags:null,"",false);return e.beforeSetHtml(t)},afterSetHtml:function(){e.edit=c=this;e.afterSetHtml()},afterCreate:function(){e.edit=c=this;e.cmd=c.cmd;e._docMousedownFn=function(t){if(e.menu){e.hideMenu()}};K(c.doc,document).mousedown(e._docMousedownFn);_bindContextmenuEvent.call(e);_bindNewlineEvent.call(e);_bindTabEvent.call(e);_bindFocusEvent.call(e);c.afterChange(function(t){if(!c.designMode){return}e.updateState();e.addBookmark();if(e.options.afterChange){e.options.afterChange.call(e)}});c.textarea.keyup(function(t){if(!t.ctrlKey&&!t.altKey&&_INPUT_KEY_MAP[t.which]){if(e.options.afterChange){e.options.afterChange.call(e)}}});if(e.readonlyMode){e.readonly()}e.isCreated=true;if(e.initContent===""){e.initContent=e.html()}if(e._undoStack.length>0){var t=e._undoStack.pop();if(t.start){e.html(t.html);c.cmd.range.moveToBookmark(t);e.select()}}e.afterCreate();if(e.options.afterCreate){e.options.afterCreate.call(e)}}});l.removeClass("statusbar").addClass("ke-statusbar").append('<span class="ke-inline-block ke-statusbar-center-icon"></span>').append('<span class="ke-inline-block ke-statusbar-right-icon"></span>');if(e._fullscreenResizeHandler){K(window).unbind("resize",e._fullscreenResizeHandler);e._fullscreenResizeHandler=null}function f(){if(l.height()===0){setTimeout(f,100);return}e.resize(n,i,false)}f();if(t){e._fullscreenResizeHandler=function(t){if(e.isCreated){e.resize(_docElement().clientWidth,_docElement().clientHeight,false)}};K(window).bind("resize",e._fullscreenResizeHandler);d.select("fullscreen");l.first().css("visibility","hidden");l.last().css("visibility","hidden")}else{if(_GECKO){K(window).bind("scroll",function(t){e._scrollPos=_getScrollPos()})}if(e.resizeType>0){_drag({moveEl:a,clickEl:l,moveFn:function(t,n,i,a,r,o){a+=o;e.resize(null,a)}})}else{l.first().css("visibility","hidden")}if(e.resizeType===2){_drag({moveEl:a,clickEl:l.last(),moveFn:function(t,n,i,a,r,o){i+=r;a+=o;e.resize(i,a)}})}else{l.last().css("visibility","hidden")}}return e},remove:function(){var e=this;if(!e.isCreated){return e}e.beforeRemove();e.srcElement.data("kindeditor","");if(e.menu){e.hideMenu()}_each(e.dialogs,function(){e.hideDialog()});K(document).unbind("mousedown",e._docMousedownFn);e.toolbar.remove();e.edit.remove();e.statusbar.last().unbind();e.statusbar.unbind();e.container.remove();e.container=e.toolbar=e.edit=e.menu=null;e.dialogs=[];e.isCreated=false;return e},resize:function(e,t,n){var i=this;n=_undef(n,true);if(e){if(!/%/.test(e)){e=_removeUnit(e);e=e<i.minWidth?i.minWidth:e}i.container.css("width",_addUnit(e));if(n){i.width=_addUnit(e)}}if(t){t=_removeUnit(t);var a=_removeUnit(t)-i.toolbar.div.height()-i.statusbar.height();a=a<i.minHeight?i.minHeight:a;i.edit.setHeight(a);if(n){i.height=_addUnit(t)}}return i},select:function(){this.isCreated&&this.cmd.select();return this},html:function(e){var t=this;if(e===undefined){return t.isCreated?t.edit.html():_elementVal(t.srcElement)}t.isCreated?t.edit.html(e):_elementVal(t.srcElement,e);if(t.isCreated){t.cmd.selection()}return t},fullHtml:function(){return this.isCreated?this.edit.html(undefined,true):""},text:function(e){var t=this;if(e===undefined){return _trim(t.html().replace(/<(?!img|embed).*?>/gi,"").replace(/&nbsp;/gi," "))}else{return t.html(_escape(e))}},isEmpty:function(){return _trim(this.text().replace(/\r\n|\n|\r/,""))===""},isDirty:function(){return _trim(this.initContent.replace(/\r\n|\n|\r|t/g,""))!==_trim(this.html().replace(/\r\n|\n|\r|t/g,""))},selectedHtml:function(){var e=this.isCreated?this.cmd.range.html():"";e=_removeBookmarkTag(_removeTempTag(e));return e},count:function(e){var t=this;e=(e||"html").toLowerCase();if(e==="html"){return t.html().length}if(e==="text"){return t.text().replace(/<(?:img|embed).*?>/gi,"K").replace(/\r\n|\n|\r/g,"").length}return 0},exec:function(e){e=e.toLowerCase();var t=this,n=t.cmd,i=_inArray(e,"selectall,copy,paste,print".split(","))<0;if(i){t.addBookmark(false)}n[e].apply(n,_toArray(arguments,1));if(i){t.updateState();t.addBookmark(false);if(t.options.afterChange){t.options.afterChange.call(t)}}return t},insertHtml:function(e,t){if(!this.isCreated){return this}e=this.beforeSetHtml(e);this.exec("inserthtml",e,t);return this},appendHtml:function(e){this.html(this.html()+e);if(this.isCreated){var t=this.cmd;t.range.selectNodeContents(t.doc.body).collapse(false);t.select()}return this},sync:function(){_elementVal(this.srcElement,this.html());return this},focus:function(){this.isCreated?this.edit.focus():this.srcElement[0].focus();return this},blur:function(){this.isCreated?this.edit.blur():this.srcElement[0].blur();return this},addBookmark:function(e){e=_undef(e,true);var t=this,n=t.edit,i=n.doc.body,a=_removeTempTag(i.innerHTML),r;if(e&&t._undoStack.length>0){var o=t._undoStack[t._undoStack.length-1];if(Math.abs(a.length-_removeBookmarkTag(o.html).length)<t.minChangeSize){return t}}if(n.designMode&&!t._firstAddBookmark){var l=t.cmd.range;r=l.createBookmark(true);r.html=_removeTempTag(i.innerHTML);l.moveToBookmark(r)}else{r={html:a}}t._firstAddBookmark=false;_addBookmarkToStack(t._undoStack,r);return t},undo:function(){return _undoToRedo.call(this,this._undoStack,this._redoStack)},redo:function(){return _undoToRedo.call(this,this._redoStack,this._undoStack)},fullscreen:function(e){this.fullscreenMode=e===undefined?!this.fullscreenMode:e;this.addBookmark(false);return this.remove().create()},readonly:function(e){e=_undef(e,true);var t=this,n=t.edit,i=n.doc;if(t.designMode){t.toolbar.disableAll(e,[])}else{_each(t.noDisableItems,function(){t.toolbar[e?"disable":"enable"](this)})}if(_IE){i.body.contentEditable=!e}else{i.designMode=e?"off":"on"}n.textarea[0].disabled=e},createMenu:function(e){var t=this,n=e.name,i=t.toolbar.get(n),a=i.pos();e.x=a.x;e.y=a.y+i.height();e.z=t.options.zIndex;e.shadowMode=_undef(e.shadowMode,t.shadowMode);if(e.selectedColor!==undefined){e.cls="ke-colorpicker-"+t.themeType;e.noColor=t.lang("noColor");t.menu=_colorpicker(e)}else{e.cls="ke-menu-"+t.themeType;e.centerLineMode=false;t.menu=_menu(e)}return t.menu},hideMenu:function(){this.menu.remove();this.menu=null;return this},hideContextmenu:function(){this.contextmenu.remove();this.contextmenu=null;return this},createDialog:function(e){var t=this,n=e.name;e.z=t.options.zIndex;e.shadowMode=_undef(e.shadowMode,t.shadowMode);e.closeBtn=_undef(e.closeBtn,{name:t.lang("close"),click:function(e){t.hideDialog();if(_IE&&t.cmd){t.cmd.select()}}});e.noBtn=_undef(e.noBtn,{name:t.lang(e.yesBtn?"no":"close"),click:function(e){t.hideDialog();if(_IE&&t.cmd){t.cmd.select()}}});if(t.dialogAlignType!="page"){e.alignEl=t.container}e.cls="ke-dialog-"+t.themeType;if(t.dialogs.length>0){var i=t.dialogs[0],a=t.dialogs[t.dialogs.length-1];i.setMaskIndex(a.z+2);e.z=a.z+3;e.showMask=false}var r=_dialog(e);t.dialogs.push(r);return r},hideDialog:function(){var e=this;if(e.dialogs.length>0){e.dialogs.pop().remove()}if(e.dialogs.length>0){var t=e.dialogs[0],n=e.dialogs[e.dialogs.length-1];t.setMaskIndex(n.z-1)}return e},errorDialog:function(e){var t=this;var n=t.createDialog({width:750,title:t.lang("uploadError"),body:'<div style="padding:10px 20px;"><iframe frameborder="0" style="width:708px;height:400px;"></iframe></div>'});var i=K("iframe",n.div),a=K.iframeDoc(i);a.open();a.write(e);a.close();K(a.body).css("background-color","#FFF");i[0].contentWindow.focus();return t}};function _editor(e){return new KEditor(e)}var _instances=[];function _create(e,t){t=t||{};t.basePath=_undef(t.basePath,K.basePath);t.themesPath=_undef(t.themesPath,t.basePath+"themes/");t.langPath=_undef(t.langPath,t.basePath+"lang/");t.pluginsPath=_undef(t.pluginsPath,t.basePath+"plugins/");if(_undef(t.loadStyleMode,K.options.loadStyleMode)){var n=_undef(t.themeType,K.options.themeType);_loadStyle(t.themesPath+"default/default.css");_loadStyle(t.themesPath+n+"/"+n+".css")}function i(e){_each(_plugins,function(t,n){if(_isFunction(n)){n.call(e,KindEditor);if(!e._pluginStatus){e._pluginStatus={}}e._pluginStatus[t]="inited"}});return e.create()}var a=K(e);if(!a||a.length===0){return}if(a.length>1){a.each(function(){_create(this,t)});return _instances[0]}t.srcElement=a[0];var r=new KEditor(t);_instances.push(r);if(_language[r.langType]){return i(r)}_loadScript(r.langPath+r.langType+".js?ver="+encodeURIComponent(K.DEBUG?_TIME:_VERSION),function(){i(r)});return r}function _eachEditor(e,t){K(e).each(function(e,n){K.each(_instances,function(e,i){if(i&&i.srcElement[0]==n){t.call(i,e);return false}})})}K.remove=function(e){_eachEditor(e,function(e){this.remove();_instances.splice(e,1)})};K.sync=function(e){_eachEditor(e,function(){this.sync()})};K.html=function(e,t){_eachEditor(e,function(){this.html(t)})};K.insertHtml=function(e,t){_eachEditor(e,function(){this.insertHtml(t)})};K.appendHtml=function(e,t){_eachEditor(e,function(){this.appendHtml(t)})};if(_IE&&_V<7){_nativeCommand(document,"BackgroundImageCache",true)}K.EditorClass=KEditor;K.editor=_editor;K.create=_create;K.instances=_instances;K.plugin=_plugin;K.lang=_lang;_plugin("core",function(e){var t=this,n={undo:"Z",redo:"Y",bold:"B",italic:"I",underline:"U",print:"P",selectall:"A"};t.afterSetHtml(function(){if(t.options.afterChange){t.options.afterChange.call(t)}});t.afterCreate(function(){if(t.syncType!="form"){return}var n=e(t.srcElement),i=false;while(n=n.parent()){if(n.name=="form"){i=true;break}}if(i){n.bind("submit",function(n){t.sync();e(window).bind("unload",function(){t.edit.textarea.remove()})});var a=e('[type="reset"]',n);a.click(function(){t.html(t.initContent);t.cmd.selection()});t.beforeRemove(function(){n.unbind();a.unbind()})}});t.clickToolbar("source",function(){if(t.edit.designMode){t.toolbar.disableAll(true);t.edit.design(false);t.toolbar.select("source")}else{t.toolbar.disableAll(false);t.edit.design(true);t.toolbar.unselect("source");if(_GECKO){setTimeout(function(){t.cmd.selection()},0)}else{t.cmd.selection()}}t.designMode=t.edit.designMode});t.afterCreate(function(){if(!t.designMode){t.toolbar.disableAll(true).select("source")}});t.clickToolbar("fullscreen",function(){t.fullscreen()});if(t.fullscreenShortcut){var i=false;t.afterCreate(function(){e(t.edit.doc,t.edit.textarea).keyup(function(e){if(e.which==27){setTimeout(function(){t.fullscreen()},0)}});if(i){if(_IE&&!t.designMode){return}t.focus()}if(!i){i=true}})}_each("undo,redo".split(","),function(e,i){if(n[i]){t.afterCreate(function(){_ctrl(this.edit.doc,n[i],function(){t.clickToolbar(i)})})}t.clickToolbar(i,function(){t[i]()})});t.clickToolbar("formatblock",function(){var e=t.lang("formatblock.formatBlock"),n={h1:28,h2:24,h3:18,H4:14,p:12},i=t.cmd.val("formatblock"),a=t.createMenu({name:"formatblock",width:t.langType=="en"?200:150});_each(e,function(e,r){var o="font-size:"+n[e]+"px;";if(e.charAt(0)==="h"){o+="font-weight:bold;"}a.addItem({title:'<span style="'+o+'" unselectable="on">'+r+"</span>",height:n[e]+12,checked:i===e||i===r,click:function(){t.select().exec("formatblock","<"+e+">").hideMenu()}})})});t.clickToolbar("fontname",function(){var e=t.cmd.val("fontname"),n=t.createMenu({name:"fontname",width:150});_each(t.lang("fontname.fontName"),function(i,a){n.addItem({title:'<span style="font-family: '+i+';" unselectable="on">'+a+"</span>",checked:e===i.toLowerCase()||e===a.toLowerCase(),click:function(){t.exec("fontname",i).hideMenu()}})})});t.clickToolbar("fontsize",function(){var e=t.cmd.val("fontsize"),n=t.createMenu({name:"fontsize",width:150});_each(t.fontSizeTable,function(i,a){n.addItem({title:'<span style="font-size:'+a+';" unselectable="on">'+a+"</span>",height:_removeUnit(a)+12,checked:e===a,click:function(){t.exec("fontsize",a).hideMenu()}})})});_each("forecolor,hilitecolor".split(","),function(e,n){t.clickToolbar(n,function(){t.createMenu({name:n,selectedColor:t.cmd.val(n)||"default",colors:t.colorTable,click:function(e){t.exec(n,e).hideMenu()}})})});_each("cut,copy,paste".split(","),function(e,n){t.clickToolbar(n,function(){t.focus();try{t.exec(n,null)}catch(e){alert(t.lang(n+"Error"))}})});t.clickToolbar("about",function(){var e='<div style="margin:20px;">'+"<div>KindEditor "+_VERSION+"</div>"+'<div>Copyright &copy; <a href="http://www.kindsoft.net/" target="_blank">kindsoft.net</a> All rights reserved.</div>'+"</div>";t.createDialog({name:"about",width:350,title:t.lang("about"),body:e})});t.plugin.getSelectedLink=function(){return t.cmd.commonAncestor("a")};t.plugin.getSelectedImage=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return!/^ke-\w+$/i.test(e[0].className)})};t.plugin.getSelectedFlash=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-flash"})};t.plugin.getSelectedMedia=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-media"||e[0].className=="ke-rm"})};t.plugin.getSelectedAnchor=function(){return _getImageFromRange(t.edit.cmd.range,function(e){return e[0].className=="ke-anchor"})};_each("link,image,flash,media,anchor".split(","),function(e,n){var i=n.charAt(0).toUpperCase()+n.substr(1);_each("edit,delete".split(","),function(e,a){t.addContextmenu({title:t.lang(a+i),click:function(){t.loadPlugin(n,function(){t.plugin[n][a]();t.hideMenu()})},cond:t.plugin["getSelected"+i],width:150,iconClass:a=="edit"?"ke-icon-"+n:undefined})});t.addContextmenu({title:"-"})});t.plugin.getSelectedTable=function(){return t.cmd.commonAncestor("table")};t.plugin.getSelectedRow=function(){return t.cmd.commonAncestor("tr")};t.plugin.getSelectedCell=function(){return t.cmd.commonAncestor("td")};_each(("prop,cellprop,colinsertleft,colinsertright,rowinsertabove,rowinsertbelow,rowmerge,colmerge,"+"rowsplit,colsplit,coldelete,rowdelete,insert,delete").split(","),function(e,n){var i=_inArray(n,["prop","delete"])<0?t.plugin.getSelectedCell:t.plugin.getSelectedTable;t.addContextmenu({title:t.lang("table"+n),click:function(){t.loadPlugin("table",function(){t.plugin.table[n]();t.hideMenu()})},cond:i,width:170,iconClass:"ke-icon-table"+n})});t.addContextmenu({title:"-"});_each(("selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,"+"insertunorderedlist,indent,outdent,subscript,superscript,hr,print,"+"bold,italic,underline,strikethrough,removeformat,unlink").split(","),function(e,i){if(n[i]){t.afterCreate(function(){_ctrl(this.edit.doc,n[i],function(){t.cmd.selection();t.clickToolbar(i)})})}t.clickToolbar(i,function(){t.focus().exec(i,null)})});t.afterCreate(function(){var n=t.edit.doc,i,a,r,o="__kindeditor_paste__",l=false;function s(){i.range.moveToBookmark(a);i.select();if(_WEBKIT){e("div."+o,r).each(function(){e(this).after("<br />").remove(true)});e("span.Apple-style-span",r).remove(true);e("span.Apple-tab-span",r).remove(true);e("span[style]",r).each(function(){if(e(this).css("white-space")=="nowrap"){e(this).remove(true)}});e("meta",r).remove()}var n=r[0].innerHTML;r.remove();if(n===""){return}if(_WEBKIT){n=n.replace(/(<br>)\1/gi,"$1")}if(t.pasteType===2){n=n.replace(/(<(?:p|p\s[^>]*)>) *(<\/p>)/gi,"");if(/schemas-microsoft-com|worddocument|mso-\w+/i.test(n)){n=_clearMsWord(n,t.filterMode?t.htmlTags:e.options.htmlTags)}else{n=_formatHtml(n,t.filterMode?t.htmlTags:null);n=t.beforeSetHtml(n)}}if(t.pasteType===1){n=n.replace(/&nbsp;/gi," ");n=n.replace(/\n\s*\n/g,"\n");n=n.replace(/<br[^>]*>/gi,"\n");n=n.replace(/<\/p><p[^>]*>/gi,"\n");n=n.replace(/<[^>]+>/g,"");n=n.replace(/ {2}/g," &nbsp;");if(t.newlineTag=="p"){if(/\n/.test(n)){n=n.replace(/^/,"<p>").replace(/$/,"<br /></p>").replace(/\n/g,"<br /></p><p>")}}else{n=n.replace(/\n/g,"<br />$&")}}t.insertHtml(n,true)}e(n.body).bind("paste",function(d){if(t.pasteType===0){d.stop();return}if(l){return}l=true;e("div."+o,n).remove();i=t.cmd.selection();a=i.range.createBookmark();r=e('<div class="'+o+'"></div>',n).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:"-1981px",top:e(a.start).pos().y+"px","white-space":"nowrap"});e(n.body).append(r);if(_IE){var u=i.range.get(true);u.moveToElementText(r[0]);u.select();u.execCommand("paste");d.preventDefault()}else{i.range.selectNodeContents(r[0]);i.select();r[0].tabIndex=-1;r[0].focus()}setTimeout(function(){s();l=false},0)})});t.beforeGetHtml(function(e){if(_IE&&_V<=8){e=e.replace(/<div\s+[^>]*data-ke-input-tag="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t){return unescape(t)});e=e.replace(/(<input)((?:\s+[^>]*)?>)/gi,function(e,t,n){if(!/\s+type="[^"]+"/i.test(e)){return t+' type="text"'+n}return e})}return e.replace(/(<(?:noscript|noscript\s[^>]*)>)([\s\S]*?)(<\/noscript>)/gi,function(e,t,n,i){return t+_unescape(n).replace(/\s+/g," ")+i}).replace(/<img[^>]*class="?ke-(flash|rm|media)"?[^>]*>/gi,function(e){var t=_getAttrList(e);var n=_getCssList(t.style||"");var i=_mediaAttrs(t["data-ke-tag"]);var a=_undef(n.width,"");var r=_undef(n.height,"");if(/px/i.test(a)){a=_removeUnit(a)}if(/px/i.test(r)){r=_removeUnit(r)}i.width=_undef(t.width,a);i.height=_undef(t.height,r);return _mediaEmbed(i)}).replace(/<img[^>]*class="?ke-anchor"?[^>]*>/gi,function(e){var t=_getAttrList(e);return'<a name="'+unescape(t["data-ke-name"])+'"></a>'}).replace(/<div\s+[^>]*data-ke-script-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t,n){return"<script"+unescape(t)+">"+unescape(n)+"<\/script>"}).replace(/<div\s+[^>]*data-ke-noscript-attr="([^"]*)"[^>]*>([\s\S]*?)<\/div>/gi,function(e,t,n){return"<noscript"+unescape(t)+">"+unescape(n)+"</noscript>"}).replace(/(<[^>]*)data-ke-src="([^"]*)"([^>]*>)/gi,function(e,t,n,i){e=e.replace(/(\s+(?:href|src)=")[^"]*(")/i,function(e,t,i){return t+_unescape(n)+i});e=e.replace(/\s+data-ke-src="[^"]*"/i,"");return e}).replace(/(<[^>]+\s)data-ke-(on\w+="[^"]*"[^>]*>)/gi,function(e,t,n){return t+n})});t.beforeSetHtml(function(e){if(_IE&&_V<=8){e=e.replace(/<input[^>]*>|<(select|button)[^>]*>[\s\S]*?<\/\1>/gi,function(e){var t=_getAttrList(e);var n=_getCssList(t.style||"");if(n.display=="none"){return'<div class="ke-display-none" data-ke-input-tag="'+escape(e)+'"></div>'}return e})}return e.replace(/<embed[^>]*type="([^"]+)"[^>]*>(?:<\/embed>)?/gi,function(e){var n=_getAttrList(e);n.src=_undef(n.src,"");n.width=_undef(n.width,0);n.height=_undef(n.height,0);return _mediaImg(t.themesPath+"common/blank.gif",n)}).replace(/<a[^>]*name="([^"]+)"[^>]*>(?:<\/a>)?/gi,function(e){var n=_getAttrList(e);if(n.href!==undefined){return e}return'<img class="ke-anchor" src="'+t.themesPath+'common/anchor.gif" data-ke-name="'+escape(n.name)+'" />'}).replace(/<script([^>]*)>([\s\S]*?)<\/script>/gi,function(e,t,n){return'<div class="ke-script" data-ke-script-attr="'+escape(t)+'">'+escape(n)+"</div>"}).replace(/<noscript([^>]*)>([\s\S]*?)<\/noscript>/gi,function(e,t,n){return'<div class="ke-noscript" data-ke-noscript-attr="'+escape(t)+'">'+escape(n)+"</div>"}).replace(/(<[^>]*)(href|src)="([^"]*)"([^>]*>)/gi,function(e,t,n,i,a){if(e.match(/\sdata-ke-src="[^"]*"/i)){return e}e=t+n+'="'+i+'"'+' data-ke-src="'+_escape(i)+'"'+a;return e}).replace(/(<[^>]+\s)(on\w+="[^"]*"[^>]*>)/gi,function(e,t,n){return t+"data-ke-"+n}).replace(/<table[^>]*\s+border="0"[^>]*>/gi,function(e){if(e.indexOf("ke-zeroborder")>=0){return e}return _addClassToTag(e,"ke-zeroborder")})})})})(window);KindEditor.lang({source:"HTML代码",preview:"预览",undo:"后退(Ctrl+Z)",redo:"前进(Ctrl+Y)",cut:"剪切(Ctrl+X)",copy:"复制(Ctrl+C)",paste:"粘贴(Ctrl+V)",plainpaste:"粘贴为无格式文本",wordpaste:"从Word粘贴",selectall:"全选(Ctrl+A)",justifyleft:"左对齐",justifycenter:"居中",justifyright:"右对齐",justifyfull:"两端对齐",insertorderedlist:"编号",insertunorderedlist:"项目符号",indent:"增加缩进",outdent:"减少缩进",subscript:"下标",superscript:"上标",formatblock:"段落",fontname:"字体",fontsize:"文字大小",forecolor:"文字颜色",hilitecolor:"文字背景",bold:"粗体(Ctrl+B)",italic:"斜体(Ctrl+I)",underline:"下划线(Ctrl+U)",strikethrough:"删除线",removeformat:"删除格式",image:"图片",multiimage:"批量图片上传",flash:"Flash",media:"视音频",table:"表格",tablecell:"单元格",hr:"插入横线",emoticons:"插入表情",link:"超级链接",unlink:"取消超级链接",fullscreen:"全屏显示",about:"关于",print:"打印(Ctrl+P)",filemanager:"文件空间",code:"插入程序代码",map:"Google地图",baidumap:"百度地图",lineheight:"行距",clearhtml:"清理HTML代码",pagebreak:"插入分页符",quickformat:"一键排版",insertfile:"插入文件",template:"插入模板",anchor:"锚点",yes:"确定",no:"取消",close:"关闭",editImage:"图片属性",deleteImage:"删除图片",editFlash:"Flash属性",deleteFlash:"删除Flash",editMedia:"视音频属性",deleteMedia:"删除视音频",editLink:"超级链接属性",deleteLink:"取消超级链接",editAnchor:"锚点属性",deleteAnchor:"删除锚点",tableprop:"表格属性",tablecellprop:"单元格属性",tableinsert:"插入表格",tabledelete:"删除表格",tablecolinsertleft:"左侧插入列",tablecolinsertright:"右侧插入列",tablerowinsertabove:"上方插入行",tablerowinsertbelow:"下方插入行",tablerowmerge:"向下合并单元格",tablecolmerge:"向右合并单元格",tablerowsplit:"拆分行",tablecolsplit:"拆分列",tablecoldelete:"删除列",tablerowdelete:"删除行",noColor:"无颜色",pleaseSelectFile:"请选择文件。",invalidImg:"请输入有效的URL地址。\n只允许jpg,gif,bmp,png格式。",invalidMedia:"请输入有效的URL地址。\n只允许swf,flv,mp3,wav,wma,wmv,mid,avi,mpg,asf,rm,rmvb格式。",invalidWidth:"宽度必须为数字。",invalidHeight:"高度必须为数字。",invalidBorder:"边框必须为数字。",invalidUrl:"请输入有效的URL地址。",invalidRows:"行数为必选项，只允许输入大于0的数字。",invalidCols:"列数为必选项，只允许输入大于0的数字。",invalidPadding:"边距必须为数字。",invalidSpacing:"间距必须为数字。",invalidJson:"服务器发生故障。",uploadSuccess:"上传成功。",cutError:"您的浏览器安全设置不允许使用剪切操作，请使用快捷键(Ctrl+X)来完成。",copyError:"您的浏览器安全设置不允许使用复制操作，请使用快捷键(Ctrl+C)来完成。",pasteError:"您的浏览器安全设置不允许使用粘贴操作，请使用快捷键(Ctrl+V)来完成。",ajaxLoading:"加载中，请稍候 ...",uploadLoading:"上传中，请稍候 ...",uploadError:"上传错误","plainpaste.comment":"请使用快捷键(Ctrl+V)把内容粘贴到下面的方框里。","wordpaste.comment":"请使用快捷键(Ctrl+V)把内容粘贴到下面的方框里。","code.pleaseInput":"请输入程序代码。","link.url":"URL","link.linkType":"打开类型","link.newWindow":"新窗口","link.selfWindow":"当前窗口","flash.url":"URL","flash.width":"宽度","flash.height":"高度","flash.upload":"上传","flash.viewServer":"文件空间","media.url":"URL","media.width":"宽度","media.height":"高度","media.autostart":"自动播放","media.upload":"上传","media.viewServer":"文件空间","image.remoteImage":"网络图片","image.localImage":"本地上传","image.remoteUrl":"图片地址","image.localUrl":"上传文件","image.size":"图片大小","image.width":"宽","image.height":"高","image.resetSize":"重置大小","image.align":"对齐方式","image.defaultAlign":"默认方式","image.leftAlign":"左对齐","image.rightAlign":"右对齐","image.imgTitle":"图片说明","image.upload":"浏览...","image.viewServer":"图片空间","multiimage.uploadDesc":"允许用户同时上传<%=uploadLimit%>张图片，单张图片容量不超过<%=sizeLimit%>","multiimage.startUpload":"开始上传","multiimage.clearAll":"全部清空","multiimage.insertAll":"全部插入","multiimage.queueLimitExceeded":"文件数量超过限制。","multiimage.fileExceedsSizeLimit":"文件大小超过限制。","multiimage.zeroByteFile":"无法上传空文件。","multiimage.invalidFiletype":"文件类型不正确。","multiimage.unknownError":"发生异常，无法上传。","multiimage.pending":"等待上传","multiimage.uploadError":"上传失败","filemanager.emptyFolder":"空文件夹","filemanager.moveup":"移到上一级文件夹","filemanager.viewType":"显示方式：","filemanager.viewImage":"缩略图","filemanager.listImage":"详细信息","filemanager.orderType":"排序方式：","filemanager.fileName":"名称","filemanager.fileSize":"大小","filemanager.fileType":"类型","insertfile.url":"URL","insertfile.title":"文件说明","insertfile.upload":"上传","insertfile.viewServer":"文件空间","table.cells":"单元格数","table.rows":"行数","table.cols":"列数","table.size":"大小","table.width":"宽度","table.height":"高度","table.percent":"%","table.px":"px","table.space":"边距间距","table.padding":"边距","table.spacing":"间距","table.align":"对齐方式","table.textAlign":"水平对齐","table.verticalAlign":"垂直对齐","table.alignDefault":"默认","table.alignLeft":"左对齐","table.alignCenter":"居中","table.alignRight":"右对齐","table.alignTop":"顶部","table.alignMiddle":"中部","table.alignBottom":"底部","table.alignBaseline":"基线","table.border":"边框","table.borderWidth":"边框","table.borderColor":"颜色","table.backgroundColor":"背景颜色","map.address":"地址: ","map.search":"搜索","baidumap.address":"地址: ","baidumap.search":"搜索","baidumap.insertDynamicMap":"插入动态地图","anchor.name":"锚点名称","formatblock.formatBlock":{h1:"标题 1",h2:"标题 2",h3:"标题 3",h4:"标题 4",p:"正 文"},"fontname.fontName":{SimSun:"宋体",NSimSun:"新宋体",FangSong_GB2312:"仿宋_GB2312",KaiTi_GB2312:"楷体_GB2312",SimHei:"黑体","Microsoft YaHei":"微软雅黑",Arial:"Arial","Arial Black":"Arial Black","Times New Roman":"Times New Roman","Courier New":"Courier New",Tahoma:"Tahoma",Verdana:"Verdana"},"lineheight.lineHeight":[{1:"单倍行距"},{1.5:"1.5倍行距"},{2:"2倍行距"},{2.5:"2.5倍行距"},{3:"3倍行距"}],"template.selectTemplate":"可选模板","template.replaceContent":"替换当前内容","template.fileList":{"1.html":"图片和文字","2.html":"表格","3.html":"项目编号"}},"zh-CN");KindEditor.options.langType="zh-CN";KindEditor.plugin("anchor",function(e){var t=this,n="anchor",i=t.lang(n+".");t.plugin.anchor={edit:function(){var a=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keName">'+i.name+"</label>",'<input class="ke-input-text" type="text" id="keName" name="name" value="" style="width:100px;" />',"</div>","</div>"].join("");var r=t.createDialog({name:n,width:300,title:t.lang(n),body:a,yesBtn:{name:t.lang("yes"),click:function(e){t.insertHtml('<a name="'+l.val()+'">').hideDialog().focus()}}});var o=r.div,l=e('input[name="name"]',o);var s=t.plugin.getSelectedAnchor();if(s){l.val(unescape(s.attr("data-ke-name")))}l[0].focus();l[0].select()},delete:function(){t.plugin.getSelectedAnchor().remove()}};t.clickToolbar(n,t.plugin.anchor.edit)});KindEditor.plugin("autoheight",function(e){var t=this;if(!t.autoHeightMode){return}var n;function i(){var e=t.edit;var n=e.doc.body;e.iframe[0].scroll="no";n.style.overflowY="hidden"}function a(){if(t.fullscreenMode){return}var i=t.edit;var a=i.doc.body;i.iframe.height(n);t.resize(null,Math.max((e.IE?a.scrollHeight:a.offsetHeight)+76,n))}function r(){n=e.removeUnit(t.height);t.edit.afterChange(a);if(!t.fullscreenMode){i()}a()}if(t.isCreated){r()}else{t.afterCreate(r)}});KindEditor.plugin("baidumap",function(e){var t=this,n="baidumap",i=t.lang(n+".");var a=e.undef(t.mapWidth,558);var r=e.undef(t.mapHeight,360);t.clickToolbar(n,function(){var o=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',i.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+i.search+'" />',"</span>","</div>",'<div class="ke-right">','<input type="checkbox" id="keInsertDynamicMap" name="insertDynamicMap" value="1" /> <label for="keInsertDynamicMap">'+i.insertDynamicMap+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-map" style="width:'+a+"px;height:"+r+'px;"></div>',"</div>"].join("");var l=t.createDialog({name:n,width:a+42,title:t.lang(n),body:o,yesBtn:{name:t.lang("yes"),click:function(e){var n=f.map;var i=n.getCenter();var o=i.lng+","+i.lat;var l=n.getZoom();var s=[c[0].checked?t.pluginsPath+"baidumap/index.html":"http://api.map.baidu.com/staticimage","?center="+encodeURIComponent(o),"&zoom="+encodeURIComponent(l),"&width="+a,"&height="+r,"&markers="+encodeURIComponent(o),"&markerStyles="+encodeURIComponent("l,A")].join("");if(c[0].checked){t.insertHtml('<iframe src="'+s+'" frameborder="0" style="width:'+(a+2)+"px;height:"+(r+2)+'px;"></iframe>')}else{t.exec("insertimage",s)}t.hideDialog().focus()}},beforeRemove:function(){u.remove();if(p){p.write("")}h.remove()}});var s=l.div,d=e('[name="address"]',s),u=e('[name="searchBtn"]',s),c=e('[name="insertDynamicMap"]',l.div),f,p;var h=e('<iframe class="ke-textarea" frameborder="0" src="'+t.pluginsPath+'baidumap/map.html" style="width:'+a+"px;height:"+r+'px;"></iframe>');function m(){f=h[0].contentWindow;p=e.iframeDoc(h)}h.bind("load",function(){h.unbind("load");if(e.IE){m()}else{setTimeout(m,0)}});e(".ke-map",s).replaceWith(h);u.click(function(){f.search(d.val())})})});KindEditor.plugin("map",function(e){var t=this,n="map",i=t.lang(n+".");t.clickToolbar(n,function(){var a=['<div style="padding:10px 20px;">','<div class="ke-dialog-row">',i.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+i.search+'" />',"</span>","</div>",'<div class="ke-map" style="width:558px;height:360px;"></div>',"</div>"].join("");var r=t.createDialog({name:n,width:600,title:t.lang(n),body:a,yesBtn:{name:t.lang("yes"),click:function(e){var n=d.geocoder,i=d.map,a=i.getCenter().lat()+","+i.getCenter().lng(),r=i.getZoom(),o=i.getMapTypeId(),l="http://maps.googleapis.com/maps/api/staticmap";l+="?center="+encodeURIComponent(a);l+="&zoom="+encodeURIComponent(r);l+="&size=558x360";l+="&maptype="+encodeURIComponent(o);l+="&markers="+encodeURIComponent(a);l+="&language="+t.langType;l+="&sensor=false";t.exec("insertimage",l).hideDialog().focus()}},beforeRemove:function(){s.remove();if(u){u.write("")}f.remove()}});var o=r.div,l=e('[name="address"]',o),s=e('[name="searchBtn"]',o),d,u;var c=["<!doctype html><html><head>",'<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />',"<style>","\thtml { height: 100% }","\tbody { height: 100%; margin: 0; padding: 0; background-color: #FFF }","\t#map_canvas { height: 100% }","</style>",'<script src="http://maps.googleapis.com/maps/api/js?sensor=false&language='+t.langType+'"><\/script>',"<script>","var map, geocoder;","function initialize() {","\tvar latlng = new google.maps.LatLng(31.230393, 121.473704);","\tvar options = {","\t\tzoom: 11,","\t\tcenter: latlng,","\t\tdisableDefaultUI: true,","\t\tpanControl: true,","\t\tzoomControl: true,","\t\tmapTypeControl: true,","\t\tscaleControl: true,","\t\tstreetViewControl: false,","\t\toverviewMapControl: true,","\t\tmapTypeId: google.maps.MapTypeId.ROADMAP","\t};",'\tmap = new google.maps.Map(document.getElementById("map_canvas"), options);',"\tgeocoder = new google.maps.Geocoder();","\tgeocoder.geocode({latLng: latlng}, function(results, status) {","\t\tif (status == google.maps.GeocoderStatus.OK) {","\t\t\tif (results[3]) {",'\t\t\t\tparent.document.getElementById("kindeditor_plugin_map_address").value = results[3].formatted_address;',"\t\t\t}","\t\t}","\t});","}","function search(address) {","\tif (!map) return;","\tgeocoder.geocode({address : address}, function(results, status) {","\t\tif (status == google.maps.GeocoderStatus.OK) {","\t\t\tmap.setZoom(11);","\t\t\tmap.setCenter(results[0].geometry.location);","\t\t\tvar marker = new google.maps.Marker({","\t\t\t\tmap: map,","\t\t\t\tposition: results[0].geometry.location","\t\t\t});","\t\t} else {",'\t\t\talert("Invalid address: " + address);',"\t\t}","\t});","}","<\/script>","</head>",'<body onload="initialize();">','<div id="map_canvas" style="width:100%; height:100%"></div>',"</body></html>"].join("\n");var f=e('<iframe class="ke-textarea" frameborder="0" src="'+t.pluginsPath+'map/map.html" style="width:558px;height:360px;"></iframe>');function p(){d=f[0].contentWindow;u=e.iframeDoc(f)}f.bind("load",function(){f.unbind("load");if(e.IE){p()}else{setTimeout(p,0)}});e(".ke-map",o).replaceWith(f);s.click(function(){d.search(l.val())})})});KindEditor.plugin("clearhtml",function(e){var t=this,n="clearhtml";t.clickToolbar(n,function(){t.focus();var n=t.html();n=n.replace(/(<script[^>]*>)([\s\S]*?)(<\/script>)/gi,"");n=n.replace(/(<style[^>]*>)([\s\S]*?)(<\/style>)/gi,"");n=e.formatHtml(n,{a:["href","target"],embed:["src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess"],img:["src","width","height","border","alt","title",".width",".height"],table:["border"],"td,th":["rowspan","colspan"],"div,hr,br,tbody,tr,p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":[]});t.html(n);t.cmd.selection(true);t.addBookmark()})});KindEditor.plugin("code",function(e){var t=this,n="code";t.clickToolbar(n,function(){var i=t.lang(n+"."),a=['<div style="padding:10px 20px;">','<div class="ke-dialog-row">','<select class="ke-code-type">','<option value="js">JavaScript</option>','<option value="html">HTML</option>','<option value="css">CSS</option>','<option value="php">PHP</option>','<option value="pl">Perl</option>','<option value="py">Python</option>','<option value="rb">Ruby</option>','<option value="java">Java</option>','<option value="vb">ASP/VB</option>','<option value="cpp">C/C++</option>','<option value="cs">C#</option>','<option value="xml">XML</option>','<option value="bsh">Shell</option>','<option value="">Other</option>',"</select>","</div>",'<textarea class="ke-textarea" style="width:408px;height:260px;"></textarea>',"</div>"].join(""),r=t.createDialog({name:n,width:450,title:t.lang(n),body:a,yesBtn:{name:t.lang("yes"),click:function(n){var a=e(".ke-code-type",r.div).val(),l=o.val(),s=a===""?"":" lang-"+a,d='<pre class="prettyprint'+s+'">\n'+e.escape(l)+"</pre> ";if(e.trim(l)===""){alert(i.pleaseInput);o[0].focus();return}t.insertHtml(d).hideDialog().focus()}}}),o=e("textarea",r.div);o[0].focus()})});KindEditor.plugin("emoticons",function(e){var t=this,n="emoticons",i=t.emoticonsPath||t.pluginsPath+"emoticons/images/",a=t.allowPreviewEmoticons===undefined?true:t.allowPreviewEmoticons,r=1;t.clickToolbar(n,function(){var o=5,l=9,s=135,d=0,u=o*l,c=Math.ceil(s/u),f=Math.floor(l/2),p=e('<div class="ke-plugin-emoticons"></div>'),h=[],m=t.createMenu({name:n,beforeRemove:function(){k()}});m.div.append(p);var g,v;if(a){g=e('<div class="ke-preview"></div>').css("right",0);v=e('<img class="ke-preview-img" src="'+i+d+'.gif" />');p.append(g);g.append(v)}function _(n,a,r){if(g){n.mouseover(function(){if(a>f){g.css("left",0);g.css("right","")}else{g.css("left","");g.css("right",0)}v.attr("src",i+r+".gif");e(this).addClass("ke-on")})}else{n.mouseover(function(){e(this).addClass("ke-on")})}n.mouseout(function(){e(this).removeClass("ke-on")});n.click(function(e){t.insertHtml('<img src="'+i+r+'.gif" border="0" alt="" />').hideMenu().focus();e.stop()})}function b(t,n){var a=document.createElement("table");n.append(a);if(g){e(a).mouseover(function(){g.show("block")});e(a).mouseout(function(){g.hide()});h.push(e(a))}a.className="ke-table";a.cellPadding=0;a.cellSpacing=0;a.border=0;var r=(t-1)*u+d;for(var s=0;s<o;s++){var c=a.insertRow(s);for(var f=0;f<l;f++){var p=e(c.insertCell(f));p.addClass("ke-cell");_(p,f,r);var m=e('<span class="ke-img"></span>').css("background-position","-"+24*r+"px 0px").css("background-image","url("+i+"static.gif)");p.append(m);h.push(p);r++}}return a}var y=b(r,p);function k(){e.each(h,function(){this.unbind()})}var w;function S(e,t){e.click(function(e){k();y.parentNode.removeChild(y);w.remove();y=b(t,p);E(t);r=t;e.stop()})}function E(t){w=e('<div class="ke-page"></div>');p.append(w);for(var n=1;n<=c;n++){if(t!==n){var i=e('<a href="javascript:;">['+n+"]</a>");S(i,n);w.append(i);h.push(i)}else{w.append(e("@["+n+"]"))}w.append(e("@&nbsp;"))}}E(r)})});KindEditor.plugin("filemanager",function(e){var t=this,n="filemanager",i=e.undef(t.fileManagerJson,t.basePath+"php/file_manager_json.php"),a=t.pluginsPath+n+"/images/",r=t.lang(n+".");function o(e,t,n){return e+" ("+Math.ceil(t/1024)+"KB, "+n+")"}function l(e,t){if(t.is_dir){e.attr("title",t.filename)}else{e.attr("title",o(t.filename,t.filesize,t.datetime))}}t.plugin.filemanagerDialog=function(o){var s=e.undef(o.width,650),d=e.undef(o.height,510),u=e.undef(o.dirName,""),c=e.undef(o.viewType,"VIEW").toUpperCase(),f=o.clickFn;var p=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+a+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+r.moveup+"</a>","</div>",'<div class="ke-right">',r.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+r.viewImage+"</option>",'<option value="LIST">'+r.listImage+"</option>","</select> ",r.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+r.fileName+"</option>",'<option value="SIZE">'+r.fileSize+"</option>",'<option value="TYPE">'+r.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join("");var h=t.createDialog({name:n,width:s,height:d,title:t.lang(n),body:p}),m=h.div,g=e(".ke-plugin-filemanager-body",m),v=e('[name="moveupImg"]',m),_=e('[name="moveupLink"]',m),b=e('[name="viewServer"]',m),y=e('[name="viewType"]',m),k=e('[name="orderType"]',m);function w(n,a,r){var o="path="+n+"&order="+a+"&dir="+u;h.showLoading(t.lang("ajaxLoading"));e.ajax(e.addParam(i,o+"&"+(new Date).getTime()),function(e){h.hideLoading();r(e)})}var S=[];function E(t,n,i,a){var r=e.formatUrl(n.current_url+i.filename,"absolute"),o=encodeURIComponent(n.current_dir_path+i.filename+"/");if(i.is_dir){t.click(function(e){w(o,k.val(),a)})}else if(i.is_photo){t.click(function(e){f.call(this,r,i.filename)})}else{t.click(function(e){f.call(this,r,i.filename)})}S.push(t)}function C(t,n){e.each(S,function(){this.unbind()});_.unbind();y.unbind();k.unbind();if(t.current_dir_path){_.click(function(e){w(t.moveup_dir_path,k.val(),n)})}function i(){if(y.val()=="VIEW"){w(t.current_dir_path,k.val(),T)}else{w(t.current_dir_path,k.val(),x)}}y.change(i);k.change(i);g.html("")}function x(t){C(t,x);var n=document.createElement("table");n.className="ke-table";n.cellPadding=0;n.cellSpacing=0;n.border=0;g.append(n);var i=t.file_list;for(var o=0,l=i.length;o<l;o++){var s=i[o],d=e(n.insertRow(o));d.mouseover(function(t){e(this).addClass("ke-on")}).mouseout(function(t){e(this).removeClass("ke-on")});var u=a+(s.is_dir?"folder-16.gif":"file-16.gif"),c=e('<img src="'+u+'" width="16" height="16" alt="'+s.filename+'" align="absmiddle" />'),f=e(d[0].insertCell(0)).addClass("ke-cell ke-name").append(c).append(document.createTextNode(" "+s.filename));if(!s.is_dir||s.has_file){d.css("cursor","pointer");f.attr("title",s.filename);E(f,t,s,x)}else{f.attr("title",r.emptyFolder)}e(d[0].insertCell(1)).addClass("ke-cell ke-size").html(s.is_dir?"-":Math.ceil(s.filesize/1024)+"KB");e(d[0].insertCell(2)).addClass("ke-cell ke-datetime").html(s.datetime)}}function T(t){C(t,T);var n=t.file_list;for(var i=0,o=n.length;i<o;i++){var s=n[i],d=e('<div class="ke-inline-block ke-item"></div>');g.append(d);var u=e('<div class="ke-inline-block ke-photo"></div>').mouseover(function(t){e(this).addClass("ke-on")}).mouseout(function(t){e(this).removeClass("ke-on")});d.append(u);var c=t.current_url+s.filename,f=s.is_dir?a+"folder-64.gif":s.is_photo?c:a+"file-64.gif";var p=e('<img src="'+f+'" width="80" height="80" alt="'+s.filename+'" />');if(!s.is_dir||s.has_file){u.css("cursor","pointer");l(u,s);E(u,t,s,T)}else{u.attr("title",r.emptyFolder)}u.append(p);d.append('<div class="ke-name" title="'+s.filename+'">'+s.filename+"</div>")}}y.val(c);w("",k.val(),c=="VIEW"?T:x);return h}});KindEditor.plugin("flash",function(e){var t=this,n="flash",i=t.lang(n+"."),a=e.undef(t.allowFlashUpload,true),r=e.undef(t.allowFileManager,false),o=e.undef(t.formatUploadUrl,true),l=e.undef(t.extraFileUploadParams,{}),s=e.undef(t.filePostName,"imgFile"),d=e.undef(t.uploadJson,t.basePath+"php/upload_json.php");t.plugin.flash={edit:function(){var u=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+i.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+i.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+i.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+i.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" /> ',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+i.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" /> ',"</div>","</div>"].join("");var c=t.createDialog({name:n,width:450,title:t.lang(n),body:u,yesBtn:{name:t.lang("yes"),click:function(n){var i=e.trim(p.val()),a=m.val(),r=g.val();if(i=="http://"||e.invalidUrl(i)){alert(t.lang("invalidUrl"));p[0].focus();return}if(!/^\d*$/.test(a)){alert(t.lang("invalidWidth"));m[0].focus();return}if(!/^\d*$/.test(r)){alert(t.lang("invalidHeight"));g[0].focus();return}var o=e.mediaImg(t.themesPath+"common/blank.gif",{src:i,type:e.mediaType(".swf"),width:a,height:r,quality:"high"});t.insertHtml(o).hideDialog().focus()}}}),f=c.div,p=e('[name="url"]',f),h=e('[name="viewServer"]',f),m=e('[name="width"]',f),g=e('[name="height"]',f);p.val("http://");if(a){var v=e.uploadbutton({button:e(".ke-upload-button",f)[0],fieldName:s,extraParams:l,url:e.addParam(d,"dir=flash"),afterUpload:function(i){c.hideLoading();if(i.error===0){var a=i.url;if(o){a=e.formatUrl(a,"absolute")}p.val(a);if(t.afterUpload){t.afterUpload.call(t,a,i,n)}alert(t.lang("uploadSuccess"))}else{alert(i.message)}},afterError:function(e){c.hideLoading();t.errorDialog(e)}});v.fileBox.change(function(e){c.showLoading(t.lang("uploadLoading"));v.submit()})}else{e(".ke-upload-button",f).hide()}if(r){h.click(function(n){t.loadPlugin("filemanager",function(){t.plugin.filemanagerDialog({viewType:"LIST",dirName:"flash",clickFn:function(n,i){if(t.dialogs.length>1){e('[name="url"]',f).val(n);if(t.afterSelectFile){t.afterSelectFile.call(t,n)}t.hideDialog()}}})})})}else{h.hide()}var _=t.plugin.getSelectedFlash();if(_){var b=e.mediaAttrs(_.attr("data-ke-tag"));p.val(b.src);m.val(e.removeUnit(_.css("width"))||b.width||0);g.val(e.removeUnit(_.css("height"))||b.height||0)}p[0].focus();p[0].select()},delete:function(){t.plugin.getSelectedFlash().remove();t.addBookmark()}};t.clickToolbar(n,t.plugin.flash.edit)});KindEditor.plugin("image",function(e){var t=this,n="image",i=e.undef(t.allowImageUpload,true),a=e.undef(t.allowImageRemote,true),r=e.undef(t.formatUploadUrl,true),o=e.undef(t.allowFileManager,false),l=e.undef(t.uploadJson,t.basePath+"php/upload_json.php"),s=e.undef(t.imageTabIndex,0),d=t.pluginsPath+"image/images/",u=e.undef(t.extraFileUploadParams,{}),c=e.undef(t.filePostName,"imgFile"),f=e.undef(t.fillDescAfterUploadImage,false),p=t.lang(n+".");t.plugin.imageDialog=function(i){var a=i.imageUrl,s=e.undef(i.imageWidth,""),h=e.undef(i.imageHeight,""),m=e.undef(i.imageTitle,""),g=e.undef(i.imageAlign,""),v=e.undef(i.showRemote,true),_=e.undef(i.showLocal,true),b=e.undef(i.tabIndex,0),y=i.clickFn;var k="kindeditor_upload_iframe_"+(new Date).getTime();var w=[];for(var S in u){w.push('<input type="hidden" name="'+S+'" value="'+u[S]+'" />')}var E=['<div style="padding:20px;">','<div class="tabs"></div>','<div class="tab1" style="display:none;">','<div class="ke-dialog-row">','<label for="remoteUrl" style="width:60px;">'+p.remoteUrl+"</label>",'<input type="text" id="remoteUrl" class="ke-input-text" name="url" value="" style="width:200px;" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+p.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="remoteWidth" style="width:60px;">'+p.size+"</label>",p.width+' <input type="text" id="remoteWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> ',p.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> ','<img class="ke-refresh-btn" src="'+d+'refresh.png" width="16" height="16" alt="" style="cursor:pointer;" title="'+p.resetSize+'" />',"</div>",'<div class="ke-dialog-row">','<label style="width:60px;">'+p.align+"</label>",'<input type="radio" name="align" class="ke-inline-block" value="" checked="checked" /> <img name="defaultImg" src="'+d+'align_top.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="left" /> <img name="leftImg" src="'+d+'align_left.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="right" /> <img name="rightImg" src="'+d+'align_right.gif" width="23" height="25" alt="" />',"</div>",'<div class="ke-dialog-row">','<label for="remoteTitle" style="width:60px;">'+p.imgTitle+"</label>",'<input type="text" id="remoteTitle" class="ke-input-text" name="title" value="" style="width:200px;" />',"</div>","</div>",'<div class="tab2" style="display:none;">','<iframe name="'+k+'" style="display:none;"></iframe>','<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+k+'" action="'+e.addParam(l,"dir=image")+'">','<div class="ke-dialog-row">',w.join(""),'<label style="width:60px;">'+p.localUrl+"</label>",'<input type="text" name="localUrl" class="ke-input-text" tabindex="-1" style="width:200px;" readonly="true" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+p.upload+'" />',"</div>","</form>","</div>","</div>"].join("");var C=_||o?450:400,x=_&&v?300:250;var T=t.createDialog({name:n,width:C,height:x,title:t.lang(n),body:E,yesBtn:{name:t.lang("yes"),click:function(n){if(T.isLoading){return}if(_&&v&&P&&P.selectedIndex===1||!v){if(B.fileBox.val()==""){alert(t.lang("pleaseSelectFile"));return}T.showLoading(t.lang("uploadLoading"));B.submit();A.val("");return}var i=e.trim(U.val()),a=I.val(),r=F.val(),o=M.val(),l="";R.each(function(){if(this.checked){l=this.value;return false}});if(i=="http://"||e.invalidUrl(i)){alert(t.lang("invalidUrl"));U[0].focus();return}if(!/^\d*$/.test(a)){alert(t.lang("invalidWidth"));I[0].focus();return}if(!/^\d*$/.test(r)){alert(t.lang("invalidHeight"));F[0].focus();return}y.call(t,i,o,a,r,0,l)}},beforeRemove:function(){N.unbind();I.unbind();F.unbind();D.unbind()}}),K=T.div;var U=e('[name="url"]',K),A=e('[name="localUrl"]',K),N=e('[name="viewServer"]',K),I=e('.tab1 [name="width"]',K),F=e('.tab1 [name="height"]',K),D=e(".ke-refresh-btn",K),M=e('.tab1 [name="title"]',K),R=e('.tab1 [name="align"]',K);var P;if(v&&_){P=e.tabs({src:e(".tabs",K),afterSelect:function(e){}});P.add({title:p.remoteImage,panel:e(".tab1",K)});P.add({title:p.localImage,panel:e(".tab2",K)});P.select(b)}else if(v){e(".tab1",K).show()}else if(_){e(".tab2",K).show()}var B=e.uploadbutton({button:e(".ke-upload-button",K)[0],fieldName:c,form:e(".ke-form",K),target:k,width:60,afterUpload:function(i){T.hideLoading();if(i.error===0){var a=i.url;if(r){a=e.formatUrl(a,"absolute")}if(t.afterUpload){t.afterUpload.call(t,a,i,n)}if(!f){y.call(t,a,i.title,i.width,i.height,i.border,i.align)}else{e(".ke-dialog-row #remoteUrl",K).val(a);e(".ke-tabs-li",K)[0].click();e(".ke-refresh-btn",K).click()}}else{alert(i.message)}},afterError:function(e){T.hideLoading();t.errorDialog(e)}});B.fileBox.change(function(e){A.val(B.fileBox.val())});if(o){N.click(function(n){t.loadPlugin("filemanager",function(){t.plugin.filemanagerDialog({viewType:"VIEW",dirName:"image",clickFn:function(n,i){if(t.dialogs.length>1){e('[name="url"]',K).val(n);if(t.afterSelectFile){t.afterSelectFile.call(t,n)}t.hideDialog()}}})})})}else{N.hide()}var L=0,O=0;function W(e,t){I.val(e);F.val(t);L=e;O=t}D.click(function(t){var n=e('<img src="'+U.val()+'" />',document).css({position:"absolute",visibility:"hidden",top:0,left:"-1000px"});n.bind("load",function(){n.remove()});e(document.body).append(n)});I.change(function(e){if(L>0){F.val(Math.round(O/L*parseInt(this.value,10)))}});F.change(function(e){if(O>0){I.val(Math.round(L/O*parseInt(this.value,10)))}});U.val(i.imageUrl);W(i.imageWidth,i.imageHeight);M.val(i.imageTitle);R.each(function(){if(this.value===i.imageAlign){this.checked=true;return false}});if(v&&b===0){U[0].focus();U[0].select()}return T};t.plugin.image={edit:function(){var e=t.plugin.getSelectedImage();t.plugin.imageDialog({imageUrl:e?e.attr("data-ke-src"):"http://",imageWidth:e?e.attr("width"):"",imageHeight:e?e.attr("height"):"",imageTitle:e?e.attr("title"):"",imageAlign:e?e.attr("align"):"",showRemote:a,showLocal:i,tabIndex:e?0:s,clickFn:function(n,i,a,r,o,l){if(e){e.attr("src",n);e.attr("data-ke-src",n);e.attr("width",a);e.attr("height",r);e.attr("title",i);e.attr("align",l);e.attr("alt",i)}else{t.exec("insertimage",n,i,a,r,o,l)}setTimeout(function(){t.hideDialog().focus()},0)}})},delete:function(){var e=t.plugin.getSelectedImage();if(e.parent().name=="a"){e=e.parent()}e.remove();t.addBookmark()}};t.clickToolbar(n,t.plugin.image.edit)});KindEditor.plugin("insertfile",function(e){var t=this,n="insertfile",i=e.undef(t.allowFileUpload,true),a=e.undef(t.allowFileManager,false),r=e.undef(t.formatUploadUrl,true),o=e.undef(t.uploadJson,t.basePath+"php/upload_json.php"),l=e.undef(t.extraFileUploadParams,{}),s=e.undef(t.filePostName,"imgFile"),d=t.lang(n+".");t.plugin.fileDialog=function(u){var c=e.undef(u.fileUrl,"http://"),f=e.undef(u.fileTitle,""),p=u.clickFn;var h=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+d.url+"</label>",'<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+d.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+d.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keTitle" style="width:60px;">'+d.title+"</label>",'<input type="text" id="keTitle" class="ke-input-text" name="title" value="" style="width:160px;" /></div>',"</div>","</form>","</div>"].join("");var m=t.createDialog({name:n,width:450,title:t.lang(n),body:h,yesBtn:{name:t.lang("yes"),click:function(n){var i=e.trim(v.val()),a=b.val();if(i=="http://"||e.invalidUrl(i)){alert(t.lang("invalidUrl"));v[0].focus();return}if(e.trim(a)===""){a=i}p.call(t,i,a)}}}),g=m.div;var v=e('[name="url"]',g),_=e('[name="viewServer"]',g),b=e('[name="title"]',g);if(i){var y=e.uploadbutton({button:e(".ke-upload-button",g)[0],fieldName:s,url:e.addParam(o,"dir=file"),extraParams:l,afterUpload:function(i){m.hideLoading();if(i.error===0){var a=i.url;if(r){a=e.formatUrl(a,"absolute")}v.val(a);if(t.afterUpload){t.afterUpload.call(t,a,i,n)}alert(t.lang("uploadSuccess"))}else{alert(i.message)}},afterError:function(e){m.hideLoading();t.errorDialog(e)}});y.fileBox.change(function(e){m.showLoading(t.lang("uploadLoading"));y.submit()})}else{e(".ke-upload-button",g).hide()}if(a){_.click(function(n){t.loadPlugin("filemanager",function(){t.plugin.filemanagerDialog({viewType:"LIST",dirName:"file",clickFn:function(n,i){if(t.dialogs.length>1){e('[name="url"]',g).val(n);if(t.afterSelectFile){t.afterSelectFile.call(t,n)}t.hideDialog()}}})})})}else{_.hide()}v.val(c);b.val(f);v[0].focus();v[0].select()};t.clickToolbar(n,function(){t.plugin.fileDialog({clickFn:function(e,n){var i='<a class="ke-insertfile" href="'+e+'" data-ke-src="'+e+'" target="_blank">'+n+"</a>";t.insertHtml(i).hideDialog().focus()}})})});KindEditor.plugin("lineheight",function(e){var t=this,n="lineheight",i=t.lang(n+".");t.clickToolbar(n,function(){var a="",r=t.cmd.commonNode({"*":".line-height"});if(r){a=r.css("line-height")}var o=t.createMenu({name:n,width:150});e.each(i.lineHeight,function(n,i){e.each(i,function(e,n){o.addItem({title:n,checked:a===e,click:function(){t.cmd.toggle('<span style="line-height:'+e+';"></span>',{span:".line-height="+e});t.updateState();t.addBookmark();t.hideMenu()}})})})})});KindEditor.plugin("link",function(e){var t=this,n="link";t.plugin.link={edit:function(){var i=t.lang(n+"."),a='<div style="padding:20px;">'+'<div class="ke-dialog-row">'+'<label for="keUrl" style="width:60px;">'+i.url+"</label>"+'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:260px;" /></div>'+'<div class="ke-dialog-row"">'+'<label for="keType" style="width:60px;">'+i.linkType+"</label>"+'<select id="keType" name="type"></select>'+"</div>"+"</div>",r=t.createDialog({name:n,width:450,title:t.lang(n),body:a,yesBtn:{name:t.lang("yes"),click:function(n){var i=e.trim(l.val());if(i=="http://"||e.invalidUrl(i)){alert(t.lang("invalidUrl"));l[0].focus();return}t.exec("createlink",i,s.val()).hideDialog().focus()}}}),o=r.div,l=e('input[name="url"]',o),s=e('select[name="type"]',o);l.val("http://");s[0].options[0]=new Option(i.newWindow,"_blank");s[0].options[1]=new Option(i.selfWindow,"");t.cmd.selection();var d=t.plugin.getSelectedLink();if(d){t.cmd.range.selectNode(d[0]);t.cmd.select();l.val(d.attr("data-ke-src"));s.val(d.attr("target"))}l[0].focus();l[0].select()},delete:function(){t.exec("unlink",null)}};t.clickToolbar(n,t.plugin.link.edit)});KindEditor.plugin("media",function(e){var t=this,n="media",i=t.lang(n+"."),a=e.undef(t.allowMediaUpload,true),r=e.undef(t.allowFileManager,false),o=e.undef(t.formatUploadUrl,true),l=e.undef(t.extraFileUploadParams,{}),s=e.undef(t.filePostName,"imgFile"),d=e.undef(t.uploadJson,t.basePath+"php/upload_json.php");t.plugin.media={edit:function(){var u=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+i.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+i.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+i.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+i.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+i.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+i.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join("");var c=t.createDialog({name:n,width:450,height:230,title:t.lang(n),body:u,yesBtn:{name:t.lang("yes"),click:function(n){var i=e.trim(p.val()),a=m.val(),r=g.val();if(i=="http://"||e.invalidUrl(i)){alert(t.lang("invalidUrl"));p[0].focus();return}if(!/^\d*$/.test(a)){alert(t.lang("invalidWidth"));m[0].focus();return}if(!/^\d*$/.test(r)){alert(t.lang("invalidHeight"));g[0].focus();return}var o=e.mediaImg(t.themesPath+"common/blank.gif",{src:i,type:e.mediaType(i),width:a,height:r,autostart:v[0].checked?"true":"false",loop:"true"});t.insertHtml(o).hideDialog().focus()}}}),f=c.div,p=e('[name="url"]',f),h=e('[name="viewServer"]',f),m=e('[name="width"]',f),g=e('[name="height"]',f),v=e('[name="autostart"]',f);p.val("http://");if(a){var _=e.uploadbutton({button:e(".ke-upload-button",f)[0],fieldName:s,extraParams:l,url:e.addParam(d,"dir=media"),afterUpload:function(i){c.hideLoading();if(i.error===0){var a=i.url;if(o){a=e.formatUrl(a,"absolute")}p.val(a);if(t.afterUpload){t.afterUpload.call(t,a,i,n)}alert(t.lang("uploadSuccess"))}else{alert(i.message)}},afterError:function(e){c.hideLoading();t.errorDialog(e)}});_.fileBox.change(function(e){c.showLoading(t.lang("uploadLoading"));_.submit()})}else{e(".ke-upload-button",f).hide()}if(r){h.click(function(n){t.loadPlugin("filemanager",function(){t.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(n,i){if(t.dialogs.length>1){e('[name="url"]',f).val(n);if(t.afterSelectFile){t.afterSelectFile.call(t,n)}t.hideDialog()}}})})})}else{h.hide()}var b=t.plugin.getSelectedMedia();if(b){var y=e.mediaAttrs(b.attr("data-ke-tag"));p.val(y.src);m.val(e.removeUnit(b.css("width"))||y.width||0);g.val(e.removeUnit(b.css("height"))||y.height||0);v[0].checked=y.autostart==="true"}p[0].focus();p[0].select()},delete:function(){t.plugin.getSelectedMedia().remove();t.addBookmark()}};t.clickToolbar(n,t.plugin.media.edit)});(function(e){function t(e){this.init(e)}e.extend(t,{init:function(t){var n=this;t.afterError=t.afterError||function(e){alert(e)};n.options=t;n.progressbars={};n.div=e(t.container).html(['<div class="ke-swfupload">','<div class="ke-swfupload-top">','<div class="ke-inline-block ke-swfupload-button">','<input type="button" value="Browse" />',"</div>",'<div class="ke-inline-block ke-swfupload-desc">'+t.uploadDesc+"</div>",'<span class="ke-button-common ke-button-outer ke-swfupload-startupload">','<input type="button" class="ke-button-common ke-button" value="'+t.startButtonValue+'" />',"</span>","</div>",'<div class="ke-swfupload-body"></div>',"</div>"].join(""));n.bodyDiv=e(".ke-swfupload-body",n.div);function i(t,n){e(".ke-status > div",t).hide();e(".ke-message",t).addClass("ke-error").show().html(e.escape(n))}var a={debug:false,upload_url:t.uploadUrl,flash_url:t.flashUrl,file_post_name:t.filePostName,button_placeholder:e(".ke-swfupload-button > input",n.div)[0],button_image_url:t.buttonImageUrl,button_width:t.buttonWidth,button_height:t.buttonHeight,button_cursor:SWFUpload.CURSOR.HAND,file_types:t.fileTypes,file_types_description:t.fileTypesDesc,file_upload_limit:t.fileUploadLimit,file_size_limit:t.fileSizeLimit,post_params:t.postParams,file_queued_handler:function(e){e.url=n.options.fileIconUrl;n.appendFile(e)},file_queue_error_handler:function(n,i,a){var r="";switch(i){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:r=t.queueLimitExceeded;break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:r=t.fileExceedsSizeLimit;break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:r=t.zeroByteFile;break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:r=t.invalidFiletype;break;default:r=t.unknownError;break}e.DEBUG&&alert(r)},upload_start_handler:function(t){var n=this;var i=e('div[data-id="'+t.id+'"]',n.bodyDiv);e(".ke-status > div",i).hide();e(".ke-progressbar",i).show()},upload_progress_handler:function(e,t,i){var a=Math.round(t*100/i);var r=n.progressbars[e.id];r.bar.css("width",Math.round(a*80/100)+"px");r.percent.html(a+"%")},upload_error_handler:function(t,a,r){if(t&&t.filestatus==SWFUpload.FILE_STATUS.ERROR){var o=e('div[data-id="'+t.id+'"]',n.bodyDiv).eq(0);i(o,n.options.errorMessage)}},upload_success_handler:function(t,a){var r=e('div[data-id="'+t.id+'"]',n.bodyDiv).eq(0);var o={};try{o=e.json(a)}catch(e){n.options.afterError.call(this,"<!doctype html><html>"+a+"</html>")}if(o.error!==0){i(r,e.DEBUG?o.message:n.options.errorMessage);return}t.url=o.url;e(".ke-img",r).attr("src",t.url).attr("data-status",t.filestatus).data("data",o);e(".ke-status > div",r).hide()}};n.swfu=new SWFUpload(a);e(".ke-swfupload-startupload input",n.div).click(function(){n.swfu.startUpload()})},getUrlList:function(){var t=[];e(".ke-img",self.bodyDiv).each(function(){var n=e(this);var i=n.attr("data-status");if(i==SWFUpload.FILE_STATUS.COMPLETE){t.push(n.data("data"))}});return t},removeFile:function(t){var n=this;n.swfu.cancelUpload(t);var i=e('div[data-id="'+t+'"]',n.bodyDiv);e(".ke-photo",i).unbind();e(".ke-delete",i).unbind();i.remove()},removeFiles:function(){var t=this;e(".ke-item",t.bodyDiv).each(function(){t.removeFile(e(this).attr("data-id"))})},appendFile:function(t){var n=this;var i=e('<div class="ke-inline-block ke-item" data-id="'+t.id+'"></div>');n.bodyDiv.append(i);var a=e('<div class="ke-inline-block ke-photo"></div>').mouseover(function(t){e(this).addClass("ke-on")}).mouseout(function(t){e(this).removeClass("ke-on")});i.append(a);var r=e('<img src="'+t.url+'" class="ke-img" data-status="'+t.filestatus+'" width="80" height="80" alt="'+t.name+'" />');a.append(r);e('<span class="ke-delete"></span>').appendTo(a).click(function(){n.removeFile(t.id)});var o=e('<div class="ke-status"></div>').appendTo(a);e(['<div class="ke-progressbar">','<div class="ke-progressbar-bar"><div class="ke-progressbar-bar-inner"></div></div>','<div class="ke-progressbar-percent">0%</div></div>'].join("")).hide().appendTo(o);e('<div class="ke-message">'+n.options.pendingMessage+"</div>").appendTo(o);i.append('<div class="ke-name">'+t.name+"</div>");n.progressbars[t.id]={bar:e(".ke-progressbar-bar-inner",a),percent:e(".ke-progressbar-percent",a)}},remove:function(){this.removeFiles();this.swfu.destroy();this.div.html("")}});e.swfupload=function(e,n){return new t(e,n)}})(KindEditor);KindEditor.plugin("multiimage",function(e){var t=this,n="multiimage",i=e.undef(t.formatUploadUrl,true),a=e.undef(t.uploadJson,t.basePath+"php/upload_json.php"),r=t.pluginsPath+"multiimage/images/",o=e.undef(t.imageSizeLimit,"1MB"),l=e.undef(t.imageFileTypes,"*.jpg;*.gif;*.png"),s=e.undef(t.imageUploadLimit,20),d=e.undef(t.filePostName,"imgFile"),u=t.lang(n+".");t.plugin.multiImageDialog=function(i){var l=i.clickFn,c=e.tmpl(u.uploadDesc,{uploadLimit:s,sizeLimit:o});var f=['<div style="padding:20px;">','<div class="swfupload">',"</div>","</div>"].join("");var p=t.createDialog({name:n,width:650,height:510,title:t.lang(n),body:f,previewBtn:{name:u.insertAll,click:function(e){l.call(t,m.getUrlList())}},yesBtn:{name:u.clearAll,click:function(e){m.removeFiles()}},beforeRemove:function(){if(!e.IE||e.V<=8){m.remove()}}}),h=p.div;var m=e.swfupload({container:e(".swfupload",h),buttonImageUrl:r+(t.langType=="zh-CN"?"select-files-zh-CN.png":"select-files-en.png"),buttonWidth:t.langType=="zh-CN"?72:88,buttonHeight:23,fileIconUrl:r+"image.png",uploadDesc:c,startButtonValue:u.startUpload,uploadUrl:e.addParam(a,"dir=image"),flashUrl:r+"swfupload.swf",filePostName:d,fileTypes:"*.jpg;*.jpeg;*.gif;*.png;*.bmp",fileTypesDesc:"Image Files",fileUploadLimit:s,fileSizeLimit:o,postParams:e.undef(t.extraFileUploadParams,{}),queueLimitExceeded:u.queueLimitExceeded,fileExceedsSizeLimit:u.fileExceedsSizeLimit,zeroByteFile:u.zeroByteFile,invalidFiletype:u.invalidFiletype,unknownError:u.unknownError,pendingMessage:u.pending,errorMessage:u.uploadError,afterError:function(e){t.errorDialog(e)}});return p};t.clickToolbar(n,function(){t.plugin.multiImageDialog({clickFn:function(n){if(n.length===0){return}e.each(n,function(e,n){if(t.afterUpload){t.afterUpload.call(t,n.url,n,"multiimage")}t.exec("insertimage",n.url,n.title,n.width,n.height,n.border,n.align)});setTimeout(function(){t.hideDialog().focus()},0)}})})});(function(){window.SWFUpload=function(e){this.initSWFUpload(e)};SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={};this.settings=e;this.eventQueue=[];this.movieName="KindEditor_SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(e){delete SWFUpload.instances[this.movieName];throw e}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(e){if(typeof e!=="string"||e.match(/^https?:\/\//i)||e.match(/^\//)){return e}var t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var n=window.location.pathname.lastIndexOf("/");var i;if(n<=0){i="/"}else{i=window.location.pathname.substr(0,n)+"/"}return i+e};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(e,t){this.settings[e]=this.settings[e]==undefined?t:this.settings[e]};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()}if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)}delete this.ensureDefault};SWFUpload.prototype.loadFlash=function(){var e,t;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}e=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(e==undefined){throw"Could not find the placeholder element: "+this.settings.button_placeholder_id}t=document.createElement("div");t.innerHTML=this.getFlashHTML();e.parentNode.replaceChild(t.firstChild,e);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement()}};SWFUpload.prototype.getFlashHTML=function(){var e="";if(KindEditor.IE&&KindEditor.V>8){e=' classid = "clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"'}return['<object id="',this.movieName,'"'+e+' type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString();var t=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(t),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var e=this.settings.post_params;var t=[];if(typeof e==="object"){for(var n in e){if(e.hasOwnProperty(n)){t.push(encodeURIComponent(n.toString())+"="+encodeURIComponent(e[n].toString()))}}}return t.join("&amp;")};SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var e=null;e=this.getMovieElement();if(e&&typeof e.CallFunction==="unknown"){for(var t in e){try{if(typeof e[t]==="function"){e[t]=null}}catch(e){}}try{e.parentNode.removeChild(e)}catch(e){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true}catch(e){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(e,t,n){if(t==undefined){return this.settings[e]=n}else{return this.settings[e]=t}};SWFUpload.prototype.getSetting=function(e){if(this.settings[e]!=undefined){return this.settings[e]}return""};SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement();var returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>");returnValue=eval(returnString)}catch(e){throw"Call to "+functionName+" failed"}if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue)}return returnValue};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(e){this.callFlash("StartUpload",[e])};SWFUpload.prototype.cancelUpload=function(e,t){if(t!==false){t=true}this.callFlash("CancelUpload",[e,t])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(e){this.callFlash("SetStats",[e])};SWFUpload.prototype.getFile=function(e){if(typeof e==="number"){return this.callFlash("GetFileByIndex",[e])}else{return this.callFlash("GetFile",[e])}};SWFUpload.prototype.addFileParam=function(e,t,n){return this.callFlash("AddFileParam",[e,t,n])};SWFUpload.prototype.removeFileParam=function(e,t){this.callFlash("RemoveFileParam",[e,t])};SWFUpload.prototype.setUploadURL=function(e){this.settings.upload_url=e.toString();this.callFlash("SetUploadURL",[e])};SWFUpload.prototype.setPostParams=function(e){this.settings.post_params=e;this.callFlash("SetPostParams",[e])};SWFUpload.prototype.addPostParam=function(e,t){this.settings.post_params[e]=t;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(e){delete this.settings.post_params[e];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(e,t){this.settings.file_types=e;this.settings.file_types_description=t;this.callFlash("SetFileTypes",[e,t])};SWFUpload.prototype.setFileSizeLimit=function(e){this.settings.file_size_limit=e;this.callFlash("SetFileSizeLimit",[e])};SWFUpload.prototype.setFileUploadLimit=function(e){this.settings.file_upload_limit=e;this.callFlash("SetFileUploadLimit",[e])};SWFUpload.prototype.setFileQueueLimit=function(e){this.settings.file_queue_limit=e;this.callFlash("SetFileQueueLimit",[e])};SWFUpload.prototype.setFilePostName=function(e){this.settings.file_post_name=e;this.callFlash("SetFilePostName",[e])};SWFUpload.prototype.setUseQueryString=function(e){this.settings.use_query_string=e;this.callFlash("SetUseQueryString",[e])};SWFUpload.prototype.setRequeueOnError=function(e){this.settings.requeue_on_error=e;this.callFlash("SetRequeueOnError",[e])};SWFUpload.prototype.setHTTPSuccess=function(e){if(typeof e==="string"){e=e.replace(" ","").split(",")}this.settings.http_success=e;this.callFlash("SetHTTPSuccess",[e])};SWFUpload.prototype.setAssumeSuccessTimeout=function(e){this.settings.assume_success_timeout=e;this.callFlash("SetAssumeSuccessTimeout",[e])};SWFUpload.prototype.setDebugEnabled=function(e){this.settings.debug_enabled=e;this.callFlash("SetDebugEnabled",[e])};SWFUpload.prototype.setButtonImageURL=function(e){if(e==undefined){e=""}this.settings.button_image_url=e;this.callFlash("SetButtonImageURL",[e])};SWFUpload.prototype.setButtonDimensions=function(e,t){this.settings.button_width=e;this.settings.button_height=t;var n=this.getMovieElement();if(n!=undefined){n.style.width=e+"px";n.style.height=t+"px"}this.callFlash("SetButtonDimensions",[e,t])};SWFUpload.prototype.setButtonText=function(e){this.settings.button_text=e;this.callFlash("SetButtonText",[e])};SWFUpload.prototype.setButtonTextPadding=function(e,t){this.settings.button_text_top_padding=t;this.settings.button_text_left_padding=e;this.callFlash("SetButtonTextPadding",[e,t])};SWFUpload.prototype.setButtonTextStyle=function(e){this.settings.button_text_style=e;this.callFlash("SetButtonTextStyle",[e])};SWFUpload.prototype.setButtonDisabled=function(e){this.settings.button_disabled=e;this.callFlash("SetButtonDisabled",[e])};SWFUpload.prototype.setButtonAction=function(e){this.settings.button_action=e;this.callFlash("SetButtonAction",[e])};SWFUpload.prototype.setButtonCursor=function(e){this.settings.button_cursor=e;this.callFlash("SetButtonCursor",[e])};SWFUpload.prototype.queueEvent=function(e,t){if(t==undefined){t=[]}else if(!(t instanceof Array)){t=[t]}var n=this;if(typeof this.settings[e]==="function"){this.eventQueue.push(function(){this.settings[e].apply(this,t)});setTimeout(function(){n.executeNextEvent()},0)}else if(this.settings[e]!==null){throw"Event handler "+e+" is unknown or is not a function"}};SWFUpload.prototype.executeNextEvent=function(){var e=this.eventQueue?this.eventQueue.shift():null;if(typeof e==="function"){e.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(e){var t=/[$]([0-9a-f]{4})/i;var n={};var i;if(e!=undefined){for(var a in e.post){if(e.post.hasOwnProperty(a)){i=a;var r;while((r=t.exec(i))!==null){i=i.replace(r[0],String.fromCharCode(parseInt("0x"+r[1],16)))}n[i]=e.post[a]}}e.post=n}return e};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(e){return false}};SWFUpload.prototype.flashReady=function(){var e=this.getMovieElement();if(!e){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(e);this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.cleanUp=function(e){try{if(this.movieElement&&typeof e.CallFunction==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var t in e){try{if(typeof e[t]==="function"){e[t]=null}}catch(e){}}}}catch(e){}window["__flash__removeCallback"]=function(e,t){try{if(e){e[t]=null}}catch(e){}}};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(e){e=this.unescapeFilePostParams(e);this.queueEvent("file_queued_handler",e)};SWFUpload.prototype.fileQueueError=function(e,t,n){e=this.unescapeFilePostParams(e);this.queueEvent("file_queue_error_handler",[e,t,n])};SWFUpload.prototype.fileDialogComplete=function(e,t,n){this.queueEvent("file_dialog_complete_handler",[e,t,n])};SWFUpload.prototype.uploadStart=function(e){e=this.unescapeFilePostParams(e);this.queueEvent("return_upload_start_handler",e)};SWFUpload.prototype.returnUploadStart=function(e){var t;if(typeof this.settings.upload_start_handler==="function"){e=this.unescapeFilePostParams(e);t=this.settings.upload_start_handler.call(this,e)}else if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}if(t===undefined){t=true}t=!!t;this.callFlash("ReturnUploadStart",[t])};SWFUpload.prototype.uploadProgress=function(e,t,n){e=this.unescapeFilePostParams(e);this.queueEvent("upload_progress_handler",[e,t,n])};SWFUpload.prototype.uploadError=function(e,t,n){e=this.unescapeFilePostParams(e);this.queueEvent("upload_error_handler",[e,t,n])};SWFUpload.prototype.uploadSuccess=function(e,t,n){e=this.unescapeFilePostParams(e);this.queueEvent("upload_success_handler",[e,t,n])};SWFUpload.prototype.uploadComplete=function(e){e=this.unescapeFilePostParams(e);this.queueEvent("upload_complete_handler",e)};SWFUpload.prototype.debug=function(e){this.queueEvent("debug_handler",e)};SWFUpload.prototype.debugMessage=function(e){if(this.settings.debug){var t,n=[];if(typeof e==="object"&&typeof e.name==="string"&&typeof e.message==="string"){for(var i in e){if(e.hasOwnProperty(i)){n.push(i+": "+e[i])}}t=n.join("\n")||"";n=t.split("\n");t="EXCEPTION: "+n.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(t)}else{SWFUpload.Console.writeLine(e)}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(e){var t,n;try{t=document.getElementById("SWFUpload_Console");if(!t){n=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(n);t=document.createElement("textarea");t.id="SWFUpload_Console";t.style.fontFamily="monospace";t.setAttribute("wrap","off");t.wrap="off";t.style.overflow="auto";t.style.width="700px";t.style.height="350px";t.style.margin="5px";n.appendChild(t)}t.value+=e+"\n";t.scrollTop=t.scrollHeight-t.clientHeight}catch(e){alert("Exception: "+e.name+" Message: "+e.message)}}})();(function(){if(typeof SWFUpload==="function"){SWFUpload.queue={};SWFUpload.prototype.initSettings=function(e){return function(){if(typeof e==="function"){e.call(this)}this.queueSettings={};this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler;this.settings.upload_complete_handler=SWFUpload.queue.uploadCompleteHandler;this.settings.upload_start_handler=SWFUpload.queue.uploadStartHandler;this.settings.queue_complete_handler=this.settings.queue_complete_handler||null}}(SWFUpload.prototype.initSettings);SWFUpload.prototype.startUpload=function(e){this.queueSettings.queue_cancelled_flag=false;this.callFlash("StartUpload",[e])};SWFUpload.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=true;this.stopUpload();var e=this.getStats();while(e.files_queued>0){this.cancelUpload();e=this.getStats()}};SWFUpload.queue.uploadStartHandler=function(e){var t;if(typeof this.queueSettings.user_upload_start_handler==="function"){t=this.queueSettings.user_upload_start_handler.call(this,e)}t=t===false?false:true;this.queueSettings.queue_cancelled_flag=!t;return t};SWFUpload.queue.uploadCompleteHandler=function(e){var t=this.queueSettings.user_upload_complete_handler;var n;if(e.filestatus===SWFUpload.FILE_STATUS.COMPLETE){this.queueSettings.queue_upload_count++}if(typeof t==="function"){n=t.call(this,e)===false?false:true}else if(e.filestatus===SWFUpload.FILE_STATUS.QUEUED){n=false}else{n=true}if(n){var i=this.getStats();if(i.files_queued>0&&this.queueSettings.queue_cancelled_flag===false){this.startUpload()}else if(this.queueSettings.queue_cancelled_flag===false){this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]);this.queueSettings.queue_upload_count=0}else{this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0}}}}})();KindEditor.plugin("pagebreak",function(e){var t=this;var n="pagebreak";var i=e.undef(t.pagebreakHtml,'<hr style="page-break-after: always;" class="ke-pagebreak" />');t.clickToolbar(n,function(){var n=t.cmd,a=n.range;t.focus();var r=t.newlineTag=="br"||e.WEBKIT?"":'<span id="__kindeditor_tail_tag__"></span>';t.insertHtml(i+r);if(r!==""){var o=e("#__kindeditor_tail_tag__",t.edit.doc);a.selectNodeContents(o[0]);o.removeAttr("id");n.select()}})});KindEditor.plugin("plainpaste",function(e){var t=this,n="plainpaste";t.clickToolbar(n,function(){var i=t.lang(n+"."),a='<div style="padding:10px 20px;">'+'<div style="margin-bottom:10px;">'+i.comment+"</div>"+'<textarea class="ke-textarea" style="width:408px;height:260px;"></textarea>'+"</div>",r=t.createDialog({name:n,width:450,title:t.lang(n),body:a,yesBtn:{name:t.lang("yes"),click:function(n){var i=o.val();i=e.escape(i);i=i.replace(/ {2}/g," &nbsp;");if(t.newlineTag=="p"){i=i.replace(/^/,"<p>").replace(/$/,"</p>").replace(/\n/g,"</p><p>")}else{i=i.replace(/\n/g,"<br />$&")}t.insertHtml(i).hideDialog().focus()}}}),o=e("textarea",r.div);o[0].focus()})});KindEditor.plugin("preview",function(e){var t=this,n="preview",i;t.clickToolbar(n,function(){var i=t.lang(n+"."),a='<div style="padding:10px 20px;">'+'<iframe class="ke-textarea" frameborder="0" style="width:708px;height:400px;"></iframe>'+"</div>",r=t.createDialog({name:n,width:750,title:t.lang(n),body:a}),o=e("iframe",r.div),l=e.iframeDoc(o);l.open();l.write(t.fullHtml());l.close();e(l.body).css("background-color","#FFF");o[0].contentWindow.focus()})});KindEditor.plugin("quickformat",function(e){var t=this,n="quickformat",i=e.toMap("blockquote,center,div,h1,h2,h3,h4,h5,h6,p");function a(e){var t=e.first();while(t&&t.first()){t=t.first()}return t}t.clickToolbar(n,function(){t.focus();var n=t.edit.doc,r=t.cmd.range,o=e(n.body).first(),l,s=[],d=[],u=r.createBookmark(true);while(o){l=o.next();var c=a(o);if(!c||c.name!="img"){if(i[o.name]){o.html(o.html().replace(/^(\s|&nbsp;|　)+/gi,""));o.css("text-indent","2em")}else{d.push(o)}if(!l||(i[l.name]||i[o.name]&&!i[l.name])){if(d.length>0){s.push(d)}d=[]}}o=l}e.each(s,function(t,i){var a=e('<p style="text-indent:2em;"></p>',n);i[0].before(a);e.each(i,function(e,t){a.append(t)})});r.moveToBookmark(u);t.addBookmark()})});KindEditor.plugin("table",function(e){var t=this,n="table",i=t.lang(n+"."),a="ke-zeroborder";function r(e,t){t=t.toUpperCase();e.css("background-color",t);e.css("color",t==="#000000"?"#FFFFFF":"#000000");e.html(t)}var o=[];function l(n,i){i.bind("click,mousedown",function(e){e.stopPropagation()});function a(){e.each(o,function(){this.remove()});o=[];e(document).unbind("click,mousedown",a);n.unbind("click,mousedown",a)}i.click(function(i){a();var l=e(this),s=l.pos();var d=e.colorpicker({x:s.x,y:s.y+l.height(),z:811214,selectedColor:e(this).html(),colors:t.colorTable,noColor:t.lang("noColor"),shadowMode:t.shadowMode,click:function(e){r(l,e);a()}});o.push(d);e(document).bind("click,mousedown",a);n.bind("click,mousedown",a)})}function s(e,t,n){var i=0;for(var a=0,r=t.cells.length;a<r;a++){if(t.cells[a]==n){break}i+=t.cells[a].rowSpan-1}return n.cellIndex-i}t.plugin.table={prop:function(o){var s=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keRows" style="width:90px;">'+i.cells+"</label>",i.rows+' <input type="text" id="keRows" class="ke-input-text ke-input-number" name="rows" value="" maxlength="4" /> &nbsp; ',i.cols+' <input type="text" class="ke-input-text ke-input-number" name="cols" value="" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:90px;">'+i.size+"</label>",i.width+' <input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> &nbsp; ','<select name="widthType">','<option value="%">'+i.percent+"</option>",'<option value="px">'+i.px+"</option>","</select> &nbsp; ",i.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> &nbsp; ','<select name="heightType">','<option value="%">'+i.percent+"</option>",'<option value="px">'+i.px+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="kePadding" style="width:90px;">'+i.space+"</label>",i.padding+' <input type="text" id="kePadding" class="ke-input-text ke-input-number" name="padding" value="" maxlength="4" /> &nbsp; ',i.spacing+' <input type="text" class="ke-input-text ke-input-number" name="spacing" value="" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAlign" style="width:90px;">'+i.align+"</label>",'<select id="keAlign" name="align">','<option value="">'+i.alignDefault+"</option>",'<option value="left">'+i.alignLeft+"</option>",'<option value="center">'+i.alignCenter+"</option>",'<option value="right">'+i.alignRight+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keBorder" style="width:90px;">'+i.border+"</label>",i.borderWidth+' <input type="text" id="keBorder" class="ke-input-text ke-input-number" name="border" value="" maxlength="4" /> &nbsp; ',i.borderColor+' <span class="ke-inline-block ke-input-color"></span>',"</div>",'<div class="ke-dialog-row">','<label for="keBgColor" style="width:90px;">'+i.backgroundColor+"</label>",'<span class="ke-inline-block ke-input-color"></span>',"</div>","</div>"].join("");var d=t.cmd.range.createBookmark();var u=t.createDialog({name:n,width:500,title:t.lang(n),body:s,beforeRemove:function(){w.unbind()},yesBtn:{name:t.lang("yes"),click:function(n){var i=f.val(),r=p.val(),o=h.val(),l=m.val(),s=g.val(),u=v.val(),c=_.val(),E=b.val(),C=y.val(),x=k.val(),T=e(w[0]).html()||"",K=e(w[1]).html()||"";if(i==0||!/^\d+$/.test(i)){alert(t.lang("invalidRows"));f[0].focus();return}if(r==0||!/^\d+$/.test(r)){alert(t.lang("invalidRows"));p[0].focus();return}if(!/^\d*$/.test(o)){alert(t.lang("invalidWidth"));h[0].focus();return}if(!/^\d*$/.test(l)){alert(t.lang("invalidHeight"));m[0].focus();return}if(!/^\d*$/.test(c)){alert(t.lang("invalidPadding"));_[0].focus();return}if(!/^\d*$/.test(E)){alert(t.lang("invalidSpacing"));b[0].focus();return}if(!/^\d*$/.test(x)){alert(t.lang("invalidBorder"));k[0].focus();return}if(S){if(o!==""){S.width(o+s)}else{S.css("width","")}if(S[0].width!==undefined){S.removeAttr("width")}if(l!==""){S.height(l+u)}else{S.css("height","")}if(S[0].height!==undefined){S.removeAttr("height")}S.css("background-color",K);if(S[0].bgColor!==undefined){S.removeAttr("bgColor")}if(c!==""){S[0].cellPadding=c}else{S.removeAttr("cellPadding")}if(E!==""){S[0].cellSpacing=E}else{S.removeAttr("cellSpacing")}if(C!==""){S[0].align=C}else{S.removeAttr("align")}if(x!==""){S.attr("border",x)}else{S.removeAttr("border")}if(x===""||x==="0"){S.addClass(a)}else{S.removeClass(a)}if(T!==""){S.attr("borderColor",T)}else{S.removeAttr("borderColor")}t.hideDialog().focus();t.cmd.range.moveToBookmark(d);t.cmd.select();t.addBookmark();return}var U="";if(o!==""){U+="width:"+o+s+";"}if(l!==""){U+="height:"+l+u+";"}if(K!==""){U+="background-color:"+K+";"}var A="<table";if(U!==""){A+=' style="'+U+'"'}if(c!==""){A+=' cellpadding="'+c+'"'}if(E!==""){A+=' cellspacing="'+E+'"'}if(C!==""){A+=' align="'+C+'"'}if(x!==""){A+=' border="'+x+'"'}if(x===""||x==="0"){A+=' class="'+a+'"'}if(T!==""){A+=' bordercolor="'+T+'"'}A+=">";for(var N=0;N<i;N++){A+="<tr>";for(var I=0;I<r;I++){A+="<td>"+(e.IE?"&nbsp;":"<br />")+"</td>"}A+="</tr>"}A+="</table>";if(!e.IE){A+="<br />"}t.insertHtml(A);t.select().hideDialog().focus();t.addBookmark()}}}),c=u.div,f=e('[name="rows"]',c).val(3),p=e('[name="cols"]',c).val(2),h=e('[name="width"]',c).val(100),m=e('[name="height"]',c),g=e('[name="widthType"]',c),v=e('[name="heightType"]',c),_=e('[name="padding"]',c).val(2),b=e('[name="spacing"]',c).val(0),y=e('[name="align"]',c),k=e('[name="border"]',c).val(1),w=e(".ke-input-color",c);l(c,w.eq(0));l(c,w.eq(1));r(w.eq(0),"#000000");r(w.eq(1),"");f[0].focus();f[0].select();var S;if(o){return}S=t.plugin.getSelectedTable();if(S){f.val(S[0].rows.length);p.val(S[0].rows.length>0?S[0].rows[0].cells.length:0);f.attr("disabled",true);p.attr("disabled",true);var E,C=S[0].style.width||S[0].width,x=S[0].style.height||S[0].height;if(C!==undefined&&(E=/^(\d+)((?:px|%)*)$/.exec(C))){h.val(E[1]);g.val(E[2])}else{h.val("")}if(x!==undefined&&(E=/^(\d+)((?:px|%)*)$/.exec(x))){m.val(E[1]);v.val(E[2])}_.val(S[0].cellPadding||"");b.val(S[0].cellSpacing||"");y.val(S[0].align||"");k.val(S[0].border===undefined?"":S[0].border);r(w.eq(0),e.toHex(S.attr("borderColor")||""));r(w.eq(1),e.toHex(S[0].style.backgroundColor||S[0].bgColor||""));h[0].focus();h[0].select()}},cellprop:function(){var a=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keWidth" style="width:90px;">'+i.size+"</label>",i.width+' <input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> &nbsp; ','<select name="widthType">','<option value="%">'+i.percent+"</option>",'<option value="px">'+i.px+"</option>","</select> &nbsp; ",i.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> &nbsp; ','<select name="heightType">','<option value="%">'+i.percent+"</option>",'<option value="px">'+i.px+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keAlign" style="width:90px;">'+i.align+"</label>",i.textAlign+' <select id="keAlign" name="textAlign">','<option value="">'+i.alignDefault+"</option>",'<option value="left">'+i.alignLeft+"</option>",'<option value="center">'+i.alignCenter+"</option>",'<option value="right">'+i.alignRight+"</option>","</select> ",i.verticalAlign+' <select name="verticalAlign">','<option value="">'+i.alignDefault+"</option>",'<option value="top">'+i.alignTop+"</option>",'<option value="middle">'+i.alignMiddle+"</option>",'<option value="bottom">'+i.alignBottom+"</option>",'<option value="baseline">'+i.alignBaseline+"</option>","</select>","</div>",'<div class="ke-dialog-row">','<label for="keBorder" style="width:90px;">'+i.border+"</label>",i.borderWidth+' <input type="text" id="keBorder" class="ke-input-text ke-input-number" name="border" value="" maxlength="4" /> &nbsp; ',i.borderColor+' <span class="ke-inline-block ke-input-color"></span>',"</div>",'<div class="ke-dialog-row">','<label for="keBgColor" style="width:90px;">'+i.backgroundColor+"</label>",'<span class="ke-inline-block ke-input-color"></span>',"</div>","</div>"].join("");var o=t.cmd.range.createBookmark();var s=t.createDialog({name:n,width:500,title:t.lang("tablecell"),body:a,beforeRemove:function(){b.unbind()},yesBtn:{name:t.lang("yes"),click:function(n){var i=u.val(),a=c.val(),r=f.val(),l=p.val(),s=h.val(),d=m.val(),k=g.val(),w=v.val(),S=_.val(),E=e(b[0]).html()||"",C=e(b[1]).html()||"";if(!/^\d*$/.test(i)){alert(t.lang("invalidWidth"));u[0].focus();return}if(!/^\d*$/.test(a)){alert(t.lang("invalidHeight"));c[0].focus();return}if(!/^\d*$/.test(S)){alert(t.lang("invalidBorder"));_[0].focus();return}y.css({width:i!==""?i+r:"",height:a!==""?a+l:"","background-color":C,"text-align":k,"vertical-align":w,"border-width":S,"border-style":S!==""?"solid":"","border-color":E});t.hideDialog().focus();t.cmd.range.moveToBookmark(o);t.cmd.select();t.addBookmark()}}}),d=s.div,u=e('[name="width"]',d).val(100),c=e('[name="height"]',d),f=e('[name="widthType"]',d),p=e('[name="heightType"]',d),h=e('[name="padding"]',d).val(2),m=e('[name="spacing"]',d).val(0),g=e('[name="textAlign"]',d),v=e('[name="verticalAlign"]',d),_=e('[name="border"]',d).val(1),b=e(".ke-input-color",d);l(d,b.eq(0));l(d,b.eq(1));r(b.eq(0),"#000000");r(b.eq(1),"");u[0].focus();u[0].select();var y=t.plugin.getSelectedCell();var k,w=y[0].style.width||y[0].width||"",S=y[0].style.height||y[0].height||"";if(k=/^(\d+)((?:px|%)*)$/.exec(w)){u.val(k[1]);f.val(k[2])}else{u.val("")}if(k=/^(\d+)((?:px|%)*)$/.exec(S)){c.val(k[1]);p.val(k[2])}g.val(y[0].style.textAlign||"");v.val(y[0].style.verticalAlign||"");var E=y[0].style.borderWidth||"";if(E){E=parseInt(E)}_.val(E);r(b.eq(0),e.toHex(y[0].style.borderColor||""));r(b.eq(1),e.toHex(y[0].style.backgroundColor||""));u[0].focus();u[0].select()},insert:function(){this.prop(true)},delete:function(){var e=t.plugin.getSelectedTable();t.cmd.range.setStartBefore(e[0]).collapse(true);t.cmd.select();e.remove();t.addBookmark()},colinsert:function(n){var i=t.plugin.getSelectedTable()[0],a=t.plugin.getSelectedRow()[0],r=t.plugin.getSelectedCell()[0],o=r.cellIndex+n;o+=i.rows[0].cells.length-a.cells.length;for(var l=0,d=i.rows.length;l<d;l++){var u=i.rows[l],c=u.insertCell(o);c.innerHTML=e.IE?"":"<br />";o=s(i,u,c)}t.cmd.range.selectNodeContents(r).collapse(true);t.cmd.select();t.addBookmark()},colinsertleft:function(){this.colinsert(0)},colinsertright:function(){this.colinsert(1)},rowinsert:function(n){var i=t.plugin.getSelectedTable()[0],a=t.plugin.getSelectedRow()[0],r=t.plugin.getSelectedCell()[0];var o=a.rowIndex;if(n===1){o=a.rowIndex+(r.rowSpan-1)+n}var l=i.insertRow(o);for(var s=0,d=a.cells.length;s<d;s++){if(a.cells[s].rowSpan>1){d-=a.cells[s].rowSpan-1}var u=l.insertCell(s);if(n===1&&a.cells[s].colSpan>1){u.colSpan=a.cells[s].colSpan}u.innerHTML=e.IE?"":"<br />"}for(var c=o;c>=0;c--){var f=i.rows[c].cells;if(f.length>s){for(var p=r.cellIndex;p>=0;p--){if(f[p].rowSpan>1){f[p].rowSpan+=1}}break}}t.cmd.range.selectNodeContents(r).collapse(true);t.cmd.select();t.addBookmark()},rowinsertabove:function(){this.rowinsert(0)},rowinsertbelow:function(){this.rowinsert(1)},rowmerge:function(){var e=t.plugin.getSelectedTable()[0],n=t.plugin.getSelectedRow()[0],i=t.plugin.getSelectedCell()[0],a=n.rowIndex,r=a+i.rowSpan,o=e.rows[r];if(e.rows.length<=r){return}var l=i.cellIndex;if(o.cells.length<=l){return}var s=o.cells[l];if(i.colSpan!==s.colSpan){return}i.rowSpan+=s.rowSpan;o.deleteCell(l);t.cmd.range.selectNodeContents(i).collapse(true);t.cmd.select();t.addBookmark()},colmerge:function(){var e=t.plugin.getSelectedTable()[0],n=t.plugin.getSelectedRow()[0],i=t.plugin.getSelectedCell()[0],a=n.rowIndex,r=i.cellIndex,o=r+1;if(n.cells.length<=o){return}var l=n.cells[o];if(i.rowSpan!==l.rowSpan){return}i.colSpan+=l.colSpan;n.deleteCell(o);t.cmd.range.selectNodeContents(i).collapse(true);t.cmd.select();t.addBookmark()},rowsplit:function(){var n=t.plugin.getSelectedTable()[0],i=t.plugin.getSelectedRow()[0],a=t.plugin.getSelectedCell()[0],r=i.rowIndex;if(a.rowSpan===1){return}var o=s(n,i,a);for(var l=1,d=a.rowSpan;l<d;l++){var u=n.rows[r+l],c=u.insertCell(o);if(a.colSpan>1){c.colSpan=a.colSpan}c.innerHTML=e.IE?"":"<br />";o=s(n,u,c)}e(a).removeAttr("rowSpan");t.cmd.range.selectNodeContents(a).collapse(true);t.cmd.select();t.addBookmark()},colsplit:function(){var n=t.plugin.getSelectedTable()[0],i=t.plugin.getSelectedRow()[0],a=t.plugin.getSelectedCell()[0],r=a.cellIndex;if(a.colSpan===1){return}for(var o=1,l=a.colSpan;o<l;o++){var s=i.insertCell(r+o);if(a.rowSpan>1){s.rowSpan=a.rowSpan}s.innerHTML=e.IE?"":"<br />"}e(a).removeAttr("colSpan");t.cmd.range.selectNodeContents(a).collapse(true);t.cmd.select();t.addBookmark()},coldelete:function(){var n=t.plugin.getSelectedTable()[0],i=t.plugin.getSelectedRow()[0],a=t.plugin.getSelectedCell()[0],r=a.cellIndex;for(var o=0,l=n.rows.length;o<l;o++){var s=n.rows[o],d=s.cells[r];if(d.colSpan>1){d.colSpan-=1;if(d.colSpan===1){e(d).removeAttr("colSpan")}}else{s.deleteCell(r)}if(d.rowSpan>1){o+=d.rowSpan-1}}if(i.cells.length===0){t.cmd.range.setStartBefore(n).collapse(true);t.cmd.select();e(n).remove()}else{t.cmd.selection(true)}t.addBookmark()},rowdelete:function(){var n=t.plugin.getSelectedTable()[0],i=t.plugin.getSelectedRow()[0],a=t.plugin.getSelectedCell()[0],r=i.rowIndex;for(var o=a.rowSpan-1;o>=0;o--){n.deleteRow(r+o)}if(n.rows.length===0){t.cmd.range.setStartBefore(n).collapse(true);t.cmd.select();e(n).remove()}else{t.cmd.selection(true)}t.addBookmark()}};t.clickToolbar(n,t.plugin.table.prop)});KindEditor.plugin("template",function(e){var t=this,n="template",i=t.lang(n+"."),a=t.pluginsPath+n+"/html/";function r(t){return a+t+"?ver="+encodeURIComponent(e.DEBUG?e.TIME:e.VERSION)}t.clickToolbar(n,function(){var i=t.lang(n+"."),a=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',i.selectTemplate+" <select>"];e.each(i.fileList,function(e,t){a.push('<option value="'+e+'">'+t+"</option>")});html=[a.join(""),"</select></div>",'<div class="ke-right">','<input type="checkbox" id="keReplaceFlag" name="replaceFlag" value="1" /> <label for="keReplaceFlag">'+i.replaceContent+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<iframe class="ke-textarea" frameborder="0" style="width:458px;height:260px;background-color:#FFF;"></iframe>',"</div>"].join("");var o=t.createDialog({name:n,width:500,title:t.lang(n),body:html,yesBtn:{name:t.lang("yes"),click:function(n){var i=e.iframeDoc(d);t[s[0].checked?"html":"insertHtml"](i.body.innerHTML).hideDialog().focus()}}});var l=e("select",o.div),s=e('[name="replaceFlag"]',o.div),d=e("iframe",o.div);s[0].checked=true;d.attr("src",r(l.val()));l.change(function(){d.attr("src",r(this.value))})})});KindEditor.plugin("wordpaste",function(e){var t=this,n="wordpaste";t.clickToolbar(n,function(){var i=t.lang(n+"."),a='<div style="padding:10px 20px;">'+'<div style="margin-bottom:10px;">'+i.comment+"</div>"+'<iframe class="ke-textarea" frameborder="0" style="width:408px;height:260px;"></iframe>'+"</div>",r=t.createDialog({name:n,width:450,title:t.lang(n),body:a,yesBtn:{name:t.lang("yes"),click:function(n){var i=s.body.innerHTML;i=e.clearMsWord(i,t.filterMode?t.htmlTags:e.options.htmlTags);t.insertHtml(i).hideDialog().focus()}}}),o=r.div,l=e("iframe",o),s=e.iframeDoc(l);if(!e.IE){s.designMode="on"}s.open();s.write("<!doctype html><html><head><title>WordPaste</title></head>");s.write('<body style="background-color:#FFF;font-size:12px;margin:2px;">');if(!e.IE){s.write("<br />")}s.write("</body></html>");s.close();if(e.IE){s.body.contentEditable="true"}l[0].contentWindow.focus()})});KindEditor.plugin("fixtoolbar",function(e){var t=this;if(!t.fixToolBar){return}function n(){var t=e(".ke-toolbar");var n=t.pos().y;e(window).bind("scroll",function(){if(t.css("position")=="fixed"){if(document.body.scrollTop-n<0){t.css("position","static");t.css("top","auto")}}else{if(t.pos().y-document.body.scrollTop<0){t.css("position","fixed");t.css("top",0)}}})}if(t.isCreated){n()}else{t.afterCreate(n)}});